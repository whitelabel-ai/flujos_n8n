{
  "active": false,
  "connections": {
    "Multi_Agent_Call": {
      "main": [
        [
          {
            "node": "Reminder_Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Sheets": {
      "main": [
        [
          {
            "node": "response_ok2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [
          {
            "node": "Aggregate3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Google Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Reminder_Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Reminder_Agent": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items1": {
      "main": [
        [
          {
            "node": "Aggregate2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Filtrar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Buscar1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items2": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Buscar",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "response_ok",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "response_X",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "response_X": {
      "main": [
        [
          {
            "node": "Loop Over Items2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Buscar": {
      "main": [
        [
          {
            "node": "Loop Over Items2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filtrar": {
      "main": [
        [
          {
            "node": "Eliminar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Eliminar": {
      "main": [
        [
          {
            "node": "If4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "response_ok": {
      "main": [
        [
          {
            "node": "Loop Over Items2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items3": {
      "main": [
        [
          {
            "node": "Aggregate1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate1": {
      "main": [
        [
          {
            "node": "response1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Buscar1": {
      "main": [
        [
          {
            "node": "Loop Over Items3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "response_ok1": {
      "main": [
        [
          {
            "node": "Loop Over Items3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Buscar1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Buscar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If3": {
      "main": [
        [
          {
            "node": "response_ok1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "response_X1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "response_X1": {
      "main": [
        [
          {
            "node": "Loop Over Items3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate2": {
      "main": [
        [
          {
            "node": "response2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate3": {
      "main": [
        [
          {
            "node": "response3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "response_ok2": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "response_ok3": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "Reminder_Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "If4": {
      "main": [
        [
          {
            "node": "response_ok3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "response_X2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "response_X2": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-03-17T15:48:05.899Z",
  "id": "AeS5ZbUX8owdNwrw",
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "Reminder_Agent",
  "nodes": [
    {
      "parameters": {},
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1,
      "position": [
        120,
        520
      ],
      "id": "d2bcbb80-fff2-4a60-b4f0-5b389d59142a",
      "name": "Multi_Agent_Call"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1hiUwqtRuICOd3Xu-6TkEoRh1P_jz3svWGiDk6zvKQPQ",
          "mode": "list",
          "cachedResultName": "Recordatorios Whatsapp",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1hiUwqtRuICOd3Xu-6TkEoRh1P_jz3svWGiDk6zvKQPQ/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2115264411,
          "mode": "list",
          "cachedResultName": "n8n",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1hiUwqtRuICOd3Xu-6TkEoRh1P_jz3svWGiDk6zvKQPQ/edit#gid=2115264411"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Nombre": "={{ $json.Nombre || $json.nombre }}",
            "frecuencia": "={{ $json.Frecuencia || $json.frecuencia }}",
            "medicamento": "={{ $json.Medicamento || $json.medicamento}}",
            "Cantidad": "={{ $json.Cantidad || $json.cantidad }}",
            "User_id": "={{ $json.User_id || $json.user_id}}",
            "hora de inicio": "={{ $json[\"hora de inicio\"] || $json.HoraInicio}}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "User_id",
              "displayName": "User_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Nombre",
              "displayName": "Nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "frecuencia",
              "displayName": "frecuencia",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "hora de inicio",
              "displayName": "hora de inicio",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "medicamento",
              "displayName": "medicamento",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Cantidad",
              "displayName": "Cantidad",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        1680,
        880
      ],
      "id": "04e19214-15d6-4d6e-9247-c2a117c331e5",
      "name": "Google Sheets",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "VlwvwMWj6xOw815v",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        1480,
        900
      ],
      "id": "daeef284-5737-4d5e-adc3-9429c8bea314",
      "name": "Loop Over Items",
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        340,
        760
      ],
      "id": "b72c75eb-dc22-4132-a5b4-38c81715c802",
      "name": "OpenAI Chat Model1",
      "credentials": {
        "openAiApi": {
          "id": "n0YNBr6r2ZQqJ11H",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=mensaje: {{ $json.query }}",
        "options": {
          "systemMessage": "=## üìå **Resumen**\n\nEres un agente encargado de gestionar recordatorios de medicamentos. Tu tarea es recibir la informaci√≥n del usuario en cualquier formato, extraer los datos necesarios y **enviar los datos en formato JSON estandarizado** para crear los recordatorios.\n\n---\n\n## üõ† **Datos a Extraer y Enviar en Cada Recordatorio**\n\nüìå **Estructura de los datos:**\n1Ô∏è‚É£ **user_id** ‚Üí ID √∫nico del usuario\n2Ô∏è‚É£ **nombre** ‚Üí Nombre del usuario\n3Ô∏è‚É£ **frecuencia** ‚Üí D√≠as o intervalo de tiempo en que debe tomarse el medicamento, puede venir en el Horario, si dice diario se entiende que es todos los d√≠as\n4Ô∏è‚É£ **hora_de_inicio** ‚Üí Hora en la que debe tomarse debe detectarla en el Horario\n5Ô∏è‚É£ **medicamento** ‚Üí Nombre del medicamento\n6Ô∏è‚É£ **cantidad** ‚Üí Dosis del medicamento puede ser una tableta o lo que se refiera en cuanto a la cantidad de la dosis\n---\n\n## üìÖ **Manejo de Frecuencia en Recordatorios**\n\n### **Tipos de Recordatorios**\n\n1Ô∏è‚É£ **Frecuencia Fija (Ejemplo: \"Cada 8 horas\", \"Diario\")**\n\n- Convertir a horas exactas antes de enviarlo:\n    - \"Diario\" ‚Üí **Cada 24 horas**\n    - \"Cada 8 horas\" ‚Üí **Cada 8 horas**\n    - \"Cada 3 d√≠as\" ‚Üí **Cada 72 horas**\n- **en este caso solo se creara un solo recordatorio con la frecuencia especifica, Cada x horas, pero en la frecuencia siempore pones *Todos los dias* o si se especifica el dia especifico**.\nIMPORTANTE QUE LA FRECUENCIA SIEMPRE ES todos los d√≠as a menos que especifiquen un dia en especifico\n\n2Ô∏è‚É£ **Horario Espec√≠fico (Ejemplo: \"A las 9 AM y 5 PM\")**\n\n- Crear **varios recordatorios independientes**.\n- Enviar **n cantidad de recordatorios** cada uno con su horario espec√≠fico.\n- **Cada recordatorio debe incluir toda la informaci√≥n del usuario y el d√≠a correspondiente**.\n- importante siempre enviar la hora en formato Militar, sin AM o PM\n\n---\n\n### üîÑ **Conversi√≥n de Frecuencia dada en horas pero que son todos los dias.**\n\nEl usuario puede proporcionar la frecuencia en t√©rminos generales pero tu enviaras siempre d√≠as (ejemplo: \"diario\", \"todos los lunes\"),\n\n- **\"diario\"** ‚Üí **todos los d√≠as **\n- **\"Cada 8 horas\"** ‚Üí **todos los d√≠as**\n- **\"en las ma√±anas\"** ‚Üí *todos los d√≠as*\n\n---\n\n## üìå **Formato de Salida JSON**\n\nüîπ **El formato de salida debe ser siempre un objeto JSON con los recordatorios, sin texto adicional, comentarios o bloques de c√≥digo.**\n\nCada objeto JSON debe tener la siguiente estructura:\n\n{\n\"User_id\": \"ID √∫nico del usuario\",\n\"Nombre\": \"Nombre del usuario\",\n\"Frecuencia\": \"Frecuencia del recordatorio\",\n\"HoraInicio\": \"Hora exacta del recordatorio\",\n\"Medicamento\": \"Nombre del medicamento\",\n\"Cantidad\": \"Dosis del medicamento\"\n}\n\nüîπ Ejemplo de Entrada:\n\"Crear un recordatorio de Advil, 1 tableta a las 2 PM, lunes, mi√©rcoles y viernes para Pedro, user_id 1966609774.\"\n\nüîπ Salida Correcta:\n\n[\n{\n\"User_id\": 1966609774,\n\"Nombre\": \"Pedro\",\n\"Frecuencia\": \"todos los lunes\",\n\"HoraInicio\": \"14:00\",\n\"Medicamento\": \"Advil\",\n\"Cantidad\": \"1 tableta\"\n},\n{\n\"User_id\": 1966609774,\n\"Nombre\": \"Pedro\",\n\"Frecuencia\": \"todos los mi√©rcoles\",\n\"HoraInicio\": \"14:00\",\n\"Medicamento\": \"Advil\",\n\"Cantidad\": \"1 tableta\"\n},\n{\n\"User_id\": 1966609774,\n\"Nombre\": \"Pedro\",\n\"Frecuencia\": \"todos los viernes\",\n\"HoraInicio\": \"14:00\",\n\"Medicamento\": \"Advil\",\n\"Cantidad\": \"1 tableta\"\n}\n]\n\nsi en la entrada dice Cancelar:\n[\n{\n\"User_id\": \"ID √∫nico del usuario\",\n\"Nombre\": \"Nombre del usuario\",\n\"Frecuencia\": \"Frecuencia del recordatorio, solo si no se encuentra entonces envias todos los d√≠as\",\n\"HoraInicio\": \"Hora exacta del recordatorio\",\n\"Medicamento\": \"Nombre del medicamento\",\n\"Cantidad\": \"Dosis del medicamento\"\n}\n]\n\nsi en la entrada dice o es sobre consultar o ver los recordatorios activos o creados, envias los datos que te lleguen, ejemplo:\n[{\n\"User_id\": \"ID √∫nico del usuario\",\n\"Nombre\": \"Nombre del usuario\",\n\"Medicamento\": \"Nombre del medicamento\",\n\"Cantidad\": \"Dosis del medicamento\"\n}\n]\n\n‚ùå Errores a Evitar\nüö´ No enviar texto adicional, comentarios o bloques de c√≥digo.\nüö´ No omitir ninguna de las claves del JSON estandarizado.\nüö´ No enviar horarios no especificados en la solicitud.\n\nüìÖ Fecha y hora actual: {{ new Date().toLocaleString('es-CO', { timeZone: 'America/Mexico_City' }) }}\n\nüìù Instrucciones Finales\nExtrae los datos de la solicitud del usuario.\n\nConvierte la frecuencia para recibir que dias se debe de tomar si es necesario: ejemplo si no hay un dia en especifico, pones frecuencia todos los dias, ejemplo: (diaria, cada 8 horas, en las ma√±anas, etc) siempre pondras todos los dias.\n\nGenera un objeto JSON con todos los recordatorio, asegur√°ndote de que est√© correctamente formateado y no falte ninguna clave.\n\nEnv√≠a solo el JSON limpio, sin texto adicional, comentarios o bloques de c√≥digo.\n\n### Caracter√≠sticas clave del prompt:\n\n1. **Solo JSON limpio**: El agente enviar√° √∫nicamente el JSON, sin texto adicional, comentarios o bloques de c√≥digo.\n2. **Un JSON con los recordatorios**: Cada recordatorio se enviar√° como un objeto dentro del JSON.\n3. **Estructura clara**: El JSON sigue una estructura espec√≠fica y evita errores comunes como omitir claves o enviar horarios no especificados.\n\nSi un dato no se especifica lo envias vacio, siempre debes tratar de extraer el nombre del Medicamento si se especifica, nunca envies respuestas con datos quemados, ejemplo: \"Medicamento\": \"Nombre del medicamento\", si no lo encuentras se envia vacio.\n\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        340,
        520
      ],
      "id": "3f2bd1c6-b495-4556-a603-3f66591285e8",
      "name": "Reminder_Agent",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "jsCode": "const inputData = $input.first().json.output;\n\n// Convertir la cadena JSON a un objeto JavaScript\nconst parsedData = JSON.parse(inputData);\n\n// Retornar el JSON limpio\nreturn parsedData;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        660,
        520
      ],
      "id": "8d2b1cb3-2505-4a46-8c65-959fce3a0b81",
      "name": "Code"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        1480,
        640
      ],
      "id": "621087cc-56e1-455f-91cf-470cc216c107",
      "name": "Loop Over Items1",
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "772ee0ed-a2dd-4c77-ac27-7f7b9e158e35",
                    "leftValue": "{{ $('Multi_Agent_Call').item.json.query }}",
                    "rightValue": "Consultar todos",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "todos"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Multi_Agent_Call').item.json.query }}",
                    "rightValue": "=Consultar",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    },
                    "id": "d9799a60-845c-4893-87f4-8af65e9c5668"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Consultar"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "f84ed70e-6c81-4838-b3e6-cfd456e51687",
                    "leftValue": "={{ $('Multi_Agent_Call').item.json.query }}",
                    "rightValue": "Cancelar",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Cancelar"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "b9d70d96-38c5-4798-aa17-92d8c11c19e8",
                    "leftValue": "={{ $('Multi_Agent_Call').item.json.query }}",
                    "rightValue": "Crea",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Crear"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        880,
        500
      ],
      "id": "f0a5459d-4d8a-46b4-851d-35a22f58e03f",
      "name": "Switch"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        1720,
        420
      ],
      "id": "e0c1a659-489a-4bbd-9796-32789cb0e7a4",
      "name": "Loop Over Items2"
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "Medicamentos"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        2600,
        420
      ],
      "id": "9bfb1117-d03c-4c3b-b30d-771281e78e03",
      "name": "Aggregate"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "54e0277b-feae-4b00-a60f-0262c6a77ead",
              "leftValue": "={{ $json.HoraInicio }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "empty",
                "singleValue": true
              }
            },
            {
              "id": "7d0628a3-4947-4a5a-8f6f-80ebbefa25c1",
              "leftValue": "={{ $json.Medicamento }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "empty",
                "singleValue": true
              }
            },
            {
              "id": "3f7670ab-2274-47ef-bbbf-51e333ff4b39",
              "leftValue": "={{ $json.Frecuencia }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1280,
        640
      ],
      "id": "742e359b-d2bd-4461-bf42-ae1f04cb1e9d",
      "name": "If"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "cce9e34e-cb71-4309-848c-7e2d94c89b88",
              "leftValue": "={{ $json.medicamento }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1940,
        440
      ],
      "id": "1de452ec-e80c-44cf-ada8-416c9909a43c",
      "name": "If2"
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "{\n  \"Medicamentos\": \"No se proporciono el nombre del Medicamento, por favor incluyalo y especifica bien el nombre del medicamento\",\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2360,
        460
      ],
      "id": "443a0b2c-fa59-4f4f-9ac5-7d959f303ccd",
      "name": "response_X"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1hiUwqtRuICOd3Xu-6TkEoRh1P_jz3svWGiDk6zvKQPQ",
          "mode": "list",
          "cachedResultName": "Recordatorios Whatsapp",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1hiUwqtRuICOd3Xu-6TkEoRh1P_jz3svWGiDk6zvKQPQ/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2115264411,
          "mode": "list",
          "cachedResultName": "n8n",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1hiUwqtRuICOd3Xu-6TkEoRh1P_jz3svWGiDk6zvKQPQ/edit#gid=2115264411"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "User_id",
              "lookupValue": "={{ $json.User_id }}"
            },
            {
              "lookupColumn": "medicamento",
              "lookupValue": "={{ $json.Medicamento }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        1500,
        420
      ],
      "id": "684fa595-4ef5-462d-a934-83667098576a",
      "name": "Buscar",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "VlwvwMWj6xOw815v",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1hiUwqtRuICOd3Xu-6TkEoRh1P_jz3svWGiDk6zvKQPQ",
          "mode": "list",
          "cachedResultName": "Recordatorios Whatsapp",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1hiUwqtRuICOd3Xu-6TkEoRh1P_jz3svWGiDk6zvKQPQ/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2115264411,
          "mode": "list",
          "cachedResultName": "n8n",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1hiUwqtRuICOd3Xu-6TkEoRh1P_jz3svWGiDk6zvKQPQ/edit#gid=2115264411"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "User_id",
              "lookupValue": "={{ $json.User_id }}"
            },
            {
              "lookupColumn": "frecuencia",
              "lookupValue": "={{ $json.Frecuencia }}"
            },
            {
              "lookupColumn": "medicamento",
              "lookupValue": "={{ $json.Medicamento }}"
            },
            {
              "lookupColumn": "hora de inicio",
              "lookupValue": "={{ $json.HoraInicio }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        1720,
        620
      ],
      "id": "9d70eae4-db02-49cb-866f-2047f1610d3e",
      "name": "Filtrar",
      "alwaysOutputData": false,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "VlwvwMWj6xOw815v",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "delete",
        "documentId": {
          "__rl": true,
          "value": "1hiUwqtRuICOd3Xu-6TkEoRh1P_jz3svWGiDk6zvKQPQ",
          "mode": "list",
          "cachedResultName": "Recordatorios Whatsapp",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1hiUwqtRuICOd3Xu-6TkEoRh1P_jz3svWGiDk6zvKQPQ/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2115264411,
          "mode": "list",
          "cachedResultName": "n8n",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1hiUwqtRuICOd3Xu-6TkEoRh1P_jz3svWGiDk6zvKQPQ/edit#gid=2115264411"
        },
        "startIndex": "={{ $json.row_number }}"
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        1940,
        640
      ],
      "id": "e1f04a33-429d-4ca3-b55b-313a1ae2587f",
      "name": "Eliminar",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "VlwvwMWj6xOw815v",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "dd56e7d2-f812-4619-bed7-d99c74d77440",
              "name": "response",
              "value": "=Recordatorios encontrados: {{ $json.Medicamentos }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2800,
        420
      ],
      "id": "dcca199c-fe90-401e-921c-4222ac5b991f",
      "name": "response"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "433d7d41-fb16-453c-8f26-0ba25ab7ab1b",
              "name": "Medicamentos",
              "value": "={{ $json.medicamento }},  {{ $json.Cantidad }}, {{ $json.frecuencia }} a las {{ $json[\"hora de inicio\"] }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2140,
        420
      ],
      "id": "1b52ecdd-bf5c-44a0-a178-94bdcf19eb17",
      "name": "response_ok"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        1720,
        180
      ],
      "id": "5808b7e0-a6a4-4149-977b-974aeee76e5d",
      "name": "Loop Over Items3"
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "Medicamentos"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        2600,
        160
      ],
      "id": "f8292967-f330-4292-91e7-ac5c54336fe7",
      "name": "Aggregate1"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1hiUwqtRuICOd3Xu-6TkEoRh1P_jz3svWGiDk6zvKQPQ",
          "mode": "list",
          "cachedResultName": "Recordatorios Whatsapp",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1hiUwqtRuICOd3Xu-6TkEoRh1P_jz3svWGiDk6zvKQPQ/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2115264411,
          "mode": "list",
          "cachedResultName": "n8n",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1hiUwqtRuICOd3Xu-6TkEoRh1P_jz3svWGiDk6zvKQPQ/edit#gid=2115264411"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "User_id",
              "lookupValue": "={{ $json.User_id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        1500,
        180
      ],
      "id": "1af22e98-c463-4ccf-99f0-9383988cbf2d",
      "name": "Buscar1",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "VlwvwMWj6xOw815v",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "dd56e7d2-f812-4619-bed7-d99c74d77440",
              "name": "response",
              "value": "=Recordatorios encontrados: {{ $json.Medicamentos }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2800,
        160
      ],
      "id": "4ee99eb6-5359-41d4-b364-01b029dc0a2d",
      "name": "response1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "433d7d41-fb16-453c-8f26-0ba25ab7ab1b",
              "name": "Medicamentos",
              "value": "={{ $json.medicamento }},  {{ $json.Cantidad }}, {{ $json.frecuencia }} a las {{ $json[\"hora de inicio\"] }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2140,
        160
      ],
      "id": "75b90eaf-a6e9-4c0d-b0fd-9fae1c2b2ac4",
      "name": "response_ok1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "7d0628a3-4947-4a5a-8f6f-80ebbefa25c1",
              "leftValue": "={{ $json.Medicamento }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "empty",
                "singleValue": true
              }
            },
            {
              "id": "b54b3827-bfdd-439f-937f-e718a4d561b5",
              "leftValue": "={{ $('Multi_Agent_Call').item.json.query }}",
              "rightValue": "Consultar todos",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1280,
        420
      ],
      "id": "b100e1a6-03e3-455f-8aa4-e911c25c5361",
      "name": "If1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "cce9e34e-cb71-4309-848c-7e2d94c89b88",
              "leftValue": "={{ $json.medicamento }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1940,
        180
      ],
      "id": "55f214c8-bd0c-4665-8c81-02449c230eae",
      "name": "If3"
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "{\n  \"Medicamentos\": \"No hay Recordatorios creados aun para el usuario, solicita si desea crear un nuevo recordatorio\",\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2340,
        160
      ],
      "id": "733530bd-8b44-4dff-b3f6-9d91ea9f5c71",
      "name": "response_X1"
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "Medicamentos"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        2780,
        620
      ],
      "id": "d5493481-4d88-4797-b7f6-bcd9dabf7475",
      "name": "Aggregate2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "dd56e7d2-f812-4619-bed7-d99c74d77440",
              "name": "response",
              "value": "=se han eliminado los Medicamentos: {{ $json.Medicamentos }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2980,
        620
      ],
      "id": "30d2621c-1748-4a7a-be16-da50ed1d23cc",
      "name": "response2"
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "Medicamentos"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        2100,
        880
      ],
      "id": "735d451e-9192-4bd8-ada8-61a21328edbd",
      "name": "Aggregate3"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "dd56e7d2-f812-4619-bed7-d99c74d77440",
              "name": "response",
              "value": "=He creado los Recordatorios para los medicamentos: {{ $json.Medicamentos }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2300,
        880
      ],
      "id": "4dac3160-cd97-40e8-bc1d-634e86f2b5d4",
      "name": "response3"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "433d7d41-fb16-453c-8f26-0ba25ab7ab1b",
              "name": "Medicamentos",
              "value": "={{ $json.medicamento }},  {{ $json.Cantidad }}, {{ $json.frecuencia }} a las {{ $json[\"hora de inicio\"] }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1900,
        880
      ],
      "id": "3ba8b6ff-2eb0-479e-aa20-5ec4e3e4c41c",
      "name": "response_ok2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "433d7d41-fb16-453c-8f26-0ba25ab7ab1b",
              "name": "Medicamentos",
              "value": "={{ $('Filtrar').item.json.medicamento }},  {{ $('Filtrar').item.json.Cantidad }},  {{ $('Filtrar').item.json.frecuencia }} a las {{ $('Filtrar').item.json['hora de inicio'] }} ",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2380,
        640
      ],
      "id": "29a4a832-272d-4000-91e2-425a583006d6",
      "name": "response_ok3"
    },
    {
      "parameters": {
        "content": "## EXTACTOR DE DATOS \n\n** Extae los datos del medicamento y  formatea el json",
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        360,
        300
      ],
      "id": "cef8acef-ceaf-4b65-bd2c-476d7dc5c9b9",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "=user_{{$json[\"query\"].split(\"user_id: \")[1].split(\",\")[0]}}",
        "tableName": "set_reminder_history",
        "contextWindowLength": 10
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        480,
        740
      ],
      "id": "5d46c173-5053-4695-bf13-92cad3db6e77",
      "name": "Postgres Chat Memory",
      "credentials": {
        "postgres": {
          "id": "a1cqjsRZKit72vEz",
          "name": "Supabase"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "bc842499-0cf5-4488-a643-e80663cd3434",
              "leftValue": "={{ $json.success }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2140,
        640
      ],
      "id": "0321f707-babf-4e5c-975d-c2318f504503",
      "name": "If4"
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "{\n  \"Medicamentos\": \"No se elimino ningun medicamento, confirma cual medicamento exactamente quieres eliminar\",\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2600,
        660
      ],
      "id": "4c9a5f64-8a52-4195-be61-d319fd3749f8",
      "name": "response_X2"
    }
  ],
  "pinData": {},
  "repo_name": "flujos_n8n",
  "repo_owner": "whitelabel-ai",
  "repo_path": "Angela/",
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "createdAt": "2025-04-02T21:00:25.027Z",
      "updatedAt": "2025-04-02T21:00:25.027Z",
      "id": "4Z9BlXLNysnGHcBB",
      "name": "Produccion"
    }
  ],
  "triggerCount": 0,
  "updatedAt": "2025-06-28T16:42:02.232Z",
  "versionId": "39d121bb-aa99-489f-b8d7-0c114dd3f7bb"
}