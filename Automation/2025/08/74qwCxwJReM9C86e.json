{
  "active": true,
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "ChatwootData",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "type message Whatsap": {
      "main": [
        [
          {
            "node": "Convert to File",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ],
        [],
        []
      ]
    },
    "DataText": {
      "main": [
        [
          {
            "node": "setData",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "No Operation, do nothing4": {
      "main": [
        [
          {
            "node": "DataText",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DataAudio": {
      "main": [
        [
          {
            "node": "setData",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ChatwootData": {
      "main": [
        [
          {
            "node": "initData",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "whatsappData": {
      "main": [
        [
          {
            "node": "initData",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "whatsap trigger": {
      "main": [
        [
          {
            "node": "whatsappData",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "initData": {
      "main": [
        [
          {
            "node": "type message Whatsap",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "setData": {
      "main": [
        [
          {
            "node": "Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Transcribe a recording1": {
      "main": [
        [
          {
            "node": "DataAudio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Data": {
      "main": [
        [
          {
            "node": "Qubra",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Qubra",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Redis Chat Memory1": {
      "ai_memory": [
        [
          {
            "node": "Qubra",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Message a model1": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Qubra": {
      "main": [
        [
          {
            "node": "Message a model1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ChatwootData",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generar Informe": {
      "ai_tool": [
        [
          {
            "node": "Qubra",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File": {
      "main": [
        [
          {
            "node": "Transcribe a recording1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "No Operation, do nothing": {
      "main": [
        [
          {
            "node": "No Operation, do nothing4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-08-20T15:34:51.644Z",
  "id": "74qwCxwJReM9C86e",
  "isArchived": false,
  "meta": null,
  "name": "Qubra",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "Qubra",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -336,
        1024
      ],
      "id": "4c2efc7a-dcaf-43d4-a78a-0ba7b053ee4b",
      "name": "Webhook",
      "webhookId": "1b2e128a-f193-4501-bd75-f31116e4e7da"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.tipo_mensaje }}",
                    "rightValue": "audio",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "38cdad62-0d9c-45bc-860e-9e03d107ba58"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "audio"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "82df4052-c480-44a2-9d09-c195d4bc6879",
                    "leftValue": "={{ $json.tipo_mensaje }}",
                    "rightValue": "text",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "text"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "d9c1a8cf-af4e-4bca-a66c-184829c009d8",
                    "leftValue": "={{ $json.tipo_mensaje }}",
                    "rightValue": "=file",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "document"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "71778507-22f2-4e0f-99d7-fdd87ed1f26b",
                    "leftValue": "={{ $json.tipo_mensaje }}",
                    "rightValue": "image",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "image"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        336,
        896
      ],
      "id": "f2539b49-2e38-452b-9382-9a244b0e6b8d",
      "name": "type message Whatsap"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9f69a465-0cc7-43dd-97d7-aaee90bacbe3",
              "name": "nombre",
              "value": "={{ $('initData').item.json.nombre }}",
              "type": "string"
            },
            {
              "id": "82031891-32ae-4442-b883-fad57ad08c79",
              "name": "phone_number",
              "value": "={{ $('initData').item.json.phone_number }}",
              "type": "string"
            },
            {
              "id": "8c4da55a-b196-497b-a9ef-c0ce734b8847",
              "name": "mensaje",
              "value": "={{ $('initData').item.json.mensaje }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1008,
        1024
      ],
      "id": "aaa68fd5-1aa1-4db9-b6c1-710c528a4ba7",
      "name": "DataText"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        784,
        1024
      ],
      "id": "754f4c8a-e4b5-442a-ada0-3e2753b9e40d",
      "name": "No Operation, do nothing4"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9f69a465-0cc7-43dd-97d7-aaee90bacbe3",
              "name": "nombre",
              "value": "={{ $('initData').item.json.nombre }}",
              "type": "string"
            },
            {
              "id": "82031891-32ae-4442-b883-fad57ad08c79",
              "name": "phone_number",
              "value": "={{ $('initData').item.json.phone_number }}",
              "type": "string"
            },
            {
              "id": "8c4da55a-b196-497b-a9ef-c0ce734b8847",
              "name": "mensaje",
              "value": "=<audio>{{ $json.content.parts[0].text }}</audio>",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1008,
        832
      ],
      "id": "7e84117b-b5e7-4aee-a3b8-037b37c1e2e8",
      "name": "DataAudio"
    },
    {
      "parameters": {
        "content": "## Incoming Messages\n",
        "height": 572,
        "width": 704,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -496,
        704
      ],
      "id": "0c740063-6c6f-4a54-9a17-45a42c47069e",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9f69a465-0cc7-43dd-97d7-aaee90bacbe3",
              "name": "nombre",
              "value": "={{ $json.body.conversation.meta.sender.name.split(\" \")[0] }}",
              "type": "string"
            },
            {
              "id": "82031891-32ae-4442-b883-fad57ad08c79",
              "name": "phone_number",
              "value": "={{ $json.body.sessionId }}",
              "type": "string"
            },
            {
              "id": "8c4da55a-b196-497b-a9ef-c0ce734b8847",
              "name": "mensaje",
              "value": "={{ $json.body.message }}",
              "type": "string"
            },
            {
              "id": "01193a9d-40ea-48b1-96f1-592105684644",
              "name": "tipo_mensaje",
              "value": "={{ $json.body.type }}",
              "type": "string"
            },
            {
              "id": "c6b5261d-a252-4328-af15-9699dfc5ba2b",
              "name": "receptor",
              "value": "={{ $json.body.message_type }}",
              "type": "string"
            },
            {
              "id": "8a4d2988-720e-46c1-9927-90f62d5ddd72",
              "name": "tags",
              "value": "={{ $json.body.conversation.labels }}",
              "type": "array"
            },
            {
              "id": "2189dde7-a49e-4226-be25-22f3e62caf99",
              "name": "conversation_id",
              "value": "={{ $json.body.sessionId }}",
              "type": "string"
            },
            {
              "id": "c8242d40-84d3-4c64-adcc-d15b8de57a9a",
              "name": "account_id",
              "value": "={{ $json.body.account.id }}",
              "type": "number"
            },
            {
              "id": "7d6c4435-2ae7-4716-a211-c8d9898dcd48",
              "name": "api_access_token",
              "value": "=AKgj4inXtQC2qoDuxiHxEFtL",
              "type": "string"
            },
            {
              "id": "aad140bb-399a-46df-b78b-98aa0a9fd6e8",
              "name": "=data",
              "value": "={{ $('Webhook').item.binary.audio}}",
              "type": "object"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -112,
        1024
      ],
      "id": "2d004512-c43e-4e90-bc9a-6c7af89a00b1",
      "name": "ChatwootData"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "7fba40fd-13ea-470a-a784-d886fa69b736",
              "name": "account_id",
              "value": "={{ $json.metadata.display_phone_number }}",
              "type": "string"
            },
            {
              "id": "cb120617-0a0f-4b8d-8979-909001725c0d",
              "name": "phone_number_id",
              "value": "={{ $json.metadata.phone_number_id }}",
              "type": "string"
            },
            {
              "id": "5276d674-1b57-4af7-88f3-5f9616e64cc3",
              "name": "nombre",
              "value": "={{ $json.contacts[0].profile.name }}",
              "type": "string"
            },
            {
              "id": "92d97526-26b7-461c-b7ec-7cd13074512e",
              "name": "phone_number",
              "value": "={{ $json.contacts[0].wa_id }}",
              "type": "string"
            },
            {
              "id": "0605a012-1740-4b13-8e7f-57e156ad2fbe",
              "name": "mensaje",
              "value": "={{ $json.messages[0].text.body }}",
              "type": "string"
            },
            {
              "id": "5060779d-87fc-49af-9212-c7972aae9ff0",
              "name": "tipo_mensaje",
              "value": "={{ $json.messages[0].type }}",
              "type": "string"
            },
            {
              "id": "358f4697-0d6f-4184-bfbd-31ff4f2e2ac2",
              "name": "tags",
              "value": "={{ $json.field }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -112,
        832
      ],
      "id": "a813483b-0b60-4515-af63-7fee325d876f",
      "name": "whatsappData"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "whatsap",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -336,
        832
      ],
      "id": "97b5f0b9-399e-45b8-b7b2-eac17de8e4d3",
      "name": "whatsap trigger",
      "webhookId": "6704f599-c49e-4dd2-848c-7d9401baf9a1",
      "disabled": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "cb120617-0a0f-4b8d-8979-909001725c0d",
              "name": "phone_number_id",
              "value": "={{ $json.phone_number_id }}",
              "type": "string"
            },
            {
              "id": "5276d674-1b57-4af7-88f3-5f9616e64cc3",
              "name": "nombre",
              "value": "={{ $json.nombre }}",
              "type": "string"
            },
            {
              "id": "92d97526-26b7-461c-b7ec-7cd13074512e",
              "name": "phone_number",
              "value": "={{ $json.phone_number }}",
              "type": "string"
            },
            {
              "id": "0605a012-1740-4b13-8e7f-57e156ad2fbe",
              "name": "mensaje",
              "value": "={{ $json.mensaje }}",
              "type": "string"
            },
            {
              "id": "5060779d-87fc-49af-9212-c7972aae9ff0",
              "name": "tipo_mensaje",
              "value": "={{ $json.tipo_mensaje }}",
              "type": "string"
            },
            {
              "id": "358f4697-0d6f-4184-bfbd-31ff4f2e2ac2",
              "name": "tags",
              "value": "={{ $json.tags }}",
              "type": "string"
            },
            {
              "id": "d7bd017f-435b-4c5c-89ba-77b2bdd3d56d",
              "name": "account_id",
              "value": "={{ $json.account_id }}",
              "type": "string"
            },
            {
              "id": "5df9085c-2dab-4895-87b6-26f1a70b74c6",
              "name": "conversation_id",
              "value": "={{ $json.conversation_id }}",
              "type": "string"
            },
            {
              "id": "3b0ab472-eb47-486f-87b8-92fe29a4f764",
              "name": "=data",
              "value": "={{ $json.data }}",
              "type": "object"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        112,
        928
      ],
      "id": "c66ef3c9-e9e6-4e04-a1d4-c6be89134de4",
      "name": "initData"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f4f107ad-f4e3-4616-a1ec-515f7324ba23",
              "name": "nombre",
              "value": "={{ $json.nombre }}",
              "type": "string"
            },
            {
              "id": "6f55c6f4-4cb3-4cec-9d31-b956d3fffde0",
              "name": "phone_number",
              "value": "={{ $json.phone_number }}",
              "type": "string"
            },
            {
              "id": "bad14eb8-f005-4d91-bd83-600e6105d974",
              "name": "mensaje",
              "value": "={{ $json.mensaje }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1232,
        928
      ],
      "id": "2c42ce8c-55b2-4cc8-8925-385f9da2515d",
      "name": "setData"
    },
    {
      "parameters": {
        "resource": "audio",
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-flash",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-flash"
        },
        "inputType": "binary",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        784,
        832
      ],
      "id": "3995e152-21f8-4001-b4ac-2e37b3789008",
      "name": "Transcribe a recording1",
      "credentials": {
        "googlePalmApi": {
          "id": "jQiccHfpS9BFKE4C",
          "name": "automation.whitelabel.lat"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "4e6ed31c-2d8f-4415-bdaf-404a870f1cc2",
              "name": "first_name",
              "value": "={{ $('setData').item.json.nombre.split(\" \")[0] }}",
              "type": "string"
            },
            {
              "id": "f312aa42-4354-4954-92ff-9549a49c1d5b",
              "name": "user_id",
              "value": "={{ $('setData').item.json.phone_number }}",
              "type": "string"
            },
            {
              "id": "b89d5418-df60-419b-84f6-5bc7bc0dd09b",
              "name": "message",
              "value": "={{ $json.mensaje }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1456,
        928
      ],
      "id": "9734ecfd-31b0-4cb9-9433-f2d7e86d0402",
      "name": "Data"
    },
    {
      "parameters": {
        "content": "## AGENT MAIN",
        "height": 600,
        "width": 848
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1200,
        704
      ],
      "id": "21e20664-2247-40c9-9305-967c2213399b",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "## RESPONS AGENT",
        "height": 600,
        "width": 696,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        2096,
        688
      ],
      "id": "3dd2c5be-fe60-4346-9c68-13a66f33af22",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-flash-preview-05-20",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        1584,
        1216
      ],
      "id": "b60d1970-e4dc-45b6-bfc1-fbc288529d8b",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "jQiccHfpS9BFKE4C",
          "name": "automation.whitelabel.lat"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "=chat_history_qubra_{{ $('Data').item.json.user_id }}",
        "sessionTTL": 500000,
        "contextWindowLength": 25
      },
      "type": "@n8n/n8n-nodes-langchain.memoryRedisChat",
      "typeVersion": 1.5,
      "position": [
        1760,
        1280
      ],
      "id": "91447d6f-d33b-4d6e-b044-71bc08118a0e",
      "name": "Redis Chat Memory1",
      "credentials": {
        "redis": {
          "id": "yzvE00xFtVHtaoZ1",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "GPT-4O-MINI"
        },
        "messages": {
          "values": [
            {
              "content": "=Divide el siguiente mensaje en hasta **4 partes más pequeñas** solo si es necesario, asegurándote de que cada parte tenga sentido completo.  \n\n### **Reglas:**  \n- Si el mensaje es *corto* (hasta *160 caracteres*), devuélvelo en **una sola parte**.  \n- Si es *mediano* (hasta *400 caracteres*), divídelo en **2 partes**.  \n- Si es *largo* (hasta *600 caracteres*), divídelo en **3 partes**. \n- Si es *muy largo* (más de *600 caracteres*), agrégale una **parte4**.  \n\n- **Evita dividir el mensaje innecesariamente**. Usa la **menor cantidad de partes posible**.  \n- **No cortes oraciones en puntos, comas o conectores** para mantener la coherencia.  \n- **Reemplaza siempre la palabra \"Dosis\" por \"Cantidad\"**.  \n- **No incluyas datos sensibles** en la respuesta, como:  \n  - `user_id: <número>`  \n  - `subscriber_id: <número>`  \n  - `first_name: <nombre>`  \n  - **Elimina estos datos sin dejar rastros.**  \n\n---\n\n### **Formato de Salida:**  \n- Devuelve la respuesta en **formato JSON** con **solo las partes necesarias**.  \n- Usa `\\n\\n` para agregar saltos de línea cuando sea necesario o para mejorar la legibilidad en listas.  \n- **Nunca uses comillas `\"` para resaltar palabras**. En su lugar, usa un solo asterisco: *palabra*.  \n\n#### **Ejemplo de salida:**  \n\n{\n  \"parte1\": \"Texto de la primera parte.\",\n  \"parte2\": \"Texto de la segunda parte.\"\n}\n\nIMPORTANTE:\ncuando detectes que llegue un informecompleto bien estructurado en formato markdoun con titulo... tipo objeto{ ... }: todo lo que llegue dentro de Informe: lo debes enviar en una sola parte, sin cortar nada, ignoras las Reglas de esa parte que contiene el Informe, envias en una sola parte asi:\n\"Informe\": \"todo el contenido que llegue despues\"\n\n{\n  \"parte1\": \"Texto de la primera parte.\",\n  \"parte2\": \"Texto de la segunda parte.\",\n  \"Informe\": \"Texto con todo el contenido del Informe completo\"\n}\n---\n\n### **Mensaje:**  \n\"{{ $json.output }}\" \n\n"
            }
          ]
        },
        "jsonOutput": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        2144,
        928
      ],
      "id": "5c412407-2bab-40e5-87d2-6b444035a7fb",
      "name": "Message a model1",
      "retryOnFail": true,
      "waitBetweenTries": 2000,
      "credentials": {
        "openAiApi": {
          "id": "UYsXoFpwT6Oh1GeF",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json.message.content }}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        2496,
        928
      ],
      "id": "d85573ae-3549-4c4b-82d3-17cfec5120fa",
      "name": "Respond to Webhook"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=mensaje del usuario: \"{{ $json.message }}\",",
        "options": {
          "systemMessage": "=# Identidad de Qubra\n\nEres *Qubra*, el \"Curador Digital\" y agente conversacional oficial de *Vanguardistas*.\nTu misión es guiar a empresarios, dueños de pymes y marcas personales en un *viaje consultivo y estratégico* para descubrir su esencia, diagnosticar sus retos y preparar la información necesaria para que se genere un informe profesional de diagnóstico.\n\nNo eres un chatbot genérico: eres *un consultor empático, estratégico y motivador*, con personalidad artística y profesional.\n\nfecha y hora hoy: {{ $now }}\n\n## Personalidad\n\nCombinas 4 arquetipos:\n\n- 🎨 *Artista Creador:* Usas metáforas y un lenguaje cercano, inspirador, creativo. Ayudas al usuario a “pintar” la esencia de su marca con autenticidad.\n- 📊 *Estratega Analítico:* Haces preguntas inteligentes, detectas patrones, sintetizas con claridad. Desarmas problemas de manera lógica y accesible.\n- 🏗️ *Constructor de Futuro:* Orientas hacia el cambio, mostrando nuevas perspectivas y posibilidades de mejora, evitando soluciones genéricas.\n- 🤝 *Socio Estratégico:* Te pones en los zapatos del usuario, entiendes su negocio y contexto real, y traduces lo complejo en ideas claras y aplicables.\n\nTu tono es *cercano, profesional, claro, estratégico, empático y auténtico*.\n\n---\n\n# Principios Fundamentales de Qubra\n\n✅ *Autenticidad y Propósito:* Cada interacción debe reflejar la singularidad del usuario y conectar con lo que da sentido a su marca. Nunca dar respuestas genéricas ni superficiales.\n✅ *Claridad y Simplicidad (anti-tecnicismos):* Evita jerga técnica o lenguaje frío. Explica siempre en términos humanos y accesibles, para que todo sea comprensible y accionable.\n✅ *Empatía y Validación Emocional:* Reconoce frustraciones, miedos y deseos. No solo valides con frases amables: demuestra comprensión real y genera confianza a través del acompañamiento.\n✅ *Disrupción y Perspectivas Únicas:* No te limites a repetir problemas. Muestra nuevas formas de ver el negocio, oportunidades inesperadas y caminos personalizados.\n✅ *Socio Estratégico:* Habla como un aliado del negocio, vinculando siempre el diagnóstico con la vida real del usuario (ventas, clientes, tiempo, esfuerzo).\n\n❌ Nunca usar un tono vendedor agresivo.\n❌ Nunca ofrecer soluciones enlatadas o impersonales.\n❌ Nunca abrumar con exceso de información.\n❌ Nunca juzgar o minimizar las respuestas del usuario.\n\n---\n\n# Objetivo de Qubra\n\n1. Guiar al usuario en una conversación diagnóstica estructurada, para descubrir su realidad actual en marketing, procesos y tecnología.\n2. Responder preguntas sobre Vanguardistas y su metodología cuando sea necesario.\n3. Capturar todas las respuestas del usuario, validarlas y almacenarlas en memoria, para luego enviarlas a la `tool` *Generar Informe*.\n4. Al final, invitar al usuario a recibir su informe por email y pedir el correo de contacto.\n\n---\n\n# Flujo General de Conversación\n\n## Etapa 1 – Retratar (Expresionista 🎨)\n(El objetivo aquí es conectar con la verdad emocional y el propósito de la marca, tal como lo hace el Expresionismo.)\n-*Inicio:*\n\n  -Da la bienvenida cálida y presenta a Qubra como el consultor digital de Vanguardistas.\n  -  Pide *nombre, empresa y correo* de manera amable para personalizar la experiencia.\n\n-  *Preguntas guía para descubrir esencia y visión:*\n\n  1. “¿Qué es lo que te inspira a trabajar cada día?”\n  2. “¿Qué vendes y a qué sector te diriges? (ejemplo: servicios de consultoría para empresas, productos de bienestar, formación presencial, etc.)”\n  3. “¿Qué emociones quieres que tu marca transmita a tus clientes?”\n\n-  *Claves:*\n\n  -  Validar siempre la respuesta con empatía, reconociendo tanto aspiraciones como miedos, pero un feedback muy corto.\n  -  Usar metáforas artísticas para resaltar lo valioso de cada respuesta. Ejemplo: “Lo que me cuentas es como los colores base de un lienzo: esenciales para pintar la identidad de tu marca”.\n  -  Mantener un tono inspirador, curioso y cercano.\n\n---\n\n## Etapa 2 – Descomponer (Cubista 🧩)\n\n-  *Objetivo:* identificar retos actuales en ventas, conocimiento del cliente y visibilidad digital.\n(En esta fase, se desglosa el negocio para obtener una visión multidimensional, al estilo Cubista.)\n\n-  *Preguntas guía:*\n\n  1. “¿Cuál es el principal problema que enfrentas con respecto a tus ventas hoy?”\n  2. “¿Hasta qué punto conoces a profundidad a tu cliente ideal y el problema específico que [marca/empresa] resuelve para ellos?”\n  3. “¿Cómo describirías la experiencia que tus clientes viven al interactuar con tu marca?”\n  4. “¿Qué tan visible eres a nivel digital?”\n\n-  *Claves:*\n\n  -  Reconocer con empatía cualquier frustración. Ejemplo: “Entiendo lo que dices, muchas empresas sienten esa presión, pero también revela una oportunidad de cambio”.\n  -  Reflexionar un “fragmento de oportunidad” después de cada respuesta.\n  -  Mantener la conversación fluida, evitando sonar a cuestionario rígido.\n  -  Organizar mentalmente cada respuesta por categorías: *ventas, cliente ideal, experiencia, visibilidad*.\n\n---\n\n## Etapa 3 – Reinterpretar (Constructivista 🏗️)\n\n-  *Objetivo:* proyectar futuro y motivar acción.\n(Aquí se recopila la información necesaria para diseñar una solución, como un artista Constructivista.)\n\n-  *Preguntas guía:*\n\n  1. “¿Qué objetivo refleja mejor lo que quieres lograr con tu marca a nivel digital?”\n  2. “¿Cuáles son los recursos existentes que cuentas actualmente para mejorar tu presencia digital?”\n  3. “Cuando mires atrás, ¿qué te hará sentir que este proceso ha sido un éxito para tu negocio?”\n\n-  *Claves:*\n\n  -  Resumir lo aprendido en tono claro y motivador, como un socio que acompaña y entiende el negocio.\n  -  Evitar soluciones genéricas: mostrar siempre caminos personalizados.\n  -  Explicar que Vanguardistas generará un *Informe Diagnóstico* con un mini plan de acción.\n  -Pedir confirmación del *email de contacto* para enviar el informe.\n  -Cerrar (muy brevemente, respuesta corta) agradeciendo y destacando que el informe será un mapa inicial y único para impulsar su negocio.\n  - El feedback para el usuario debe ser muy breve, corto.\n---\n\n# Manejo de Preguntas del Usuario\n\n- *Si la pregunta es sobre la metodología o la empresa:* usa la `tool` *Buscar en Documentación (RAG)* para responder con precisión y sencillez.\n- *Si la pregunta es fuera de contexto:* redirige con cortesía hacia la conversación diagnóstica. Ejemplo:\n\n  > “Es un tema interesante. Para darte un diagnóstico útil para tu negocio, ¿te parece si seguimos explorando tu presencia digital?”\n\n---\n\n# Reglas de Qubra\n\n✅ Siempre guiar la conversación hacia el diagnóstico.\n✅ Ser empático y profesional, nunca robótico ni vendedor agresivo.\n✅ Reconocer frustraciones y esperanzas, mostrando comprensión real.\n✅ Recordar el contexto completo y usar referencias a respuestas previas.\n✅ Guardar y estructurar respuestas en memoria, para enviarlas a la `tool` Generar Informe.\n✅ Pedir y validar el correo antes de finalizar la sesión.\n✅ Mantener el tono Vanguardista: humano, estratégico, artístico, inspirador y auténtico.\n\n❌ Nunca dar un diagnóstico final dentro del chat (eso lo hace la tool del informe).\n❌ Nunca improvisar información que no esté en la documentación de Vanguardistas.\n❌ Nunca terminar la conversación sin ofrecer el próximo paso (el informe).\n\n---\n\n# Tools disponibles\n\n1. *Generar Informe:* recibe el historial completo de conversación (preguntas y respuestas) y crea el informe diagnóstico para el usuario.\n2. *Buscar en Documentación (RAG):* permite consultar la documentación de Vanguardistas para responder preguntas de proceso/metodología.\n3. *Guardar Progreso en DB (opcional):* guarda estado de respuestas en caso de desconexión del chat.\n\n---\n\n# Instrucciones técnicas\n\n- Mantén toda la información del usuario organizada en un objeto estructurado (ejemplo JSON) con campos:\n\n  - `nombre`\n  - `empresa`\n  - `correo`\n  - `respuestas_marketing`\n  - `respuestas_procesos`\n  - `respuestas_tecnologia`\n  - `respuestas_propósito`\n  - `preguntas_extra`\n\n- Una vez el usuario haya respondido lo suficiente, *invoca la tool Generar Informe* enviando el historial de conversación + datos estructurados.\nIMPORTANTE, Si faltan respuestas para alguna etapa, Qubra nunca debe mandar a la tool. Debe detectar huecos y pedir lo que falta con calidez.\n\n- Cierra siempre agradeciendo, resaltando lo valioso de las respuestas del usuario(muy brevemente, corto) y confirmando el envío del informe al correo que el usuario te confirmo y dices algo como espera 1 minuto estamos generando tu diagnostigo.\n- anexa la respuesta de la tool Generar Informe, al final despues del cierre, ejemplo:\n  \"mensaje cierre\"\n  Informe: \"todo el contenido del informe sin modificar nada\"\n\nIMPORTANTE siempre antes de dar el cierre invoca la tool *Generar Informe*"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        1744,
        928
      ],
      "id": "d9e3f58e-da1a-4ef7-8976-e5c0fef0f572",
      "name": "Qubra",
      "retryOnFail": true,
      "waitBetweenTries": 3000,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "description": "cuando tengas las respuestas completas del usuario llama esta tool para generar el informe.",
        "workflowId": {
          "__rl": true,
          "value": "kU6PQmiycPyk0PMH",
          "mode": "list",
          "cachedResultName": "informe"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "¿Qué es lo que te inspira a trabajar cada día?": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('_Qu__es_lo_que_te_inspira_a_trabajar_cada_d_a_', `respuesta del usuario a la pregunta ¿Qué es lo que te inspira a trabajar cada día?`, 'string') }}",
            "user_name": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('user_name', ``, 'string') }}",
            "user_email": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('user_email', ``, 'string') }}",
            "user_empresa": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('user_empresa', `nombre de la empresa del usuario`, 'string') }}",
            "¿Qué vendes y a qué sector te diriges?": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('_Qu__vendes_y_a_qu__sector_te_diriges_', `respuesta del usuario a la pregunta Qué vendes y a qué sector te diriges?`, 'string') }}",
            "¿Qué emociones quieres que tu marca transmita a tus clientes?": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('_Qu__emociones_quieres_que_tu_marca_transmita_a_tus_clientes_', `respuesta del usuario a la pregunta ¿Qué emociones quieres que tu marca transmita a tus clientes?`, 'string') }}",
            "¿Hasta qué punto conoces a profundidad a tu cliente ideal y el problema específico que tu marca/empresa resuelve para ellos?": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('_Hasta_qu__punto_conoces_a_profundidad_a_tu_cliente_ideal_y_el_', `respuesta del usuario a la pregunta ¿Hasta qué punto conoces a profundidad a tu cliente ideal y el problema específico que tu marca/empresa resuelve para ellos?`, 'string') }}",
            "¿Cómo describirías la experiencia que tus clientes viven al interactuar con tu marca?": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('_C_mo_describir_as_la_experiencia_que_tus_clientes_viven_al_int', `respuesta del usuario a la pregunta ¿Cómo describirías la experiencia que tus clientes viven al interactuar con tu marca?`, 'string') }}",
            "¿Qué tan visible eres a nivel digital?": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('_Qu__tan_visible_eres_a_nivel_digital_', `respuesta del usuario a la pregunta`, 'string') }}",
            "¿Qué objetivo refleja mejor lo que quieres lograr con tu marca a nivel digital?": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('_Qu__objetivo_refleja_mejor_lo_que_quieres_lograr_con_tu_marca_', `respuesta del usuario a la pregunta ¿Qué tan visible eres a nivel digital?`, 'string') }}",
            "¿Cuáles son los recursos existentes que cuentas actualmente para mejorar tu presencia digital?": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('_Cu_les_son_los_recursos_existentes_que_cuentas_actualmente_par', `respuesta del usuario a la pregunta ¿Qué objetivo refleja mejor lo que quieres lograr con tu marca a nivel digital?`, 'string') }}",
            "Cuando mires atrás, ¿qué te hará sentir que este proceso ha sido un éxito para tu negocio?": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Cuando_mires_atr_s___qu__te_har__sentir_que_este_proceso_ha_sid', `respuesta del usuario a la pregunta ¿Cuáles son los recursos existentes que cuentas actualmente para mejorar tu presencia digital?`, 'string') }}",
            "¿Cuál es el principal problema que enfrentas con respecto a tus ventas hoy?": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('_Cu_l_es_el_principal_problema_que_enfrentas_con_respecto_a_tus', `respuesta del usuario a la pregunta \n¿Cuál es el principal problema que enfrentas con respecto a tus ventas hoy?`, 'string') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "user_name",
              "displayName": "user_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "user_email",
              "displayName": "user_email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "user_empresa",
              "displayName": "user_empresa",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "¿Qué es lo que te inspira a trabajar cada día?",
              "displayName": "¿Qué es lo que te inspira a trabajar cada día?",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "¿Qué vendes y a qué sector te diriges?",
              "displayName": "¿Qué vendes y a qué sector te diriges?",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "¿Qué emociones quieres que tu marca transmita a tus clientes?",
              "displayName": "¿Qué emociones quieres que tu marca transmita a tus clientes?",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "¿Cuál es el principal problema que enfrentas con respecto a tus ventas hoy?",
              "displayName": "¿Cuál es el principal problema que enfrentas con respecto a tus ventas hoy?",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "¿Hasta qué punto conoces a profundidad a tu cliente ideal y el problema específico que tu marca/empresa resuelve para ellos?",
              "displayName": "¿Hasta qué punto conoces a profundidad a tu cliente ideal y el problema específico que tu marca/empresa resuelve para ellos?",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "¿Cómo describirías la experiencia que tus clientes viven al interactuar con tu marca?",
              "displayName": "¿Cómo describirías la experiencia que tus clientes viven al interactuar con tu marca?",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "¿Qué tan visible eres a nivel digital?",
              "displayName": "¿Qué tan visible eres a nivel digital?",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "¿Qué objetivo refleja mejor lo que quieres lograr con tu marca a nivel digital?",
              "displayName": "¿Qué objetivo refleja mejor lo que quieres lograr con tu marca a nivel digital?",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "¿Cuáles son los recursos existentes que cuentas actualmente para mejorar tu presencia digital?",
              "displayName": "¿Cuáles son los recursos existentes que cuentas actualmente para mejorar tu presencia digital?",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "Cuando mires atrás, ¿qué te hará sentir que este proceso ha sido un éxito para tu negocio?",
              "displayName": "Cuando mires atrás, ¿qué te hará sentir que este proceso ha sido un éxito para tu negocio?",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        1952,
        1248
      ],
      "id": "1cbd9f54-8144-4ba4-b45c-8b133829abcc",
      "name": "Generar Informe"
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "data.data",
        "binaryPropertyName": "=data",
        "options": {
          "fileName": "={{ $json.data.fileName }}",
          "mimeType": "={{ $json.data.mimeType }}"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        560,
        832
      ],
      "id": "b931c39c-441f-4a4c-a54e-91ecebc82def",
      "name": "Convert to File"
    },
    {
      "parameters": {
        "content": "## audio/text\n",
        "height": 588,
        "width": 896,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        272,
        704
      ],
      "id": "e44d5981-f9d5-4c48-b7ee-98af3f08c2c2",
      "name": "Sticky Note"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        560,
        1024
      ],
      "id": "4eac55cf-5202-422d-b00d-150db36c4580",
      "name": "No Operation, do nothing"
    }
  ],
  "pinData": {
    "whatsap trigger": [
      {
        "json": {
          "messaging_product": "whatsapp",
          "metadata": {
            "display_phone_number": "573143400476",
            "phone_number_id": "735679592965149"
          },
          "contacts": [
            {
              "profile": {
                "name": "Pedro Rodriguez"
              },
              "wa_id": "573228854498"
            }
          ],
          "messages": [
            {
              "from": "573228854498",
              "id": "wamid.HBgMNTczMjI4ODU0NDk4FQIAEhgUM0ZCOUNFRjE5M0FFNzZENzAxQUEA",
              "timestamp": "1755298718",
              "text": {
                "body": "organizar gastos"
              },
              "type": "text"
            }
          ],
          "field": "messages"
        }
      }
    ],
    "Webhook": [
      {
        "json": {
          "headers": {
            "host": "automation.whitelabel.lat",
            "user-agent": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36",
            "content-length": "1269",
            "accept": "*/*",
            "accept-encoding": "gzip, deflate, br, zstd",
            "accept-language": "es-419,es;q=0.9",
            "content-type": "application/json",
            "origin": "https://vanguardistas.co",
            "priority": "u=1, i",
            "referer": "https://vanguardistas.co/",
            "sec-ch-ua": "\"Not;A=Brand\";v=\"99\", \"Brave\";v=\"139\", \"Chromium\";v=\"139\"",
            "sec-ch-ua-mobile": "?0",
            "sec-ch-ua-platform": "\"Linux\"",
            "sec-fetch-dest": "empty",
            "sec-fetch-mode": "cors",
            "sec-fetch-site": "cross-site",
            "sec-gpc": "1",
            "x-forwarded-for": "217.9.247.5",
            "x-forwarded-host": "automation.whitelabel.lat",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "4f3b0c84f963",
            "x-real-ip": "217.9.247.5"
          },
          "params": {},
          "query": {},
          "body": {
            "message": "For me, the success of this process won't be measured solely by hard numbers, but by the impact we make on our clients' lives. I will have achieved success when, looking back, I see three tangible results:  A community, not just an audience: The greatest indicator of success would be having created a steady stream of \"creators\" who find us, not through advertising, but organically. More importantly, these leads become an active community, where the process of seeking clarity is shared and people recommend Imaginary Oasis as the indispensable tool.  Increase in qualitative conversion: An increase in the number of sales is important, but the real victory would be to see an increase in the conversion rate of our leads to clients. This would tell us that the digital strategy is attracting the right people: those who genuinely need and value the clarity we offer.  Reduction in sales effort: Currently, manual sales funnel management is inefficient. Success would be for the process to be automated, allowing our \"sellers\" (in this case, the brand's systems) to focus on the most valuable part of the experience: co-creating the solution, rather than on manual follow-up.",
            "sessionId": "session_77a77684-ae7e-48a7-b4e6-c3ea42a450f5",
            "type": "text"
          },
          "webhookUrl": "https://automation.whitelabel.lat/webhook/Qubra",
          "executionMode": "production"
        }
      }
    ]
  },
  "repo_name": "flujos_n8n",
  "repo_owner": "whitelabel-ai",
  "repo_path": "Automation/",
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "errorWorkflow": "7CI8d1lC1EC1eqnL"
  },
  "shared": [
    {
      "updatedAt": "2025-08-20T15:34:51.644Z",
      "createdAt": "2025-08-20T15:34:51.644Z",
      "role": "workflow:owner",
      "workflowId": "74qwCxwJReM9C86e",
      "projectId": "jOPTDk8NtR0eZIqG"
    }
  ],
  "staticData": null,
  "tags": [],
  "triggerCount": 1,
  "updatedAt": "2025-09-11T21:15:57.620Z",
  "versionId": "9fdecd2b-4a9e-48a6-9f7c-e06eaf526855"
}