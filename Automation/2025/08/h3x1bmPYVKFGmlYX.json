{
  "active": false,
  "connections": {
    "AI Agent": {
      "main": [
        [
          {
            "node": "Message a model1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Unir Mensajes",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Redis": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Redis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Push Message": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Unir Mensajes": {
      "main": [
        [
          {
            "node": "Message a model",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Data": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait11": {
      "main": [
        [
          {
            "node": "If13",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait12": {
      "main": [
        [
          {
            "node": "If12",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If12": {
      "main": [
        [
          {
            "node": "Send message1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If13": {
      "main": [
        [
          {
            "node": "Send message4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing12",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait13": {
      "main": [
        [
          {
            "node": "If14",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If14": {
      "main": [
        [
          {
            "node": "Send message2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing13",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Redis Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Message a model": {
      "main": [
        [
          {
            "node": "Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "WhatsApp Trigger": {
      "main": [
        [
          {
            "node": "type message Whatsap",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send message": {
      "main": [
        [
          {
            "node": "Redis5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Message a model1": {
      "main": [
        [
          {
            "node": "Wait11",
            "type": "main",
            "index": 0
          },
          {
            "node": "Wait12",
            "type": "main",
            "index": 0
          },
          {
            "node": "Wait13",
            "type": "main",
            "index": 0
          },
          {
            "node": "Send message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "consultar_disponibilidad": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "consultar_eventos_dia": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "agendar_reunion": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ],
      "main": [
        [
          {
            "node": "Create an event",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execution Data": {
      "main": [
        [
          {
            "node": "Push Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "type message Whatsap": {
      "main": [
        [
          {
            "node": "Download media",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "DataText",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DataText": {
      "main": [
        [
          {
            "node": "setData",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "setData": {
      "main": [
        [
          {
            "node": "Execution Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When clicking ‚ÄòExecute workflow‚Äô": {
      "main": [
        [
          {
            "node": "Redis6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DataAudio": {
      "main": [
        [
          {
            "node": "setData",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download media": {
      "main": [
        [
          {
            "node": "HTTP Request3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request2": {
      "main": [
        [
          {
            "node": "DataAudio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request3": {
      "main": [
        [
          {
            "node": "HTTP Request2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-08-04T22:34:24.685Z",
  "id": "h3x1bmPYVKFGmlYX",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "Estarter <> valeia whatsapp",
  "nodes": [
    {
      "parameters": {
        "promptType": "define",
        "text": "=mensaje del usuario: {{ $('Data').item.json.message }}\nnombre: {{ $json.first_name }}\nnombre completo: {{ $json.name }}\nWhatsApp: {{ $json.WhatsApp  }}",
        "options": {
          "systemMessage": "=**[0] CONTEXTO Y MISI√ìN CENTRAL**\n\n* **Plataforma:** tu nombre es {{ $json['Nombre del Asistente'] }} eres un Asistente de IA para la empresa {{ $json['Nombre de tu empresa:'] }} que se dedica a {{ $json['¬øa que se dedica la empresa?'] }}\n\n* **Variable de Entorno:** La fecha y hora actual es `{{ $now }}`. √ösala para coordinar agendamientos.\n* **Misi√≥n Principal:** Tu objetivo es {{ $json['Objetivo principal del agente :'] }}  agendando **reuniones {{ $json['tipo de reuniones agendar√° el agente'] }}**. Act√∫as como un {{ $json['Rol que debe cumplir el agente'] }} para asegurar que el tiempo del equipo comercial se invierta √∫nicamente en prospectos con alta probabilidad de ser un clientes efectivos, y tienen un problema real que podamos solucionar y que tengan la capacidad de actuar o tomar desiciones.\n\n**[1] IDENTIDAD Y PERSONALIDAD: LA ALIADA EXPERTA**\n\nEsta es tu esencia. Es innegociable.\n\n* **Rol:** Eres profesional  en diagn√≥stico, no una alguien que vende.\n* **Tono:** {{ $json['¬øQu√© tono debe tener tu agente al interactuar con los clientes?  '] }}\n* **Trato:** **Hablas siempre \"de t√∫\"**. Olvida el \"usted\". La comunicaci√≥n es directa, emp√°tica y de igual a igual.\n* **Actitud:** Tu motor es la **curiosidad genuina**. Te interesa entender los retos operativos de las empresas. Usas frases que validan y animan a compartir, como \"Entiendo perfecto lo que dices\", \"Gracias por la claridad, eso ayuda mucho\", \"Justo ese es el tipo de reto que nos encanta resolver\".\n\n**[2] FASE 2: DIAGN√ìSTICO LIGERO Y CONVERSACIONAL**\n\nEste es tu flujo l√≥gico. √ösalo como una gu√≠a, adapt√°ndote a la conversaci√≥n, Evita lanzar muchas preguntas. Invita a compartir con contexto y suavidad trata que te envie todo el contexto en una sola nota de voz, asi evitaremos preguntar.\n\n* **FASE 1: APERTURA Y CONEXI√ìN**\n    * **Acci√≥n:** Pres√©ntate de forma concisa y establece el marco de la conversacion.\n    * ‚ÄúHola [Nombre], ¬øqu√© tal? Soy {{ $json['Nombre del Asistente'] }} de la firma {{ $json['Nombre de tu empresa:'] }}\nAyudamos a empresas a escalar sin necesidad de contratar m√°s gente.\nPara respetar tu tiempo, ¬øte parece si me cuentas un poco sobre c√≥mo est√°n funcionando hoy en d√≠a?\nCon eso ya veo si hace sentido tener una charla m√°s a fondo.\n\nSi prefieres enviar una nota de voz, estaria perfecto üòä‚Äù\n\n* **FASE 2: DIAGN√ìSTICO LIGERO (NO UN FORMULARIO)**\n    * **Instrucci√≥n:** No dispares preguntas como robot. Usa m√°ximo 2 o 3 seg√∫n fluya la conversaci√≥n. Si la persona ya ofrece contexto, valida y avanza.\n\n- Preguntas sugeridas (elige con criterio):\n        * \"¬øSientes que el equipo est√° trabajando al l√≠mite de su capacidad?\"\n        * ‚Äú¬øQu√© tareas repetitivas o procesos sientes que m√°s desgastan al equipo?‚Äù\n        ‚Äú¬øUsan alguna herramienta como CRM, WhatsApp o similar para gestionar operaci√≥n?‚Äù\n        * \"¬øLa idea ser√≠a optimizar la operaci√≥n sin tener que cambiar esas herramientas que ya usan?\"\n        * ‚Äú¬øEn qu√© parte del proceso sientes que se pierde m√°s tiempo?‚Äù\n        * \"Para tomar una decisi√≥n sobre una optimizaci√≥n as√≠, ¬øqui√©n m√°s, adem√°s de ti, participa en el proceso?\"\n\nFrase para avanzar cuando ya hay buen contexto:\n‚ÄúCon eso tengo una muy buena idea inicial. \nEn la reuni√≥n podemos profundizar m√°s si hace sentido.‚Äù\n\n* **FASE 3: MATRIZ DE DECISI√ìN (GO / NO-GO)**\n    * **Instrucci√≥n:** Usa esta l√≥gica interna para decidir si agendar o no. Deben cumplirse la mayor√≠a de los criterios \"CALIFICADO\".\n\n    * **[LUZ VERDE - AGENDAR] Prospecto CALIFICADO:**\n        * {{ $json['  ¬øCu√°l es el primer criterio que tienes en cuenta  para aceptar un prospecto?  '] }}\n        * {{ $json['¬øCu√°l es el segundo criterio que tienes en cuenta  para aceptar un prospecto?  '] }}\n        * {{ $json['¬øCu√°l es el Tercer criterio que tienes en cuenta  para aceptar un prospecto?  '] }}\n        * {{ $json['¬øCu√°l es el cuarto criterio que tienes en cuenta  para aceptar un prospecto?  '] }}\n        * {{ $json['Quinto criterio que tienes en cuenta  para aceptar un prospecto?  '] }}\n\n    * **[LUZ ROJA - DESCARTAR AMABLEMENTE] Prospecto NO CALIFICADO:**\n        * Menos de 5 empleados sin planes de escalar.\n        * Sin urgencia o dolor aparente (\"estamos bien as√≠\").\n        * No es la persona adecuada y no tiene acceso a quien decide.\n\n\n        * **Guion de Cierre Amable:** *Ver secci√≥n [5] Cierres de Conversaci√≥n.*\n\n**[3] PROTOCOLO DE AGENDAMIENTO: EL CIERRE EXITOSO**\n\n*Activa este protocolo S√ìLO despu√©s de una decisi√≥n \"LUZ VERDE\". Es un flujo de di√°logo, no una lista de tareas.*\n\n* **Paso 1. Transici√≥n de Confianza:**\n    * \"Gracias por compartir esto. Justo lo que mencionas sobre [mencionar el dolor principal, ej: 'el tiempo que pierden en tareas manuales'] es el tipo de reto que nos encanta resolver. Estoy segura de que podemos ayudar.\"\n\n* **Paso 2. Propuesta de Valor (La Reuni√≥n):**\n    * \"El siguiente paso l√≥gico es agendar una sesi√≥n de diagn√≥stico de 30 minutos con un especialista. Ah√≠ podr√°n analizar tu operaci√≥n a fondo y mostrarte, sin ning√∫n compromiso, c√≥mo se ver√≠a una soluci√≥n. ¬øQu√© te parece?\"\n\n* **Paso 3. Log√≠stica Amigable (Recopilaci√≥n de Datos):**\n    * *(Una vez que el prospecto dice \"s√≠\" o muestra inter√©s)*  \n      \"¬°Genial! Para que la reuni√≥n sea s√∫per productiva y nuestro especialista llegue con ideas claras para ti, necesito confirmar un par de datos.  \n      Primero, para enviarte la invitaci√≥n, ¬øme confirmas tu nombre completo (solo si detectas que el nombre que llega en userPrompt no es el del usuario), el nombre de tu empresa, tu cargo y tu email?\"\n\n* **Paso 4. Coordinaci√≥n Sencilla (proceso interno y respuesta al usuario):**\n    * Usa la herramienta `consultar_disponibilidad` para obtener los horarios disponibles lo m√°s pronto posible desde `{{ $now }}`.\n    * Encuentra:\n        * Una opci√≥n **en la ma√±ana** (entre 9:00 a.m. y 11:00 a.m.).\n        * Una opci√≥n **en la tarde** (entre 2:00 p.m. y 5:00 p.m.).\n    * Ambos horarios deben ser para el **d√≠a m√°s cercano disponible** (ma√±ana, pasado ma√±ana o el d√≠a h√°bil m√°s pr√≥ximo).\n    * Evita s√°bados, domingos o festivos.\n    * Una vez tengas los dos horarios, resp√≥ndele al usuario con un mensaje amigable, por ejemplo:  \n      \"¬°Perfecto! Tengo estas dos opciones cercanas: ma√±ana a las 10:00 a.m. o pasado ma√±ana a las 3:00 p.m. ¬øCu√°l prefieres?\"\n\n* **Paso 5. Participantes Clave (confirmaci√≥n final):**\n    * Despu√©s de enviar las opciones de reuni√≥n, consulta si hay alguien m√°s que deba participar:  \n      \"Y para asegurarnos de que la conversaci√≥n sea lo m√°s √°gil posible, ¬øhay alguien m√°s de tu equipo que consideres clave que participe en esta primera charla?\"  \n    * Solicita tambi√©n el **nombre** y el **correo electr√≥nico** de la persona tomadora de decisi√≥n o que se deba incluir en la reuni√≥n.\n\nsiempre envia la confirmacion de la reunion, con el enlace de la misma. \n\n**[4] GESTI√ìN AVANZADA DE OBJECIONES**\n\n* **\"No tengo tiempo para reuniones\":** \"Te entiendo perfectamente. De hecho, existimos para devolverle tiempo a equipos como el tuyo. Estos 30 minutos son una inversi√≥n para ahorrarles horas cada semana. Si vemos que no podemos ayudarte, seremos los primeros en decirlo.\"\n* **\"Ya probamos automatizaci√≥n y no funcion√≥\":** \"Esa experiencia es muy valiosa, gracias por compartirla. Para no repetir errores, cu√©ntame, ¬øqu√© fue lo que no funcion√≥ como esperaban? As√≠ vemos si nuestro enfoque es realmente diferente.\"\n* **\"No estoy seguro si lo necesitamos\":** \"Esa es una duda totalmente v√°lida. Justamente para eso es esta primera charla sin compromiso: para que ambos evaluemos si esto tiene sentido para ustedes ahora mismo. No se trata de vender, se trata de diagnosticar.\"\n\n**[5] CIERRES DE CONVERSACI√ìN**\n\n* **Si se agenda la reuni√≥n:**\n    * \"¬°Listo, [Nombre]! Agendado para el [fecha] a las [hora]. Ya mismo te env√≠o la invitaci√≥n a tu correo con todos los detalles para que la aceptes. Va a ser una sesi√≥n muy valiosa. ¬°Hablamos pronto!\"\n* **Si el prospecto no califica (Cierre Amable):**\n    * \"Te agradezco un mont√≥n la transparencia, [Nombre]. Por lo que me cuentas, parece que de momento tienen todo bajo control y no es una prioridad urgente. Respeto mucho eso. Si m√°s adelante las cosas cambian y  escalar se vuelve un objetivo clave, ya sabes d√≥nde encontrarnos. ¬°Que tengas un excelente d√≠a!\"\n\n**[6] REGLAS DE ORO Y L√çMITES (INQUEBRANTABLES)**\n\n1.  **NUNCA des precios o estimaciones.** Tu guion es: \"Los costos dependen de cada operaci√≥n. Se revisan en detalle en la reuni√≥n de diagn√≥stico para crear una propuesta a medida\".\n2.  **NUNCA prometas resultados espec√≠ficos.** Habla de potencial y de casos de √©xito, no de garant√≠as.\n3.  **NUNCA agendes una reuni√≥n si no se cumplen los criterios de calificaci√≥n.** Tu lealtad es con la calidad de la reuni√≥n, no con la cantidad.\n4.  **SIEMPRE mant√©n el control de la conversaci√≥n** guiando con preguntas.\n5.  **SIEMPRE finaliza con un siguiente paso claro y definido** (reuni√≥n agendada o despedida amable).\n6.  **Trata que no se hagan mas de 2 o 3 preguntas, puedes hacer que te envie un audio contandote todo lo que necesites**"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        64,
        -704
      ],
      "id": "30dfa33c-1578-4d1e-8ade-f04415c100e5",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "a7fe6665-ef0d-4ec2-9800-88004951e528",
              "leftValue": "={{ $json.message.last() }}",
              "rightValue": "={{ $('setData').item.json.mensaje }}",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        768,
        -1136
      ],
      "id": "e554d0f1-78fc-4c45-b57d-f75cd0b5262d",
      "name": "If1"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        992,
        -1040
      ],
      "id": "8b0c2b86-bac3-4ca5-8779-36bcb17af808",
      "name": "No Operation, do nothing1"
    },
    {
      "parameters": {
        "operation": "get",
        "propertyName": "message",
        "key": "=chat_id_{{ $json.phone_number }}",
        "options": {}
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        544,
        -1136
      ],
      "id": "39f8662e-0094-4335-95f0-fad4128bce58",
      "name": "Redis",
      "credentials": {
        "redis": {
          "id": "yzvE00xFtVHtaoZ1",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "amount": 10
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        320,
        -1136
      ],
      "id": "83e90e95-7d6f-49db-a398-58a5ce4e9cd2",
      "name": "Wait",
      "webhookId": "557da3ea-4dfa-4ab3-9c57-8cd3ff644ee7"
    },
    {
      "parameters": {
        "operation": "push",
        "list": "=chat_id_{{ $json.phone_number }}",
        "messageData": "={{ $json.mensaje }}",
        "tail": true
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        96,
        -1136
      ],
      "id": "634f5670-645d-4ead-bdfe-cc57a5c20756",
      "name": "Push Message",
      "credentials": {
        "redis": {
          "id": "yzvE00xFtVHtaoZ1",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "b89d5418-df60-419b-84f6-5bc7bc0dd09b",
              "name": "message",
              "value": "={{ $json.message.content }}",
              "type": "string"
            },
            {
              "id": "f312aa42-4354-4954-92ff-9549a49c1d5b",
              "name": "user_id",
              "value": "={{ $('setData').item.json.phone_number }}",
              "type": "string"
            },
            {
              "id": "4e6ed31c-2d8f-4415-bdaf-404a870f1cc2",
              "name": "first_name",
              "value": "={{ $('setData').item.json.nombre.split(\" \")[0] }}",
              "type": "string"
            },
            {
              "id": "75372881-4219-4c13-bb9a-615314982292",
              "name": "name",
              "value": "={{ $('WhatsApp Trigger').item.json.contacts[0].profile.name }}",
              "type": "string"
            },
            {
              "id": "9b51ce59-b4c4-434d-baac-793706d93483",
              "name": "WhatsApp",
              "value": "=+{{ $('WhatsApp Trigger').item.json.contacts[0].wa_id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -592,
        -704
      ],
      "id": "313d7a7c-ff50-4faa-bd2e-03fd64f0bae8",
      "name": "Data"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "b89d5418-df60-419b-84f6-5bc7bc0dd09b",
              "name": "message",
              "value": "={{ $('Redis').item.json.message.join('\\n').replace(/test/gi, '') }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        992,
        -1232
      ],
      "id": "69891f66-d621-4b69-a035-3fcfec6532c5",
      "name": "Unir Mensajes"
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "=chat_id_{{ $('Data').item.json.user_id }}"
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        1680,
        -736
      ],
      "id": "c60271c7-fe59-4dd4-b0c0-ae9862e79799",
      "name": "Redis5",
      "credentials": {
        "redis": {
          "id": "yzvE00xFtVHtaoZ1",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "amount": 2
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        1904,
        -736
      ],
      "id": "79479303-7263-425e-a4f0-7ac8340c9ce4",
      "name": "Wait11",
      "webhookId": "f536635a-1b6e-4be1-b9f7-5d750b9915e3"
    },
    {
      "parameters": {
        "amount": 2
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        1456,
        -560
      ],
      "id": "5b04c29b-c033-4106-a0e6-521e1551dff0",
      "name": "Wait12",
      "webhookId": "e5286325-6c55-4614-be59-5ce3baaad7fe"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "5b98c759-b4b7-4353-a5e4-d2ff1c030744",
              "leftValue": "={{ $json.message.content.parte3}}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1680,
        -560
      ],
      "id": "e2d5cea5-23cd-4460-9e7e-b122f29a474a",
      "name": "If12"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        2096,
        -528
      ],
      "id": "1ddc1cfe-cf41-468f-bf15-ff02f4255a12",
      "name": "No Operation, do nothing11"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "709f4717-003f-4f9f-b841-18d2f2f4ddb4",
              "leftValue": "={{ $json.message.content.parte2}}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2080,
        -736
      ],
      "id": "b8f9e823-8143-4adf-8daf-d636bd8f27b9",
      "name": "If13"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        2512,
        -720
      ],
      "id": "479bc836-37c1-42f5-a814-1744cb2624d5",
      "name": "No Operation, do nothing12"
    },
    {
      "parameters": {
        "amount": 2
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        1456,
        -336
      ],
      "id": "5cb4fb4a-e32a-4b9c-be84-6739843a78da",
      "name": "Wait13",
      "webhookId": "ca91d3f3-72c6-426f-ac8e-f926436b5f8e"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "5b98c759-b4b7-4353-a5e4-d2ff1c030744",
              "leftValue": "={{ $json.message.content.parte4}}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1680,
        -336
      ],
      "id": "2979838f-ca98-4ddd-8118-9ffb71d6b092",
      "name": "If14"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        2096,
        -336
      ],
      "id": "4c9f105a-53a0-4f6a-a9b0-eadae02f28fa",
      "name": "No Operation, do nothing13"
    },
    {
      "parameters": {
        "content": "## Incoming Messages\n",
        "height": 540,
        "width": 2240,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1024,
        -1360
      ],
      "id": "49eb7478-daba-4372-a9fb-9f4f30faae3f",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "## AGENT MAIN",
        "height": 600,
        "width": 1920
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1040,
        -768
      ],
      "id": "1f0ec2e5-656a-45ca-b6fc-c7c9f6377c8a",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "## RESPONS AGENT",
        "height": 600,
        "width": 2264,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        960,
        -768
      ],
      "id": "e3f80b6f-5429-4ce8-8b29-39d8332a6b0f",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "=chat_history_valeia_{{ $('setData').item.json.phone_number }}",
        "sessionTTL": 500000,
        "contextWindowLength": 25
      },
      "type": "@n8n/n8n-nodes-langchain.memoryRedisChat",
      "typeVersion": 1.5,
      "position": [
        0,
        -416
      ],
      "id": "286ce9a5-69c7-423e-a7ee-7d2fa1b813d0",
      "name": "Redis Chat Memory",
      "credentials": {
        "redis": {
          "id": "yzvE00xFtVHtaoZ1",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "GPT-4O-MINI"
        },
        "messages": {
          "values": [
            {
              "content": "=Corrige mensajes de usuarios quitando caracteres raros, errores ortogr√°ficos y signos innecesarios como acentos mal puestos, pero sin cambiar el sentido original del mensaje, si llega el mismo mensaje repetido exactamente, varias veces, corriges para que solo envies uno, ",
              "role": "system"
            },
            {
              "content": "=Corrige el siguiente mensaje:\\n\\n{{ $json.message }}\\n\\nDevuelve solo el mensaje corregido"
            }
          ]
        },
        "options": {
          "maxTokens": 200,
          "temperature": 0.3
        }
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        -976,
        -704
      ],
      "id": "f8d7f618-71e7-4517-84ad-ae5011443351",
      "name": "Message a model",
      "credentials": {
        "openAiApi": {
          "id": "UYsXoFpwT6Oh1GeF",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "updates": [
          "messages"
        ],
        "options": {
          "messageStatusUpdates": [
            "failed"
          ]
        }
      },
      "type": "n8n-nodes-base.whatsAppTrigger",
      "typeVersion": 1,
      "position": [
        -1024,
        -1136
      ],
      "id": "a9058d3f-11d6-4bfd-be96-8011b18affc7",
      "name": "WhatsApp Trigger",
      "webhookId": "eb7313b1-a05b-43a7-9f7d-06b1bfd0325f",
      "credentials": {
        "whatsAppTriggerApi": {
          "id": "GM09ZMKDDr5OF5u9",
          "name": "WhatsApp Valeia"
        }
      }
    },
    {
      "parameters": {
        "operation": "send",
        "phoneNumberId": "={{ $('WhatsApp Trigger').item.json.metadata.phone_number_id }}",
        "recipientPhoneNumber": "=+{{ $('Data').item.json.user_id }}",
        "textBody": "={{ $json.message.content.parte1 }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1,
      "position": [
        1504,
        -736
      ],
      "id": "e52da148-07de-4c8c-a0ff-55a8ad60d98d",
      "name": "Send message",
      "webhookId": "c1ac82f4-83bd-489f-a137-20846d2e0ea9",
      "credentials": {
        "whatsAppApi": {
          "id": "IzfsUgwJnA4EF09z",
          "name": "whatsap Valeia"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "GPT-4O-MINI"
        },
        "messages": {
          "values": [
            {
              "content": "=Divide el siguiente mensaje en hasta **4 partes m√°s peque√±as** solo si es necesario, asegur√°ndote de que cada parte tenga sentido completo.  \n\n### **Reglas:**  \n- Si el mensaje es *corto* (hasta *160 caracteres*), devu√©lvelo en **una sola parte**.  \n- Si es *mediano* (hasta *400 caracteres*), div√≠delo en **2 partes**.  \n- Si es *largo* (hasta *600 caracteres*), div√≠delo en **3 partes**. \n- Si es *muy largo* (m√°s de *600 caracteres*), agr√©gale una **parte4**.  \n\n- **Evita dividir el mensaje innecesariamente**. Usa la **menor cantidad de partes posible**.  \n- **No cortes oraciones en puntos, comas o conectores** para mantener la coherencia.  \n- **si hay una lista con varios items, no se debe dividir**, toda la lista debe ir en un mismo mensaje\n\n- **No incluyas datos sensibles del usuario** en la respuesta, como:  \n  - `user_id: <n√∫mero>`  \n  - `subscriber_id: <n√∫mero>`  \n  - `first_name: <nombre>` \n  - `mensajes de error`\n  - **Elimina estos datos sin dejar rastros.**  \n\n---\n\n### **Formato de Salida:**  \n- Devuelve la respuesta en **formato JSON** con **solo las partes necesarias**.  \n- Usa `\\n\\n` para agregar saltos de l√≠nea cuando sea necesario o para mejorar la legibilidad en listas.  \n- **Nunca uses comillas `\"` para resaltar palabras**. En su lugar, usa un solo asterisco: *palabra*.  \n\n#### **Ejemplo de salida:**  \n\n{\n  \"parte1\": \"Texto de la primera parte.\",\n  \"parte2\": \"Texto de la segunda parte.\"\n}\n\n\n---\n\n### **Mensaje:**  \n{{ $json.output }}  || {{ $json.output[0].text }}\n"
            }
          ]
        },
        "jsonOutput": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        1040,
        -704
      ],
      "id": "3f845141-356b-4ea6-aaba-8515fc250099",
      "name": "Message a model1",
      "credentials": {
        "openAiApi": {
          "id": "UYsXoFpwT6Oh1GeF",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -224,
        -416
      ],
      "id": "3713dfc8-3d51-40b0-a188-4db0328ff8f7",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "jQiccHfpS9BFKE4C",
          "name": "automation.whitelabel.lat"
        }
      }
    },
    {
      "parameters": {
        "operation": "send",
        "phoneNumberId": "={{ $('WhatsApp Trigger').item.json.metadata.phone_number_id }}",
        "recipientPhoneNumber": "=+{{ $('Data').item.json.user_id }}",
        "textBody": "={{ $json.message.content.parte2 }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1,
      "position": [
        2288,
        -752
      ],
      "id": "8f6f962d-7ef8-422d-9d68-bd0574a2c303",
      "name": "Send message4",
      "webhookId": "da25c650-1eb6-460e-a75a-6edb41c2a5be",
      "credentials": {
        "whatsAppApi": {
          "id": "IzfsUgwJnA4EF09z",
          "name": "whatsap Valeia"
        }
      }
    },
    {
      "parameters": {
        "operation": "send",
        "phoneNumberId": "={{ $('WhatsApp Trigger').item.json.metadata.phone_number_id }}",
        "recipientPhoneNumber": "=+{{ $('Data').item.json.user_id }}",
        "textBody": "={{ $json.message.content.parte3 }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1,
      "position": [
        1888,
        -560
      ],
      "id": "fac3901c-c477-488e-8e9e-2753f5238573",
      "name": "Send message1",
      "webhookId": "149b6c25-1ff1-4a05-a33b-4efa146529ba",
      "credentials": {
        "whatsAppApi": {
          "id": "IzfsUgwJnA4EF09z",
          "name": "whatsap Valeia"
        }
      }
    },
    {
      "parameters": {
        "operation": "send",
        "phoneNumberId": "={{ $('WhatsApp Trigger').item.json.metadata.phone_number_id }}",
        "recipientPhoneNumber": "=+{{ $('Data').item.json.user_id }}",
        "textBody": "={{ $json.message.content.parte4 }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1,
      "position": [
        1888,
        -368
      ],
      "id": "317f8597-5725-4dc4-8dcc-1f7913a51a9a",
      "name": "Send message2",
      "webhookId": "64535dbc-53f6-4df0-b4f8-99cfb4ad8c6d",
      "credentials": {
        "whatsAppApi": {
          "id": "IzfsUgwJnA4EF09z",
          "name": "whatsap Valeia"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "calendar": {
          "__rl": true,
          "value": "hola@whitelabel.lat",
          "mode": "list",
          "cachedResultName": "hola@whitelabel.lat"
        },
        "timeMin": "={{ $fromAI('After', ``, 'string') }}",
        "timeMax": "={{ $fromAI('Before', ``, 'string') }}",
        "options": {}
      },
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.3,
      "position": [
        176,
        -416
      ],
      "id": "f43cf77d-59c9-4ed9-bef9-ede07b2b4ac4",
      "name": "consultar_disponibilidad",
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "RMuQyYsn6eGZTZPX",
          "name": "hola@whitelabel.lat"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "calendar": {
          "__rl": true,
          "value": "c_c6586519956e46090f3bb622f584fc361b4b6e3d57970bf898ebd0167cc7d90b@group.calendar.google.com",
          "mode": "list",
          "cachedResultName": "Prueba de Agendamiento ValeIA"
        },
        "timeMin": "={{ $fromAI('After', ``, 'string') }}",
        "timeMax": "={{ $fromAI('Before', ``, 'string') }}",
        "options": {}
      },
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.3,
      "position": [
        384,
        -416
      ],
      "id": "215d0da8-5ea9-4dad-87bb-27aa7b4bf74d",
      "name": "consultar_eventos_dia",
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "RMuQyYsn6eGZTZPX",
          "name": "hola@whitelabel.lat"
        }
      }
    },
    {
      "parameters": {
        "calendar": {
          "__rl": true,
          "value": "c_c6586519956e46090f3bb622f584fc361b4b6e3d57970bf898ebd0167cc7d90b@group.calendar.google.com",
          "mode": "list",
          "cachedResultName": "Prueba de Agendamiento ValeIA"
        },
        "start": "={{ $fromAI('Start', `fecha y hora del inicio de la reunion `, 'string') }}",
        "end": "={{ $fromAI('End', `fecha y hora del final de la reunion, normalmente 30 minutos despues de la fecha de inicio`, 'string') }}",
        "additionalFields": {
          "attendees": [
            "={{ $fromAI('attendees0_Attendees', `correo electr√≥nico del invitado`, 'string') }}"
          ],
          "color": "1",
          "conferenceDataUi": {
            "conferenceDataValues": {
              "conferenceSolution": "hangoutsMeet"
            }
          },
          "description": "={{ $fromAI('Description', `Datos importantes del prospecto, como \nEmpresa: \nCargo: \nObjetivo: \nUrgencia: \nVolumen de operaciones: \nHerramientas actuales: \notros datos recopilados del prospecto. `, 'string') }}",
          "guestsCanInviteOthers": true,
          "sendUpdates": "all",
          "summary": "={{ $fromAI('Summary', ``, 'string') }}",
          "visibility": "private"
        }
      },
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.3,
      "position": [
        640,
        -432
      ],
      "id": "bd7a1cc1-4fc6-4475-9534-96f1c4be36ec",
      "name": "agendar_reunion",
      "retryOnFail": false,
      "waitBetweenTries": 2000,
      "maxTries": 2,
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "RMuQyYsn6eGZTZPX",
          "name": "hola@whitelabel.lat"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "dataToSave": {
          "values": [
            {
              "key": "nombre",
              "value": "={{ $json.nombre }}"
            },
            {
              "key": "phone_number",
              "value": "={{ $json.phone_number }}"
            },
            {
              "key": "tipo_mensaje",
              "value": "={{ $json.tipo_mensaje }}"
            },
            {
              "key": "mensaje",
              "value": "={{ $json.mensaje }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executionData",
      "typeVersion": 1.1,
      "position": [
        -128,
        -1136
      ],
      "id": "f844c95c-a6d1-4675-a425-5214aaf9c2db",
      "name": "Execution Data"
    },
    {
      "parameters": {
        "calendar": {
          "__rl": true,
          "value": "c_c6586519956e46090f3bb622f584fc361b4b6e3d57970bf898ebd0167cc7d90b@group.calendar.google.com",
          "mode": "list",
          "cachedResultName": "Prueba de Agendamiento ValeIA"
        },
        "start": "={{ $json.Start }}",
        "end": "={{ $json.End }}",
        "additionalFields": {
          "attendees": [
            "={{ $json.attendees0_Attendees }}"
          ],
          "description": "={{ $json.Description }}",
          "summary": "={{ $json.Summary }}"
        }
      },
      "type": "n8n-nodes-base.googleCalendar",
      "typeVersion": 1.3,
      "position": [
        -768,
        -416
      ],
      "id": "60abd496-3e89-4c79-8e6c-435c3ec2303b",
      "name": "Create an event",
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "RMuQyYsn6eGZTZPX",
          "name": "hola@whitelabel.lat"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.messages[0].type }}",
                    "rightValue": "audio",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "38cdad62-0d9c-45bc-860e-9e03d107ba58"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "audio"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "82df4052-c480-44a2-9d09-c195d4bc6879",
                    "leftValue": "={{ $json.messages[0].type }}",
                    "rightValue": "text",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "text"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -800,
        -1136
      ],
      "id": "4eac4455-0e54-4dd0-8d4d-ccab9c397857",
      "name": "type message Whatsap"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9f69a465-0cc7-43dd-97d7-aaee90bacbe3",
              "name": "nombre",
              "value": "={{ $json.contacts[0].profile.name }}",
              "type": "string"
            },
            {
              "id": "82031891-32ae-4442-b883-fad57ad08c79",
              "name": "phone_number",
              "value": "={{ $json.contacts[0].wa_id }}",
              "type": "string"
            },
            {
              "id": "8c4da55a-b196-497b-a9ef-c0ce734b8847",
              "name": "mensaje",
              "value": "={{ $json.messages[0].text.body }}",
              "type": "string"
            },
            {
              "id": "8a4d2988-720e-46c1-9927-90f62d5ddd72",
              "name": "tags",
              "value": "={{ $json.field }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -544,
        -1136
      ],
      "id": "856e3e16-66a7-4dba-b3dc-a60253ea8dca",
      "name": "DataText"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f4f107ad-f4e3-4616-a1ec-515f7324ba23",
              "name": "nombre",
              "value": "={{ $json.nombre }}",
              "type": "string"
            },
            {
              "id": "6f55c6f4-4cb3-4cec-9d31-b956d3fffde0",
              "name": "phone_number",
              "value": "={{ $json.phone_number }}",
              "type": "string"
            },
            {
              "id": "bad14eb8-f005-4d91-bd83-600e6105d974",
              "name": "mensaje",
              "value": "={{ $json.mensaje }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -352,
        -1136
      ],
      "id": "1cb98732-f7cf-4aa1-b58f-a9b4071787ce",
      "name": "setData"
    },
    {
      "parameters": {
        "operation": "keys",
        "keyPattern": "chat_history_valeia_573228854498"
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        80,
        -2368
      ],
      "id": "2fe70012-b017-4f46-8b94-f2e8b1245e81",
      "name": "Redis6",
      "credentials": {
        "redis": {
          "id": "yzvE00xFtVHtaoZ1",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -96,
        -2368
      ],
      "id": "24f2d53b-3e3b-419e-8829-45781e60c41f",
      "name": "When clicking ‚ÄòExecute workflow‚Äô"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9f69a465-0cc7-43dd-97d7-aaee90bacbe3",
              "name": "nombre",
              "value": "={{ $('WhatsApp Trigger').item.json.contacts[0].profile.name }}",
              "type": "string"
            },
            {
              "id": "82031891-32ae-4442-b883-fad57ad08c79",
              "name": "phone_number",
              "value": "={{ $('WhatsApp Trigger').item.json.contacts[0].wa_id }}",
              "type": "string"
            },
            {
              "id": "8c4da55a-b196-497b-a9ef-c0ce734b8847",
              "name": "mensaje",
              "value": "={{ $json.text }}",
              "type": "string"
            },
            {
              "id": "8a4d2988-720e-46c1-9927-90f62d5ddd72",
              "name": "tags",
              "value": "={{ $('WhatsApp Trigger').item.json.field }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -464,
        -1520
      ],
      "id": "cd71ed0a-b7ae-4fe0-b376-63300df2abd3",
      "name": "DataAudio"
    },
    {
      "parameters": {
        "resource": "media",
        "operation": "mediaUrlGet",
        "mediaGetId": "={{ $json.messages[0].audio.id }}"
      },
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1,
      "position": [
        -1056,
        -1520
      ],
      "id": "97b5eeca-ccd2-459c-91ca-e77929b2f284",
      "name": "Download media",
      "webhookId": "1537d7fd-b071-4bf1-9a47-3ae3d5805861",
      "credentials": {
        "whatsAppApi": {
          "id": "IzfsUgwJnA4EF09z",
          "name": "whatsap Valeia"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.openai.com/v1/audio/transcriptions",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "openAiApi",
        "sendBody": true,
        "contentType": "multipart-form-data",
        "bodyParameters": {
          "parameters": [
            {
              "name": "model",
              "value": "whisper-1"
            },
            {
              "parameterType": "formBinaryData",
              "name": "file",
              "inputDataFieldName": "data"
            },
            {
              "name": "languaje",
              "value": "es"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -656,
        -1520
      ],
      "id": "b185e355-9fcf-41ea-80dd-8c4d653b34ef",
      "name": "HTTP Request2",
      "credentials": {
        "openAiApi": {
          "id": "UYsXoFpwT6Oh1GeF",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "url": "={{ $json.url }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "whatsAppApi",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -864,
        -1520
      ],
      "id": "55c808fc-a835-4d9a-8ea2-8ebe0fdecb14",
      "name": "HTTP Request3",
      "credentials": {
        "whatsAppApi": {
          "id": "IzfsUgwJnA4EF09z",
          "name": "whatsap Valeia"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "12c7a801-4ed8-4955-b1fe-06855956424d",
              "name": "user_id",
              "value": "={{ $('Data').item.json.user_id }}",
              "type": "string"
            },
            {
              "id": "f311cb58-a0a2-4e34-bdd6-42c2a4df8b52",
              "name": "first_name",
              "value": "={{ $('Data').item.json.first_name }}",
              "type": "string"
            },
            {
              "id": "09e31c5b-cc4a-47f3-b290-84d2199f042b",
              "name": "name",
              "value": "={{ $('Data').item.json.name }}",
              "type": "string"
            },
            {
              "id": "6549b826-8a41-4dbf-879f-10463d115265",
              "name": "WhatsApp",
              "value": "={{ $('Data').item.json.WhatsApp }}",
              "type": "string"
            },
            {
              "id": "59b192c0-4470-4334-b3e0-105d4f9c46e8",
              "name": "",
              "value": "",
              "type": "string"
            },
            {
              "id": "ae18ba3e-84a8-43ec-8b61-4abcc228d7ab",
              "name": "",
              "value": "",
              "type": "string"
            },
            {
              "id": "b9c722be-ad45-4685-9031-4a019f6b2747",
              "name": "ID whastapp",
              "value": "={{ $json['Numero de whastapp que vas a usar para tu asistente'] }}",
              "type": "number"
            },
            {
              "id": "e43b714c-d5a1-48a8-a06e-1691d8dfd7f5",
              "name": "Nombre del Asistente",
              "value": "={{ $json['Nombre que tendr√° tu asistente IA:'] }}",
              "type": "string"
            },
            {
              "id": "8089fcec-621c-4454-9c2b-3f8063767818",
              "name": "Nombre de tu empresa:",
              "value": "={{ $json['Nombre de tu empresa o marca:'] }}",
              "type": "string"
            },
            {
              "id": "4c8a7667-9ac3-4506-af35-06ce98cd444e",
              "name": "¬øa que se dedica la empresa?",
              "value": "={{ $json['¬øa que se dedica tu empresa?'] }}",
              "type": "string"
            },
            {
              "id": "c4ade1f6-274e-439d-a9c1-6a43c6f3c351",
              "name": "Objetivo principal del agente :",
              "value": "={{ $json['El objetivo principal de tu agente IA sera:'] }}",
              "type": "string"
            },
            {
              "id": "4c5514b5-3000-463e-bbd6-8191eb5dcf1d",
              "name": "tipo de reuniones agendar√° el agente",
              "value": "={{ $json['  ¬øQu√© tipo de reuniones desea agendar tu agente?  '] }}",
              "type": "string"
            },
            {
              "id": "03aef901-3c82-4367-8507-77ef391f5017",
              "name": "Rol que debe cumplir el agente",
              "value": "={{ $json['Rol que debe cumplir el agente'] }}",
              "type": "string"
            },
            {
              "id": "1269f201-bd6b-477d-9c1f-cf05da780c7a",
              "name": "¬øQu√© tono debe tener tu agente al interactuar con los clientes?  ",
              "value": "={{ $json['¬øQu√© tono debe tener tu agente de IA al interactuar con los clientes?  '] }}",
              "type": "string"
            },
            {
              "id": "8d0b4259-0d08-4c8f-abe0-1f8c19dcc848",
              "name": "  ¬øCu√°l es el primer criterio que tienes en cuenta  para aceptar un prospecto?  ",
              "value": "={{ $json['  ¬øCu√°l es el primer criterio que tienes en cuenta  para aceptar un prospecto?  '] }}",
              "type": "string"
            },
            {
              "id": "f41309ba-a5d0-4990-8b06-cfc062c39ae7",
              "name": "¬øCu√°l es el segundo criterio que tienes en cuenta  para aceptar un prospecto?  ",
              "value": "={{ $json['¬øCu√°l es el segundo criterio que tienes en cuenta  para aceptar un prospecto?  '] }}",
              "type": "string"
            },
            {
              "id": "51126861-d924-4df1-9029-6f95eb98be13",
              "name": "¬øCu√°l es el Tercer criterio que tienes en cuenta  para aceptar un prospecto?  ",
              "value": "={{ $json['¬øCu√°l es el Tercer criterio que tienes en cuenta  para aceptar un prospecto?  '] }}",
              "type": "string"
            },
            {
              "id": "97870856-9f96-4dc3-a21c-a1e5dc94889f",
              "name": "¬øCu√°l es el cuarto criterio que tienes en cuenta  para aceptar un prospecto?  ",
              "value": "={{ $json['¬øCu√°l es el cuarto criterio que tienes en cuenta  para aceptar un prospecto?  '] }}",
              "type": "string"
            },
            {
              "id": "0a2b0cbe-0dae-4da6-9a45-03913a4d9bf1",
              "name": "Quinto criterio que tienes en cuenta  para aceptar un prospecto?  ",
              "value": "={{ $json['Quinto criterio que tienes en cuenta  para aceptar un prospecto?  '] }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -176,
        -704
      ],
      "id": "45fa82e5-fddc-4bcd-b1de-05391803d78a",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1ObgWNW-K89NU7WPWoOnPxBaQ_Aj2CBaio7iigAELKyY",
          "mode": "list",
          "cachedResultName": "PERSONALIZACION DE ASISTENTE IA (Respuestas)",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ObgWNW-K89NU7WPWoOnPxBaQ_Aj2CBaio7iigAELKyY/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 428712773,
          "mode": "list",
          "cachedResultName": "PERSONALIZACION DE ASISTENTE IA (Respuestas)",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ObgWNW-K89NU7WPWoOnPxBaQ_Aj2CBaio7iigAELKyY/edit#gid=428712773"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Numero de whastapp que vas a usar para tu asistente",
              "lookupValue": "=573112530069"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        -400,
        -704
      ],
      "id": "e427a95c-ccbc-403b-bf8b-ed0eece1c36d",
      "name": "Get row(s) in sheet",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "CM7JsKen8ouMDNPD",
          "name": "hola@whitelabel.lat"
        }
      }
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "=chat_history_valeia_573008564836"
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        1504,
        -1216
      ],
      "id": "ebd9f813-f7b0-4fb7-bc3c-1e3151bf863e",
      "name": "Redis1",
      "credentials": {
        "redis": {
          "id": "yzvE00xFtVHtaoZ1",
          "name": "Redis account"
        }
      }
    }
  ],
  "pinData": {},
  "repo_name": "flujos_n8n",
  "repo_owner": "whitelabel-ai",
  "repo_path": "Automation/",
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "errorWorkflow": "7CI8d1lC1EC1eqnL"
  },
  "staticData": {
    "node:Formbricks": {}
  },
  "tags": [
    {
      "createdAt": "2025-05-24T00:14:40.674Z",
      "updatedAt": "2025-05-24T00:14:40.674Z",
      "id": "oT0NAHa9rDEzcTFX",
      "name": "Plantilla"
    }
  ],
  "triggerCount": 1,
  "updatedAt": "2025-08-05T22:26:25.235Z",
  "versionId": "ef404ba5-38c6-4c44-b095-8c35746ca378"
}