{
  "active": false,
  "connections": {
    "When clicking ‘Execute workflow’": {
      "main": [
        [
          {
            "node": "Get Products4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Expand Languages & Sanitize",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Analyze image": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "AI Agent",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Expand Languages & Sanitize": {
      "main": [
        []
      ]
    },
    "Get many products1": {
      "main": [
        [
          {
            "node": "Analyze image",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out4": {
      "main": [
        [
          {
            "node": "caucho4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items4": {
      "main": [
        [
          {
            "node": "Edit Fields13",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Wait12",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "caucho4": {
      "main": [
        [
          {
            "node": "Loop Over Items4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If4": {
      "main": [
        [
          {
            "node": "Edit Fields14",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "create product4": {
      "main": [
        [
          {
            "node": "Loop Over Items4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "update product4": {
      "main": [
        [
          {
            "node": "Loop Over Items4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields9": {
      "main": [
        [
          {
            "node": "Wait14",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Products4": {
      "main": [
        [
          {
            "node": "Split Out4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields13": {
      "main": [
        [
          {
            "node": "Get Products5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields14": {
      "main": [
        [
          {
            "node": "Wait13",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait12": {
      "main": [
        [
          {
            "node": "get ML products",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait13": {
      "main": [
        [
          {
            "node": "create product4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait14": {
      "main": [
        [
          {
            "node": "update product4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out5": {
      "main": [
        [
          {
            "node": "caucho5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "caucho5": {
      "main": [
        [
          {
            "node": "Wait15",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request5": {
      "main": [
        [
          {
            "node": "If5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If5": {
      "main": [
        [
          {
            "node": "Edit Fields17",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields15",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "create product5": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "update product5": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Edit Fields15": {
      "main": [
        [
          {
            "node": "Wait17",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Products5": {
      "main": [
        [
          {
            "node": "Split Out5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields16": {
      "main": [
        [
          {
            "node": "Get Products5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields17": {
      "main": [
        [
          {
            "node": "Wait16",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait15": {
      "main": [
        [
          {
            "node": "HTTP Request5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait16": {
      "main": [
        [
          {
            "node": "create product5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait17": {
      "main": [
        [
          {
            "node": "update product5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Edit Fields16",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get ML products": {
      "main": [
        [
          {
            "node": "If4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Get row(s)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s)": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Get Orders",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Orders": {
      "main": [
        [
          {
            "node": "Get list of contacts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-10-07T20:01:05.857Z",
  "id": "UzeriRNtkpQe3Hir",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "Shopify AI Product Description Generation & Translation",
  "nodes": [
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -3264,
        3744
      ],
      "id": "8c3c8402-afc3-4b42-8229-6b02cc82f5dd",
      "name": "When clicking ‘Execute workflow’"
    },
    {
      "parameters": {
        "resource": "image",
        "operation": "analyze",
        "modelId": {
          "__rl": true,
          "mode": "list",
          "value": "models/gemini-2.5-flash-lite",
          "cachedResultName": "models/gemini-2.5-flash-lite"
        },
        "text": "=Analyze the provided image and return an objective, clear, and detailed description of the product shown.\n\nRequirements:\n\nFocus only on the main product (ignore background or decorations).\n\nDescribe only what is visible and verifiable in the image.\n\nInclude details about:\n\nProduct type (shoe, bag, cap, t-shirt).\n\nApparent materials (leather, fabric, canvas, knit, etc.).\n\nMain and secondary colors.\n\nVisible patterns or prints (plain, stripes, logos, embroidery).\n\nDistinctive elements (closure, laces, buckles, pockets, stitching, sole).\n\nUse a descriptive and neutral tone:\n\nExamples: “smooth finish”, “with top closure”, “with visible stitching”.\n\nDo not invent information that is not visible in the image (do not assume size, brand, comfort, or usage).\n\nWrite the answer in a short and concise paragraph (3–5 sentences).",
        "imageUrls": "={{ $json.images[0].src }}",
        "options": {}
      },
      "id": "62f38c2b-57a4-470d-a545-b7376668e08c",
      "name": "Analyze image",
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "position": [
        -2768,
        2096
      ],
      "typeVersion": 1,
      "credentials": {
        "googlePalmApi": {
          "id": "kuAijbcGhZkbdIR2",
          "name": "whitelabel mony"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=AI Generated Vision Description of Product: Analyze the image at the URL: {{ $('Get many products1').item.json.images[0].src }}\n\nBrand: {{ $('Get many products1').item.json.vendor }}\nProduct Name: {{ $('Get many products1').item.json.title }}\nUser Provided Description: {{ $('Get many products1').item.json.body_html }}\nProduct Type: {{ $('Get many products1').item.json.product_type }}\n\nVision Description: {{ $json.content.parts[0].text }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=<system_prompt>\nYOU ARE A PROFESSIONAL MULTILINGUAL E-COMMERCE COPYWRITING AI FOR FOOTWEAR. GENERATE PRODUCT COPY FOR **ES, DE, EN, FR, IT, PT**.\n\nSOURCES (priority):\n1) Product name → category/keywords/core attributes.  \n2) User draft → tone and context.  \n3) Vision description (analyzed) → visible traits (apparent materials, colors, finishes, sole, closure).  \n\nGENERAL RULES & ANTI-HALLUCINATION:  \n- Do not invent technologies, materials, sizes, or brand if not provided in the sources.  \n- Professional online shoe store tone; conversion-oriented, without exaggerations.  \n- HTML allowed ONLY in `shopify_description`: <div>, <h2>, <h3>, <p>, <ul>, <ol>, <li>, <strong>, <em>, <br>. No <script>, no inline styles, no tables.  \n- Intro paragraph + 3–6 bullets max; titles ≤ 80 characters.  \n- Do not include SKU, locator, or other internal metadata.  \n\nFOOTWEAR TERMINOLOGY (apply per language):  \n- **DE**: Sneaker / Turnschuh, Obermaterial (tige / upper), Sohle / Außensohle, Schnürung / Klettverschluss, Stiefel (boots), Sandalen, Slipper.  \n- **EN**: sneaker / shoe, upper, outsole, lace-up / closure, boots, sandals, espadrilles, dress shoes, casual shoes, slip-ons.  \n- **FR**: basket / chaussure, tige, semelle extérieure, lacets / fermeture, bottes, sandales, espadrilles, chaussures habillées, souliers, mules.  \n- **IT**: sneaker / scarpa, tomaia, suola / suola esterna, chiusura / lacci, stivali, sandali, espadrillas, scarpe eleganti, ballerine, sabot.  \n- **PT**: ténis / sapato, cabedal, sola / sola exterior, fecho / atacadores, botas, sandálias, alpargatas, sapatos de vestir, mocassins, chinelos.  \n\nHANDLES/SLUGS PER LANGUAGE:  \n- Lowercase; words separated with `-`; no symbols; normalize accents.  \n- DE: ä→ae, ö→oe, ü→ue, ß→ss; FR/IT/PT: remove diacritics; ES: á→a, é→e, í→i, ó→o, ú→u, ñ→n.  \n- Max. 80 characters. Avoid repeating the brand in the handle unless it is part of the product name.  \n\nSTRICT OUTPUT FORMAT (mandatory):  \n\nReturn **exclusively** a JSON object with no text before or after.  \nDo not wrap the response inside any other key (e.g. do not use \"output\" or similar).  \nThe root object must contain exactly 6 keys: es, de, en, fr, it, pt.  \nEach language must include exactly 3 keys: shopify_product_name, shopify_description, handle.  \nUse double quotes for JSON. Inside HTML strings, use single quotes for attributes.  \nReturn the JSON minified on a single line (no line breaks, no Markdown).  \nIt is forbidden to use different keys (e.g. not \"shop_description\").  \nIf some data is missing, return an empty string, but always keep the key.  \n\nGOAL: RETURN **EXCLUSIVELY** THIS MULTILINGUAL JSON:\n{\n  \"es\": {\"shopify_product_name\": \"...\", \"shopify_description\": \"...\", \"handle\": \"...\"},\n  \"de\": {\"shopify_product_name\": \"...\", \"shopify_description\": \"...\", \"handle\": \"...\"},\n  \"en\": {\"shopify_product_name\": \"...\", \"shopify_description\": \"...\", \"handle\": \"...\"},\n  \"fr\": {\"shopify_product_name\": \"...\", \"shopify_description\": \"...\", \"handle\": \"...\"},\n  \"it\": {\"shopify_product_name\": \"...\", \"shopify_description\": \"...\", \"handle\": \"...\"},\n  \"pt\": {\"shopify_product_name\": \"...\", \"shopify_description\": \"...\", \"handle\": \"...\"}\n}\n</system_prompt>\n"
        }
      },
      "id": "8f2ba91f-a069-4f47-bbb6-2074f50e54f5",
      "name": "AI Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        -2544,
        2096
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-flash-preview-09-2025",
        "options": {
          "maxOutputTokens": 4048,
          "temperature": 0.4
        }
      },
      "id": "0dcdfd6e-baef-4d87-a0ea-6824a6ec6415",
      "name": "Google Gemini Chat Model1",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "position": [
        -2544,
        2320
      ],
      "typeVersion": 1,
      "credentials": {
        "googlePalmApi": {
          "id": "kuAijbcGhZkbdIR2",
          "name": "whitelabel mony"
        }
      }
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"es\": {\"shopify_product_name\": \"\", \"shopify_description\": \"\", \"handle\": \"\"},\n  \"de\": {\"shopify_product_name\": \"\", \"shopify_description\": \"\", \"handle\": \"\"},\n  \"en\": {\"shopify_product_name\": \"\", \"shopify_description\": \"\", \"handle\": \"\"},\n  \"fr\": {\"shopify_product_name\": \"\", \"shopify_description\": \"\", \"handle\": \"\"},\n  \"it\": {\"shopify_product_name\": \"\", \"shopify_description\": \"\", \"handle\": \"\"},\n  \"pt\": {\"shopify_product_name\": \"\", \"shopify_description\": \"\", \"handle\": \"\"}\n}"
      },
      "id": "4ecbe833-c66e-452c-b627-755fe286d46e",
      "name": "Structured Output Parser",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "position": [
        -2416,
        2320
      ],
      "typeVersion": 1.3
    },
    {
      "parameters": {
        "jsCode": "// Entrada: $json.output con claves es,de,en,fr,it,pt\nconst langs = ['es','de','en','fr','it','pt'];\n\nconst productId = $('Get many products1').first().json.id;\nconst handleES = $('Get many products1').first().json.handle\nconst items = [];\n$input.first().json.output.es\n\nfor (const lang of langs) {\nconst node = $input.first().json.output[lang];\nif (!node) continue;\nitems.push({\njson: {\nproduct_id: Number(productId),\nlang,\nhandle: node.handle,\nshopify_product_name: node.shopify_product_name,\nshopify_description: node.shopify_description,\n// Para comodidad, también retornamos los campos ES por si quieres compararlos\nbase_handle_es: handleES\n}\n});\n}\n\n\nreturn items;"
      },
      "id": "00823cc9-767a-484e-a3f2-749d554ff508",
      "name": "Expand Languages & Sanitize",
      "type": "n8n-nodes-base.code",
      "position": [
        -2192,
        2096
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "authentication": "accessToken",
        "resource": "product",
        "operation": "getAll",
        "limit": 2,
        "additionalFields": {}
      },
      "id": "b597fc44-2492-46f3-8c37-3799106d7e63",
      "name": "Get many products1",
      "type": "n8n-nodes-base.shopify",
      "position": [
        -2992,
        2096
      ],
      "typeVersion": 1,
      "credentials": {
        "shopifyAccessTokenApi": {
          "id": "9RO1LDkPgTRAthd9",
          "name": "Test Pedro"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "ml",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -3328,
        4752
      ],
      "id": "f27e2b59-6e6e-4dd8-b17c-12172106d231",
      "name": "Webhook",
      "webhookId": "b670c147-2dde-406a-a7bc-9fa692c7978b"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.mercadolibre.com/oauth/token",
        "sendBody": true,
        "contentType": "form-urlencoded",
        "bodyParameters": {
          "parameters": [
            {
              "name": "grant_type",
              "value": "authorization_code"
            },
            {
              "name": "client_id",
              "value": "7334627525708690"
            },
            {
              "name": "client_secret",
              "value": "Ne3ghVZguF8tkwL5Je4WYuiY2pzb7oOS"
            },
            {
              "name": "redirect_uri",
              "value": "https://automation.whitelabel.lat"
            },
            {
              "name": "code",
              "value": "TG-6900d1c610767800017246fe-46822039"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -2992,
        1760
      ],
      "id": "6d9e0daa-ff3b-4e62-94c5-82e2540120fe",
      "name": "Get token"
    },
    {
      "parameters": {
        "url": "https://api.mercadolibre.com/users/me",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer APP_USR-7334627525708690-102810-35f67e3ab489d703ec44df92b95d87fb-46822039"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -2992,
        1952
      ],
      "id": "ca216ec6-99be-4be8-a4d4-e77f47d0a2cc",
      "name": "verificar token"
    },
    {
      "parameters": {
        "url": "https://api.mercadolibre.com/sites/MLV/domain_discovery/search?q=amortiguador",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -2992,
        2640
      ],
      "id": "20c90d2e-478b-4fa1-b11f-95eb2734bbac",
      "name": "get category"
    },
    {
      "parameters": {
        "fieldToSplitOut": "body.products",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -2768,
        3744
      ],
      "id": "086d2472-6e2b-4bb9-82d6-de8b593c539a",
      "name": "Split Out4"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -2320,
        3744
      ],
      "id": "9d70d693-864b-4325-97c7-759c1fb26e04",
      "name": "Loop Over Items4"
    },
    {
      "parameters": {
        "jsCode": "// === CONFIGURACIÓN GENERAL === //\nconst CONFIG = {\n  pais: \"VE\", // Cambia a \"VE\" cuando publiques en Venezuela - \"CO\" Colombia\n  tasaCambioUSD: 4000, // Solo se usa en Colombia para convertir precios en USD\n  sites: {\n    CO: {\n      site_id: \"MCO\",\n      currency_id: \"COP\",\n      categorias: {\n        default: \"MCO1747\",\n        caucho: \"MCO23030\",\n        amortiguador: \"MCO165996\",\n        otros: \"MCO447991\"\n      },\n      atributos: {\n        caucho: {\n          ancho: \"SECTION_WIDTH\",\n          perfil: \"AUTOMOTIVE_TIRE_ASPECT_RATIO\",\n          rin: \"RIM_DIAMETER\",\n          cantidad: \"TIRES_NUMBER\",\n          carga: \"LOAD_INDEX\"\n        },\n        amortiguador: {\n          numeroParte: \"PART_NUMBER\",\n          tipo: \"PART_TYPE\",\n          marcaVehiculo: \"VEHICLE_BRAND\"\n        }\n      }\n    },\n    VE: {\n      site_id: \"MLV\",\n      currency_id: \"USD\",\n      categorias: {\n        default: \"MLV1747\",\n        caucho: \"MLV403699\",\n        amortiguador: \"MLV122587\",\n        otros: \"MLV1953\"\n      },\n      atributos: {\n        caucho: {\n          ancho: \"SECTION_WIDTH\",\n          perfil: \"AUTOMOTIVE_TIRE_ASPECT_RATIO\",\n          rin: \"RIM_DIAMETER\",\n          cantidad: \"TIRES_NUMBER\",\n          carga: \"LOAD_INDEX\"\n        },\n        amortiguador: {\n          numeroParte: \"PART_NUMBER\",\n          tipo: \"PART_TYPE\",\n          marcaVehiculo: \"VEHICLE_BRAND\"\n        }\n      }\n    }\n  }\n};\n\n// === FUNCIONES AUXILIARES === //\nfunction cleanHTML(html) {\n  if (!html) return \"\";\n  return html.replace(/<[^>]*>?/gm, \"\").replace(/\\s+/g, \" \").trim();\n}\n\nfunction extraerMedidasCaucho(texto) {\n  const regex = /(\\d{3})[\\/\\-](\\d{2})[Rr]?(\\d{2})/;\n  const match = texto.match(regex);\n  if (!match) return null;\n  return {\n    ancho: `${match[1]} mm`,\n    perfil: match[2],\n    rin: `${match[3]} in`\n  };\n}\n\n// === FUNCIÓN PARA LIMITAR TÍTULOS A 60 CARACTERES === //\nfunction limitarTitulo(titulo, max = 60) {\n  if (titulo.length <= max) return titulo;\n  const truncado = titulo.substring(0, max);\n  const ultimoEspacio = truncado.lastIndexOf(\" \");\n  return (ultimoEspacio > 0 ? truncado.substring(0, ultimoEspacio) : truncado).trim();\n}\n\n// === PROCESO PRINCIPAL === //\nconst productos = items.map(item => item.json);\nconst publicaciones = [];\n\nfor (const producto of productos) {\n  const base = {\n    title: producto.title,\n    description: cleanHTML(producto.body_html),\n    vendor: producto.vendor,\n    images: (producto.images || []).map(img => ({ source: img.src })),\n  };\n\n  const tituloLower = base.title.toLowerCase();\n  const esCaucho = tituloLower.includes(\"caucho\") || tituloLower.includes(\"llanta\") || tituloLower.includes(\"neumático\");\n  const esAmortiguador = tituloLower.includes(\"amortiguador\");\n\n  const siteConfig = CONFIG.sites[CONFIG.pais];\n  let categoria = siteConfig.categorias.otros;\n\n  if (esCaucho) categoria = siteConfig.categorias.caucho;\n  else if (esAmortiguador) categoria = siteConfig.categorias.amortiguador;\n\n  let medidas = null;\n  if (esCaucho) {\n    medidas = extraerMedidasCaucho(base.title) || extraerMedidasCaucho(base.description);\n  }\n\n  for (const variante of producto.variants || []) {\n    // === Conversión de precio (AJUSTADA) === //\n    let precioBase = parseFloat(variante.price || 0);\n\n    if (CONFIG.pais === \"CO\") {\n      // Si hay tasa de cambio válida la aplicamos; si no, dejamos el precio tal cual (se entiende que ya viene en COP).\n      if (CONFIG.tasaCambioUSD && Number(CONFIG.tasaCambioUSD) > 0) {\n        precioBase = precioBase * Number(CONFIG.tasaCambioUSD);\n      } else {\n        // no hay tasa de cambio: se mantiene el valor recibido\n        precioBase = precioBase;\n      }\n    } else if (CONFIG.pais === \"VE\") {\n      // En Venezuela se usa exactamente el valor que llega (asumido en USD)\n      precioBase = precioBase;\n    } else {\n      // Otros países: por defecto mantén el valor original\n      precioBase = precioBase;\n    }\n\n    // Aplicar un mínimo razonable según la moneda del site para no alterar precios en USD\n    const moneda = siteConfig.currency_id;\n    const minimoPorMoneda = moneda === \"COP\" ? 3000 : 0.01; // si COP => 3000, si USD u otra => mínimo insignificante\n    const precioFinal = Math.max(precioBase, minimoPorMoneda);\n\n    // === Generar título con límite de 60 caracteres === //\n    const tituloBase = `${base.title} - ${variante.title !== \"Default Title\" ? variante.title : \"\"}`.trim();\n    const tituloFinal = limitarTitulo(tituloBase, 60);\n\n    const item = {\n      title: tituloFinal,\n      price: precioFinal,\n      currency_id: siteConfig.currency_id,\n      available_quantity: variante.inventory_quantity || 0,\n      buying_mode: \"buy_it_now\",\n      condition: \"new\",\n      listing_type_id: \"gold_special\",\n      category_id: categoria,\n      description: { plain_text: base.description },\n      pictures: base.images,\n      attributes: [\n        { id: \"BRAND\", value_name: base.vendor || \"Sin marca\" },\n        { id: \"MODEL\", value_name: base.title }\n      ]\n    };\n\n    // === ATRIBUTOS DE CAUCHO === //\n    if (esCaucho) {\n      const attr = siteConfig.atributos.caucho;\n      const ancho = medidas?.ancho || \"205 mm\";\n      const perfil = medidas?.perfil || \"55\";\n      const rin = medidas?.rin || \"16 in\";\n\n      item.attributes.push(\n        { id: attr.ancho, value_name: ancho },\n        { id: attr.perfil, value_name: perfil },\n        { id: attr.rin, value_name: rin },\n        { id: attr.carga, value_name: \"91\" },\n        { id: attr.cantidad, value_name: \"1\" }\n      );\n    }\n\n    // === ATRIBUTOS DE AMORTIGUADOR === //\n    if (esAmortiguador) {\n      const attr = siteConfig.atributos.amortiguador;\n      const partNumber =\n        variante.sku ||\n        producto.handle ||\n        `${base.vendor}-${variante.id}`.replace(/\\s+/g, \"-\");\n\n      item.attributes.push(\n        { id: attr.numeroParte, value_name: partNumber },\n        { id: attr.tipo, value_name: \"Amortiguador\" },\n        { id: attr.marcaVehiculo, value_name: \"Universal\" }\n      );\n    }\n\n    publicaciones.push({ json: item });\n  }\n}\n\nreturn publicaciones;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2544,
        3744
      ],
      "id": "f0e6c18b-25d6-4930-bdab-24c6e0cb8bcf",
      "name": "caucho4"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "74da0a56-6733-4c1a-8971-4e2741048a77",
              "leftValue": "={{ $json.paging.total }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1648,
        3664
      ],
      "id": "36b7b1c4-714c-4a04-8ae9-edab52c475e2",
      "name": "If4"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.mercadolibre.com/items",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer APP_USR-7334627525708690-102810-35f67e3ab489d703ec44df92b95d87fb-46822039"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json.item }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -976,
        3744
      ],
      "id": "851ce54f-f356-4afa-b3d7-5eafecc260e0",
      "name": "create product4",
      "retryOnFail": true,
      "waitBetweenTries": 3000
    },
    {
      "parameters": {
        "method": "PUT",
        "url": "=https://api.mercadolibre.com/items/{{ $('get ML products').item.json.results[0] }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer APP_USR-7334627525708690-102810-35f67e3ab489d703ec44df92b95d87fb-46822039"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{$json}}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -976,
        3936
      ],
      "id": "261c9c31-940e-4968-b8c0-3ec8922fa491",
      "name": "update product4",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "waitBetweenTries": 3000,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "3c5d070c-d1b6-498f-9bd8-9342a0e3bc77",
              "name": "title",
              "value": "={{ $('Loop Over Items4').item.json.title }}",
              "type": "string"
            },
            {
              "id": "bb11ebbb-a03a-488f-9943-17a97ef43326",
              "name": "price",
              "value": "={{ $('Loop Over Items4').item.json.price }}",
              "type": "number"
            },
            {
              "id": "824c7b2e-765a-4fbb-bd8e-a95a7f00f12d",
              "name": "currency_id",
              "value": "={{ $('Loop Over Items4').item.json.currency_id }}",
              "type": "string"
            },
            {
              "id": "366e2872-821c-4f2d-a776-69cf7ca2dce8",
              "name": "available_quantity",
              "value": "={{ $('Loop Over Items4').item.json.available_quantity }}",
              "type": "number"
            },
            {
              "id": "995e7518-f1fb-49cb-b27e-067bb6e0456a",
              "name": "condition",
              "value": "={{ $('Loop Over Items4').item.json.condition }}",
              "type": "string"
            },
            {
              "id": "22764566-a28e-4fb8-a9a4-fc0425449fe5",
              "name": "category_id",
              "value": "={{ $('Loop Over Items4').item.json.category_id }}",
              "type": "string"
            },
            {
              "id": "9256e42a-a124-422d-a369-3199dedeac09",
              "name": "pictures",
              "value": "={{ $('Loop Over Items4').item.json.pictures }}",
              "type": "array"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1424,
        3760
      ],
      "id": "f0080962-c263-477f-bde5-adab7da19662",
      "name": "Edit Fields9"
    },
    {
      "parameters": {
        "url": "https://tonowheels.myshopify.com/admin/api/2024-10/products.json",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "shopifyAccessTokenApi",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "limit",
              "value": "3"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "fullResponse": true
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -2992,
        3744
      ],
      "id": "a91dc840-2e42-4311-9288-fbeb8679a9c8",
      "name": "Get Products4",
      "notesInFlow": false,
      "credentials": {
        "shopifyAccessTokenApi": {
          "id": "9RO1LDkPgTRAthd9",
          "name": "Test Pedro"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9b2c7cf4-b063-4aab-afe4-b74cb0684a2b",
              "name": "next",
              "value": "={{$('Get Products4').first().json.headers.link.match(/<([^>]+)>; rel=\"next\"/)[1]}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2096,
        3264
      ],
      "id": "10703adf-b8bf-4531-bdf9-df96266dea1d",
      "name": "Edit Fields13",
      "executeOnce": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "54c25536-0a25-44a2-97e4-abcfcfb474f9",
              "name": "item",
              "value": "={{ $('Loop Over Items4').item.json }}",
              "type": "object"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1424,
        3568
      ],
      "id": "52116ba1-8cc0-4e42-95e3-6a911b21f805",
      "name": "Edit Fields14"
    },
    {
      "parameters": {
        "amount": 1
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -2096,
        3664
      ],
      "id": "fd0149d7-64de-4a79-8656-7e6739e66afa",
      "name": "Wait12",
      "webhookId": "a9e9dc4c-0887-4a25-87ad-0fdc0a74dcf6"
    },
    {
      "parameters": {
        "amount": 1
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -1200,
        3568
      ],
      "id": "149f0ab8-16bb-4a42-81a1-a44ecbac22b9",
      "name": "Wait13",
      "webhookId": "d36d2f4c-8c59-4501-b046-7e988a16773f"
    },
    {
      "parameters": {
        "amount": 1
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -1200,
        3760
      ],
      "id": "59265a33-e794-4d74-ba43-e5c97d760d90",
      "name": "Wait14",
      "webhookId": "8d68a993-462f-4d3b-bde9-25dce75d1bd8"
    },
    {
      "parameters": {
        "fieldToSplitOut": "body.products",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -1648,
        3184
      ],
      "id": "a728b04e-e409-4a01-94f2-96eea5cf65f9",
      "name": "Split Out5"
    },
    {
      "parameters": {
        "jsCode": "// === CONFIGURACIÓN GENERAL === //\nconst CONFIG = {\n  pais: \"VE\", // Cambia a \"VE\" cuando publiques en Venezuela - \"CO\" Colombia\n  tasaCambioUSD: 4000, // Solo se usa en Colombia para convertir precios en USD\n  sites: {\n    CO: {\n      site_id: \"MCO\",\n      currency_id: \"COP\",\n      categorias: {\n        default: \"MCO1747\",\n        caucho: \"MCO23030\",\n        amortiguador: \"MCO165996\",\n        otros: \"MCO447991\"\n      },\n      atributos: {\n        caucho: {\n          ancho: \"SECTION_WIDTH\",\n          perfil: \"AUTOMOTIVE_TIRE_ASPECT_RATIO\",\n          rin: \"RIM_DIAMETER\",\n          cantidad: \"TIRES_NUMBER\",\n          carga: \"LOAD_INDEX\"\n        },\n        amortiguador: {\n          numeroParte: \"PART_NUMBER\",\n          tipo: \"PART_TYPE\",\n          marcaVehiculo: \"VEHICLE_BRAND\"\n        }\n      }\n    },\n    VE: {\n      site_id: \"MLV\",\n      currency_id: \"USD\",\n      categorias: {\n        default: \"MLV1747\",\n        caucho: \"MLV403699\",\n        amortiguador: \"MLV122587\",\n        otros: \"MLV1953\"\n      },\n      atributos: {\n        caucho: {\n          ancho: \"SECTION_WIDTH\",\n          perfil: \"AUTOMOTIVE_TIRE_ASPECT_RATIO\",\n          rin: \"RIM_DIAMETER\",\n          cantidad: \"TIRES_NUMBER\",\n          carga: \"LOAD_INDEX\"\n        },\n        amortiguador: {\n          numeroParte: \"PART_NUMBER\",\n          tipo: \"PART_TYPE\",\n          marcaVehiculo: \"VEHICLE_BRAND\"\n        }\n      }\n    }\n  }\n};\n\n// === FUNCIONES AUXILIARES === //\nfunction cleanHTML(html) {\n  if (!html) return \"\";\n  return html.replace(/<[^>]*>?/gm, \"\").replace(/\\s+/g, \" \").trim();\n}\n\nfunction extraerMedidasCaucho(texto) {\n  const regex = /(\\d{3})[\\/\\-](\\d{2})[Rr]?(\\d{2})/;\n  const match = texto.match(regex);\n  if (!match) return null;\n  return {\n    ancho: `${match[1]} mm`,\n    perfil: match[2],\n    rin: `${match[3]} in`\n  };\n}\n\n// === FUNCIÓN PARA LIMITAR TÍTULOS A 60 CARACTERES === //\nfunction limitarTitulo(titulo, max = 60) {\n  if (titulo.length <= max) return titulo;\n  const truncado = titulo.substring(0, max);\n  const ultimoEspacio = truncado.lastIndexOf(\" \");\n  return (ultimoEspacio > 0 ? truncado.substring(0, ultimoEspacio) : truncado).trim();\n}\n\n// === PROCESO PRINCIPAL === //\nconst productos = items.map(item => item.json);\nconst publicaciones = [];\n\nfor (const producto of productos) {\n  const base = {\n    title: producto.title,\n    description: cleanHTML(producto.body_html),\n    vendor: producto.vendor,\n    images: (producto.images || []).map(img => ({ source: img.src })),\n  };\n\n  const tituloLower = base.title.toLowerCase();\n  const esCaucho = tituloLower.includes(\"caucho\") || tituloLower.includes(\"llanta\") || tituloLower.includes(\"neumático\");\n  const esAmortiguador = tituloLower.includes(\"amortiguador\");\n\n  const siteConfig = CONFIG.sites[CONFIG.pais];\n  let categoria = siteConfig.categorias.otros;\n\n  if (esCaucho) categoria = siteConfig.categorias.caucho;\n  else if (esAmortiguador) categoria = siteConfig.categorias.amortiguador;\n\n  let medidas = null;\n  if (esCaucho) {\n    medidas = extraerMedidasCaucho(base.title) || extraerMedidasCaucho(base.description);\n  }\n\n  for (const variante of producto.variants || []) {\n    // === Conversión de precio (AJUSTADA) === //\n    let precioBase = parseFloat(variante.price || 0);\n\n    if (CONFIG.pais === \"CO\") {\n      // Si hay tasa de cambio válida la aplicamos; si no, dejamos el precio tal cual (se entiende que ya viene en COP).\n      if (CONFIG.tasaCambioUSD && Number(CONFIG.tasaCambioUSD) > 0) {\n        precioBase = precioBase * Number(CONFIG.tasaCambioUSD);\n      } else {\n        // no hay tasa de cambio: se mantiene el valor recibido\n        precioBase = precioBase;\n      }\n    } else if (CONFIG.pais === \"VE\") {\n      // En Venezuela se usa exactamente el valor que llega (asumido en USD)\n      precioBase = precioBase;\n    } else {\n      // Otros países: por defecto mantén el valor original\n      precioBase = precioBase;\n    }\n\n    // Aplicar un mínimo razonable según la moneda del site para no alterar precios en USD\n    const moneda = siteConfig.currency_id;\n    const minimoPorMoneda = moneda === \"COP\" ? 3000 : 0.01; // si COP => 3000, si USD u otra => mínimo insignificante\n    const precioFinal = Math.max(precioBase, minimoPorMoneda);\n\n    // === Generar título con límite de 60 caracteres === //\n    const tituloBase = `${base.title} - ${variante.title !== \"Default Title\" ? variante.title : \"\"}`.trim();\n    const tituloFinal = limitarTitulo(tituloBase, 60);\n\n    const item = {\n      title: tituloFinal,\n      price: precioFinal,\n      currency_id: siteConfig.currency_id,\n      available_quantity: variante.inventory_quantity || 0,\n      buying_mode: \"buy_it_now\",\n      condition: \"new\",\n      listing_type_id: \"gold_special\",\n      category_id: categoria,\n      description: { plain_text: base.description },\n      pictures: base.images,\n      attributes: [\n        { id: \"BRAND\", value_name: base.vendor || \"Sin marca\" },\n        { id: \"MODEL\", value_name: base.title }\n      ]\n    };\n\n    // === ATRIBUTOS DE CAUCHO === //\n    if (esCaucho) {\n      const attr = siteConfig.atributos.caucho;\n      const ancho = medidas?.ancho || \"205 mm\";\n      const perfil = medidas?.perfil || \"55\";\n      const rin = medidas?.rin || \"16 in\";\n\n      item.attributes.push(\n        { id: attr.ancho, value_name: ancho },\n        { id: attr.perfil, value_name: perfil },\n        { id: attr.rin, value_name: rin },\n        { id: attr.carga, value_name: \"91\" },\n        { id: attr.cantidad, value_name: \"1\" }\n      );\n    }\n\n    // === ATRIBUTOS DE AMORTIGUADOR === //\n    if (esAmortiguador) {\n      const attr = siteConfig.atributos.amortiguador;\n      const partNumber =\n        variante.sku ||\n        producto.handle ||\n        `${base.vendor}-${variante.id}`.replace(/\\s+/g, \"-\");\n\n      item.attributes.push(\n        { id: attr.numeroParte, value_name: partNumber },\n        { id: attr.tipo, value_name: \"Amortiguador\" },\n        { id: attr.marcaVehiculo, value_name: \"Universal\" }\n      );\n    }\n\n    publicaciones.push({ json: item });\n  }\n}\n\nreturn publicaciones;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1424,
        3184
      ],
      "id": "03360730-0b41-4e1b-966f-cce1d325a673",
      "name": "caucho5"
    },
    {
      "parameters": {
        "url": "=https://api.mercadolibre.com/users/291859081/items/search?q={{ $json.title }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer APP_USR-7334627525708690-100809-7782bf6d848c6ad490e60499545b1cc4-291859081"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -976,
        3184
      ],
      "id": "78054b81-a0f9-4b6d-91f7-279a0736ddf3",
      "name": "HTTP Request5",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "74da0a56-6733-4c1a-8971-4e2741048a77",
              "leftValue": "={{ $json.paging.total }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -752,
        3184
      ],
      "id": "933a3e59-83c6-4c13-b075-193de4871907",
      "name": "If5"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.mercadolibre.com/items",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer APP_USR-7334627525708690-100809-7782bf6d848c6ad490e60499545b1cc4-291859081"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json.item }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -80,
        3088
      ],
      "id": "8f1d18b1-9028-49da-a6aa-79d2c089c832",
      "name": "create product5",
      "retryOnFail": true,
      "waitBetweenTries": 3000
    },
    {
      "parameters": {
        "method": "PUT",
        "url": "=https://api.mercadolibre.com/items/{{ $('HTTP Request5').item.json.results[0] }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer APP_USR-7334627525708690-100809-7782bf6d848c6ad490e60499545b1cc4-291859081"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{$json}}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -80,
        3280
      ],
      "id": "8e0cbc97-25a3-4146-9750-a756416db6fb",
      "name": "update product5",
      "alwaysOutputData": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "3c5d070c-d1b6-498f-9bd8-9342a0e3bc77",
              "name": "title",
              "value": "={{ $('caucho5').item.json.title }}",
              "type": "string"
            },
            {
              "id": "bb11ebbb-a03a-488f-9943-17a97ef43326",
              "name": "price",
              "value": "={{ $('caucho5').item.json.price }}",
              "type": "number"
            },
            {
              "id": "824c7b2e-765a-4fbb-bd8e-a95a7f00f12d",
              "name": "currency_id",
              "value": "={{ $('caucho5').item.json.currency_id }}",
              "type": "string"
            },
            {
              "id": "366e2872-821c-4f2d-a776-69cf7ca2dce8",
              "name": "available_quantity",
              "value": "={{ $('caucho5').item.json.available_quantity }}",
              "type": "number"
            },
            {
              "id": "995e7518-f1fb-49cb-b27e-067bb6e0456a",
              "name": "condition",
              "value": "={{ $('caucho5').item.json.condition }}",
              "type": "string"
            },
            {
              "id": "22764566-a28e-4fb8-a9a4-fc0425449fe5",
              "name": "category_id",
              "value": "={{ $('caucho5').item.json.category_id }}",
              "type": "string"
            },
            {
              "id": "9256e42a-a124-422d-a369-3199dedeac09",
              "name": "pictures",
              "value": "={{ $('caucho5').item.json.pictures }}",
              "type": "array"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -528,
        3280
      ],
      "id": "84b4e30c-9c01-4c7e-9063-e8f89ada4478",
      "name": "Edit Fields15"
    },
    {
      "parameters": {
        "url": "={{ $json.next }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "shopifyAccessTokenApi",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "limit",
              "value": "3"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "fullResponse": true
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1872,
        3264
      ],
      "id": "7879e7ad-4a79-431e-96c9-082c0fb6ff40",
      "name": "Get Products5",
      "notesInFlow": false,
      "credentials": {
        "shopifyAccessTokenApi": {
          "id": "9RO1LDkPgTRAthd9",
          "name": "Test Pedro"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9b2c7cf4-b063-4aab-afe4-b74cb0684a2b",
              "name": "next",
              "value": "={{$('Get Products5').first().json.headers.link.match(/<([^>]+)>; rel=\"next\"/)[1]}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        368,
        3264
      ],
      "id": "5a353c98-b4d2-4edd-bfd6-0993ad88c36a",
      "name": "Edit Fields16",
      "executeOnce": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "54c25536-0a25-44a2-97e4-abcfcfb474f9",
              "name": "item",
              "value": "={{ $('caucho5').item.json }}",
              "type": "object"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -528,
        3088
      ],
      "id": "3b77e6b8-4a4f-49c9-9bd7-8c14bf648ccf",
      "name": "Edit Fields17"
    },
    {
      "parameters": {
        "amount": 1
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -1200,
        3184
      ],
      "id": "19bc65b3-0a3c-4bca-b911-01994120b81b",
      "name": "Wait15",
      "webhookId": "a9e9dc4c-0887-4a25-87ad-0fdc0a74dcf6"
    },
    {
      "parameters": {
        "amount": 1
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -304,
        3088
      ],
      "id": "8597d0db-4b8f-4140-be19-7792dfe74326",
      "name": "Wait16",
      "webhookId": "d36d2f4c-8c59-4501-b046-7e988a16773f"
    },
    {
      "parameters": {
        "amount": 1
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -304,
        3280
      ],
      "id": "9261dde9-3283-437b-b760-b8b574ded772",
      "name": "Wait17",
      "webhookId": "8d68a993-462f-4d3b-bde9-25dce75d1bd8"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        144,
        3184
      ],
      "id": "ad8e1f76-d79c-4816-afaf-49b40075f0b9",
      "name": "Merge"
    },
    {
      "parameters": {
        "url": "=https://api.mercadolibre.com/users/46822039/items/search?q={{ $json.title }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer APP_USR-7334627525708690-102810-35f67e3ab489d703ec44df92b95d87fb-46822039"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1872,
        3664
      ],
      "id": "38256195-c560-4ad0-8024-38dfe1ff3d87",
      "name": "get ML products",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "operation": "get",
        "dataTableId": {
          "__rl": true,
          "value": "NTEgTLrknVeZALGa",
          "mode": "list",
          "cachedResultName": "Pedro test",
          "cachedResultUrl": "/projects/jOPTDk8NtR0eZIqG/datatables/NTEgTLrknVeZALGa"
        },
        "filters": {
          "conditions": [
            {
              "keyName": "user_id",
              "keyValue": "={{ $json.user_id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        -3120,
        4752
      ],
      "id": "ca49f8ee-35ac-481f-9c91-1279e01c2059",
      "name": "Get row(s)"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Webhook').item.json.topic }}",
                    "rightValue": "orders_v2",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "52abe157-bfe0-4cc1-b0c5-68914e1c98d0"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Orders"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "420180f4-07e9-497d-b96b-bba824545a9e",
                    "leftValue": "={{ $('Webhook').item.json.topic }}",
                    "rightValue": "question",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Questions"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -2912,
        4752
      ],
      "id": "dba01592-ce3a-4aa5-92f4-8eebcac42bea",
      "name": "Switch"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "66bf1239-d8a6-47c3-932b-c35d7becbe7a",
              "leftValue": "={{ Math.floor(new Date($now).getTime() / 1000).toString() }}",
              "rightValue": "={{ $json.expires_in }}",
              "operator": {
                "type": "number",
                "operation": "lt"
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -2688,
        4736
      ],
      "id": "fa2c4c0e-97cb-4fe2-9dc3-e8af69d470b9",
      "name": "If"
    },
    {
      "parameters": {
        "url": "=https://api.mercadolibre.com{{ $('Webhook').item.json.resource }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer {{ $json.access_token }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -2480,
        4640
      ],
      "id": "e8b9a50a-a8f8-4d5a-832a-a5553897aeb6",
      "name": "Get Orders"
    },
    {
      "parameters": {
        "resource": "contacts",
        "filter": {
          "name": "={{6.buyer.nickname}} - ID: {{6.buyer.id}}"
        },
        "options": {}
      },
      "type": "n8n-nodes-kommo.kommo",
      "typeVersion": 1,
      "position": [
        -2208,
        4640
      ],
      "id": "33243751-932f-4eed-9b0e-565691fe9f1d",
      "name": "Get list of contacts",
      "credentials": {
        "kommoOAuth2Api": {
          "id": "Br1gBXbgNRoUEYvU",
          "name": "Kommo Long Lived Token account 2"
        }
      }
    }
  ],
  "pinData": {
    "Webhook": [
      {
        "json": {
          "resource": "/orders/2000009714447492",
          "user_id": 46822039,
          "topic": "orders_v2",
          "application_id": 5503910054141466,
          "attempts": 1,
          "sent": "2019-10-30T16:19:20.129Z",
          "received": "2019-10-30T16:19:20.106Z"
        }
      }
    ]
  },
  "repo_name": "flujos_n8n",
  "repo_owner": "whitelabel-ai",
  "repo_path": "Automation/",
  "settings": {
    "executionOrder": "v1"
  },
  "shared": [
    {
      "updatedAt": "2025-10-07T20:01:05.857Z",
      "createdAt": "2025-10-07T20:01:05.857Z",
      "role": "workflow:owner",
      "workflowId": "UzeriRNtkpQe3Hir",
      "projectId": "jOPTDk8NtR0eZIqG"
    }
  ],
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2025-10-29T22:22:01.703Z",
  "versionId": "20fc01f2-643d-44a4-b517-eb2bc3758ea8"
}