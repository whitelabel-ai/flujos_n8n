{
  "active": true,
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "ChatwootData",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "type message Whatsap": {
      "main": [
        [
          {
            "node": "Convert to File",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ],
        [],
        []
      ]
    },
    "DataText": {
      "main": [
        [
          {
            "node": "setData",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "No Operation, do nothing4": {
      "main": [
        [
          {
            "node": "DataText",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DataAudio": {
      "main": [
        [
          {
            "node": "setData",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ChatwootData": {
      "main": [
        [
          {
            "node": "initData",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "whatsappData": {
      "main": [
        [
          {
            "node": "initData",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "whatsap trigger": {
      "main": [
        [
          {
            "node": "whatsappData",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "initData": {
      "main": [
        [
          {
            "node": "type message Whatsap",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "setData": {
      "main": [
        [
          {
            "node": "Get info business",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Transcribe a recording1": {
      "main": [
        [
          {
            "node": "DataAudio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Data": {
      "main": [
        [
          {
            "node": "Qubra",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Qubra",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Redis Chat Memory1": {
      "ai_memory": [
        [
          {
            "node": "Qubra",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Message a model1": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Qubra": {
      "main": [
        [
          {
            "node": "Message a model1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ChatwootData",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generar Informe": {
      "ai_tool": [
        [
          {
            "node": "Qubra",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File": {
      "main": [
        [
          {
            "node": "Transcribe a recording1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "No Operation, do nothing": {
      "main": [
        [
          {
            "node": "No Operation, do nothing4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get info business": {
      "main": [
        [
          {
            "node": "Get categories",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get question from business": {
      "main": [
        [
          {
            "node": "Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-10-23T02:04:28.635Z",
  "id": "sVMDU6eZ4l1Fy9vs",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "Generator Qubra",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "d33f420d-c4e0-4cf8-94a0-7ba44d53d25c",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -336,
        1024
      ],
      "id": "c763c16e-115e-4ed4-8e92-f327f9d6131e",
      "name": "Webhook",
      "webhookId": "d33f420d-c4e0-4cf8-94a0-7ba44d53d25c"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.tipo_mensaje }}",
                    "rightValue": "audio",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "38cdad62-0d9c-45bc-860e-9e03d107ba58"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "audio"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "82df4052-c480-44a2-9d09-c195d4bc6879",
                    "leftValue": "={{ $json.tipo_mensaje }}",
                    "rightValue": "text",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "text"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "d9c1a8cf-af4e-4bca-a66c-184829c009d8",
                    "leftValue": "={{ $json.tipo_mensaje }}",
                    "rightValue": "=file",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "document"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "71778507-22f2-4e0f-99d7-fdd87ed1f26b",
                    "leftValue": "={{ $json.tipo_mensaje }}",
                    "rightValue": "image",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "image"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        336,
        896
      ],
      "id": "fef5aec4-9284-415e-84fb-9ac483ad05f8",
      "name": "type message Whatsap"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9f69a465-0cc7-43dd-97d7-aaee90bacbe3",
              "name": "nombre",
              "value": "={{ $('initData').item.json.nombre }}",
              "type": "string"
            },
            {
              "id": "82031891-32ae-4442-b883-fad57ad08c79",
              "name": "phone_number",
              "value": "={{ $('initData').item.json.phone_number }}",
              "type": "string"
            },
            {
              "id": "8c4da55a-b196-497b-a9ef-c0ce734b8847",
              "name": "mensaje",
              "value": "={{ $('initData').item.json.mensaje }}",
              "type": "string"
            },
            {
              "id": "1abd896c-ea14-41a2-9500-ef9393cc170f",
              "name": "businessId",
              "value": "={{ $('ChatwootData').item.json.businessId }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1008,
        1024
      ],
      "id": "389d7b61-ca01-4989-bf86-d6b00435118c",
      "name": "DataText"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        784,
        1024
      ],
      "id": "6666fe90-750e-4c68-8961-770aebbf4681",
      "name": "No Operation, do nothing4"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9f69a465-0cc7-43dd-97d7-aaee90bacbe3",
              "name": "nombre",
              "value": "={{ $('initData').item.json.nombre }}",
              "type": "string"
            },
            {
              "id": "82031891-32ae-4442-b883-fad57ad08c79",
              "name": "phone_number",
              "value": "={{ $('initData').item.json.phone_number }}",
              "type": "string"
            },
            {
              "id": "8c4da55a-b196-497b-a9ef-c0ce734b8847",
              "name": "mensaje",
              "value": "=<audio>{{ $json.content.parts[0].text }}</audio>",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1008,
        832
      ],
      "id": "744e554f-7f8b-451d-b40b-0dd84661ceb8",
      "name": "DataAudio"
    },
    {
      "parameters": {
        "content": "## Incoming Messages\n",
        "height": 572,
        "width": 704,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -496,
        704
      ],
      "id": "e51c6b37-cb84-4262-ae10-06100b9234c7",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9f69a465-0cc7-43dd-97d7-aaee90bacbe3",
              "name": "nombre",
              "value": "={{ $json.body.conversation.meta.sender.name.split(\" \")[0] }}",
              "type": "string"
            },
            {
              "id": "82031891-32ae-4442-b883-fad57ad08c79",
              "name": "phone_number",
              "value": "={{ $json.body.sessionId }}",
              "type": "string"
            },
            {
              "id": "8c4da55a-b196-497b-a9ef-c0ce734b8847",
              "name": "mensaje",
              "value": "={{ $json.body.message }}",
              "type": "string"
            },
            {
              "id": "01193a9d-40ea-48b1-96f1-592105684644",
              "name": "tipo_mensaje",
              "value": "={{ $json.body.type }}",
              "type": "string"
            },
            {
              "id": "c6b5261d-a252-4328-af15-9699dfc5ba2b",
              "name": "receptor",
              "value": "={{ $json.body.message_type }}",
              "type": "string"
            },
            {
              "id": "8a4d2988-720e-46c1-9927-90f62d5ddd72",
              "name": "tags",
              "value": "={{ $json.body.conversation.labels }}",
              "type": "array"
            },
            {
              "id": "2189dde7-a49e-4226-be25-22f3e62caf99",
              "name": "conversation_id",
              "value": "={{ $json.body.sessionId }}",
              "type": "string"
            },
            {
              "id": "c8242d40-84d3-4c64-adcc-d15b8de57a9a",
              "name": "account_id",
              "value": "={{ $json.body.account.id }}",
              "type": "number"
            },
            {
              "id": "7d6c4435-2ae7-4716-a211-c8d9898dcd48",
              "name": "api_access_token",
              "value": "=AKgj4inXtQC2qoDuxiHxEFtL",
              "type": "string"
            },
            {
              "id": "aad140bb-399a-46df-b78b-98aa0a9fd6e8",
              "name": "=data",
              "value": "={{ $('Webhook').item.binary.audio}}",
              "type": "object"
            },
            {
              "id": "289f0a9d-b47b-46ff-83d5-3e89462f395f",
              "name": "businessId",
              "value": "={{ $json.body.businessId }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -112,
        1024
      ],
      "id": "5d7a04cc-e197-4a81-9b80-5efd8e9041dd",
      "name": "ChatwootData"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "7fba40fd-13ea-470a-a784-d886fa69b736",
              "name": "account_id",
              "value": "={{ $json.metadata.display_phone_number }}",
              "type": "string"
            },
            {
              "id": "cb120617-0a0f-4b8d-8979-909001725c0d",
              "name": "phone_number_id",
              "value": "={{ $json.metadata.phone_number_id }}",
              "type": "string"
            },
            {
              "id": "5276d674-1b57-4af7-88f3-5f9616e64cc3",
              "name": "nombre",
              "value": "={{ $json.contacts[0].profile.name }}",
              "type": "string"
            },
            {
              "id": "92d97526-26b7-461c-b7ec-7cd13074512e",
              "name": "phone_number",
              "value": "={{ $json.contacts[0].wa_id }}",
              "type": "string"
            },
            {
              "id": "0605a012-1740-4b13-8e7f-57e156ad2fbe",
              "name": "mensaje",
              "value": "={{ $json.messages[0].text.body }}",
              "type": "string"
            },
            {
              "id": "5060779d-87fc-49af-9212-c7972aae9ff0",
              "name": "tipo_mensaje",
              "value": "={{ $json.messages[0].type }}",
              "type": "string"
            },
            {
              "id": "358f4697-0d6f-4184-bfbd-31ff4f2e2ac2",
              "name": "tags",
              "value": "={{ $json.field }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -112,
        832
      ],
      "id": "ee1c34e7-37b8-445f-ade5-18d307e45e93",
      "name": "whatsappData"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "db4445da-e4e4-47df-9e60-7167703e0291",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -336,
        832
      ],
      "id": "57d4e2a3-27df-4970-8a02-a89b4bb3ed1b",
      "name": "whatsap trigger",
      "webhookId": "db4445da-e4e4-47df-9e60-7167703e0291",
      "disabled": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "cb120617-0a0f-4b8d-8979-909001725c0d",
              "name": "phone_number_id",
              "value": "={{ $json.phone_number_id }}",
              "type": "string"
            },
            {
              "id": "5276d674-1b57-4af7-88f3-5f9616e64cc3",
              "name": "nombre",
              "value": "={{ $json.nombre }}",
              "type": "string"
            },
            {
              "id": "92d97526-26b7-461c-b7ec-7cd13074512e",
              "name": "phone_number",
              "value": "={{ $json.phone_number }}",
              "type": "string"
            },
            {
              "id": "0605a012-1740-4b13-8e7f-57e156ad2fbe",
              "name": "mensaje",
              "value": "={{ $json.mensaje }}",
              "type": "string"
            },
            {
              "id": "5060779d-87fc-49af-9212-c7972aae9ff0",
              "name": "tipo_mensaje",
              "value": "={{ $json.tipo_mensaje }}",
              "type": "string"
            },
            {
              "id": "358f4697-0d6f-4184-bfbd-31ff4f2e2ac2",
              "name": "tags",
              "value": "={{ $json.tags }}",
              "type": "string"
            },
            {
              "id": "d7bd017f-435b-4c5c-89ba-77b2bdd3d56d",
              "name": "account_id",
              "value": "={{ $json.account_id }}",
              "type": "string"
            },
            {
              "id": "5df9085c-2dab-4895-87b6-26f1a70b74c6",
              "name": "conversation_id",
              "value": "={{ $json.conversation_id }}",
              "type": "string"
            },
            {
              "id": "3b0ab472-eb47-486f-87b8-92fe29a4f764",
              "name": "=data",
              "value": "={{ $json.data }}",
              "type": "object"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        112,
        928
      ],
      "id": "b6e88130-2d7f-47bb-a5ba-03473c655600",
      "name": "initData"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f4f107ad-f4e3-4616-a1ec-515f7324ba23",
              "name": "nombre",
              "value": "={{ $json.nombre }}",
              "type": "string"
            },
            {
              "id": "6f55c6f4-4cb3-4cec-9d31-b956d3fffde0",
              "name": "phone_number",
              "value": "={{ $json.phone_number }}",
              "type": "string"
            },
            {
              "id": "bad14eb8-f005-4d91-bd83-600e6105d974",
              "name": "mensaje",
              "value": "={{ $json.mensaje }}",
              "type": "string"
            },
            {
              "id": "a4895cfb-af6e-49c8-a57c-23a43d43e913",
              "name": "businessId",
              "value": "={{ $json.businessId }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1232,
        928
      ],
      "id": "a68383e0-e0f9-4e29-9b43-65b4124c89fb",
      "name": "setData"
    },
    {
      "parameters": {
        "resource": "audio",
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-flash",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-flash"
        },
        "inputType": "binary",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        784,
        832
      ],
      "id": "b2d5c6fb-7a0e-4fbe-8478-5e41c727f191",
      "name": "Transcribe a recording1",
      "credentials": {
        "googlePalmApi": {
          "id": "jQiccHfpS9BFKE4C",
          "name": "automation.whitelabel.lat"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "4e6ed31c-2d8f-4415-bdaf-404a870f1cc2",
              "name": "first_name",
              "value": "={{ $('setData').item.json.nombre.split(\" \")[0] }}",
              "type": "string"
            },
            {
              "id": "f312aa42-4354-4954-92ff-9549a49c1d5b",
              "name": "user_id",
              "value": "={{ $('setData').item.json.phone_number }}",
              "type": "string"
            },
            {
              "id": "b89d5418-df60-419b-84f6-5bc7bc0dd09b",
              "name": "message",
              "value": "={{ $json.mensaje }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2208,
        928
      ],
      "id": "739d792e-7d10-47ca-ade1-b66d35e1eb30",
      "name": "Data"
    },
    {
      "parameters": {
        "content": "## AGENT MAIN",
        "height": 600,
        "width": 848
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1200,
        704
      ],
      "id": "b568eb8c-de1f-48d0-b987-eb714b8b7c08",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "## RESPONS AGENT",
        "height": 600,
        "width": 696,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        2096,
        688
      ],
      "id": "6cb96f71-df4f-41ff-af4e-ffb497683090",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-flash-preview-05-20",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        2208,
        1216
      ],
      "id": "5e445a78-043f-4c5c-8981-26c18b236626",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "jQiccHfpS9BFKE4C",
          "name": "automation.whitelabel.lat"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "=chat_history_qubra_{{ $('Data').item.json.user_id }}",
        "sessionTTL": 500000,
        "contextWindowLength": 25
      },
      "type": "@n8n/n8n-nodes-langchain.memoryRedisChat",
      "typeVersion": 1.5,
      "position": [
        2384,
        1280
      ],
      "id": "93519c38-752a-4abf-9333-1c231a177562",
      "name": "Redis Chat Memory1",
      "credentials": {
        "redis": {
          "id": "yzvE00xFtVHtaoZ1",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "GPT-4O-MINI"
        },
        "messages": {
          "values": [
            {
              "content": "=Divide el siguiente mensaje en hasta **4 partes m√°s peque√±as** solo si es necesario, asegur√°ndote de que cada parte tenga sentido completo.  \n\n### **Reglas:**  \n- Si el mensaje es *corto* (hasta *160 caracteres*), devu√©lvelo en **una sola parte**.  \n- Si es *mediano* (hasta *400 caracteres*), div√≠delo en **2 partes**.  \n- Si es *largo* (hasta *600 caracteres*), div√≠delo en **3 partes**. \n- Si es *muy largo* (m√°s de *600 caracteres*), agr√©gale una **parte4**.  \n\n- **Evita dividir el mensaje innecesariamente**. Usa la **menor cantidad de partes posible**.  \n- **No cortes oraciones en puntos, comas o conectores** para mantener la coherencia.  \n- **Reemplaza siempre la palabra \"Dosis\" por \"Cantidad\"**.  \n- **No incluyas datos sensibles** en la respuesta, como:  \n  - `user_id: <n√∫mero>`  \n  - `subscriber_id: <n√∫mero>`  \n  - `first_name: <nombre>`  \n  - **Elimina estos datos sin dejar rastros.**  \n\n---\n\n### **Formato de Salida:**  \n- Devuelve la respuesta en **formato JSON** con **solo las partes necesarias**.  \n- Usa `\\n\\n` para agregar saltos de l√≠nea cuando sea necesario o para mejorar la legibilidad en listas.  \n- **Nunca uses comillas `\"` para resaltar palabras**. En su lugar, usa un solo asterisco: *palabra*.  \n\n#### **Ejemplo de salida:**  \n\n{\n  \"parte1\": \"Texto de la primera parte.\",\n  \"parte2\": \"Texto de la segunda parte.\"\n}\n\nIMPORTANTE:\ncuando detectes que llegue un informecompleto bien estructurado en formato markdoun con titulo... tipo objeto{ ... }: todo lo que llegue dentro de Informe: lo debes enviar en una sola parte, sin cortar nada, ignoras las Reglas de esa parte que contiene el Informe, envias en una sola parte asi:\n\"Informe\": \"todo el contenido que llegue despues\"\n\n{\n  \"parte1\": \"Texto de la primera parte.\",\n  \"parte2\": \"Texto de la segunda parte.\",\n  \"Informe\": \"Texto con todo el contenido del Informe completo\"\n}\n---\n\n### **Mensaje:**  \n\"{{ $json.output }}\" \n\n"
            }
          ]
        },
        "jsonOutput": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        2768,
        928
      ],
      "id": "cbbb0c81-3e40-4306-82b3-65fbc8d6aa19",
      "name": "Message a model1",
      "retryOnFail": true,
      "waitBetweenTries": 2000,
      "credentials": {
        "openAiApi": {
          "id": "UYsXoFpwT6Oh1GeF",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json.message.content }}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        3120,
        928
      ],
      "id": "e10bbbda-ade3-4ac8-8be2-e55b78672466",
      "name": "Respond to Webhook"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=mensaje del usuario: \"{{ $json.message }}\",",
        "options": {
          "systemMessage": "=# Identidad de Qubra\n\nEres Qubra, el \"Curador Digital\" y agente conversacional oficial de Vanguardistas.\n\nTu misi√≥n es guiar a empresarios, due√±os de pymes y marcas personales en un viaje consultivo y estrat√©gico para descubrir su esencia, diagnosticar sus retos y preparar la informaci√≥n necesaria para que se genere un informe profesional de diagn√≥stico.\n\nNo eres un chatbot gen√©rico: eres un consultor emp√°tico, estrat√©gico y motivador, con personalidad art√≠stica y profesional.\n\nfecha y hora hoy: {{ $now }}\n\n## Personalidad\n\nCombinas 4 arquetipos:\n\n- üé® Artista Creador: Usas met√°foras y un lenguaje cercano, inspirador, creativo. Ayudas al usuario a ‚Äúpintar‚Äù la esencia de su marca con autenticidad.\n\n- üìä Estratega Anal√≠tico: Haces preguntas inteligentes, detectas patrones, sintetizas con claridad. Desarmas problemas de manera l√≥gica y accesible.\n\n- üèóÔ∏è Constructor de Futuro: Orientas hacia el cambio, mostrando nuevas perspectivas y posibilidades de mejora, evitando soluciones gen√©ricas.\n\n- ü§ù Socio Estrat√©gico: Te pones en los zapatos del usuario, entiendes su negocio y contexto real, y traduces lo complejo en ideas claras y aplicables.\n\nTu tono es cercano, profesional, claro, estrat√©gico, emp√°tico y aut√©ntico.\n\n---\n\n# Principios Fundamentales de Qubra\n\n‚úÖ Autenticidad y Prop√≥sito: Cada interacci√≥n debe reflejar la singularidad del usuario y conectar con lo que da sentido a su marca. Nunca dar respuestas gen√©ricas ni superficiales.\n\n‚úÖ Claridad y Simplicidad (anti-tecnicismos): Evita jerga t√©cnica o lenguaje fr√≠o. Explica siempre en t√©rminos humanos y accesibles, para que todo sea comprensible y accionable.\n\n‚úÖ Empat√≠a y Validaci√≥n Emocional: Reconoce frustraciones, miedos y deseos. No solo valides con frases amables: demuestra comprensi√≥n real y genera confianza a trav√©s del acompa√±amiento.\n\n‚úÖ Disrupci√≥n y Perspectivas √önicas: No te limites a repetir problemas. Muestra nuevas formas de ver el negocio, oportunidades inesperadas y caminos personalizados.\n\n‚úÖ Socio Estrat√©gico: Habla como un aliado del negocio, vinculando siempre el diagn√≥stico con la vida real del usuario (ventas, clientes, tiempo, esfuerzo).\n\n‚ùå Nunca usar un tono vendedor agresivo.\n\n‚ùå Nunca ofrecer soluciones enlatadas o impersonales.\n\n‚ùå Nunca abrumar con exceso de informaci√≥n.\n\n‚ùå Nunca juzgar o minimizar las respuestas del usuario."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        2368,
        928
      ],
      "id": "5b3cbad3-a19b-4500-9154-1970f52cae35",
      "name": "Qubra",
      "retryOnFail": true,
      "waitBetweenTries": 3000,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "description": "cuando tengas las respuestas completas del usuario llama esta tool para generar el informe.",
        "workflowId": {
          "__rl": true,
          "value": "kU6PQmiycPyk0PMH",
          "mode": "list",
          "cachedResultName": "informe"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "¬øQu√© es lo que te inspira a trabajar cada d√≠a?": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('_Qu__es_lo_que_te_inspira_a_trabajar_cada_d_a_', `respuesta del usuario a la pregunta ¬øQu√© es lo que te inspira a trabajar cada d√≠a?`, 'string') }}",
            "user_name": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('user_name', ``, 'string') }}",
            "user_email": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('user_email', ``, 'string') }}",
            "user_empresa": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('user_empresa', `nombre de la empresa del usuario`, 'string') }}",
            "¬øQu√© vendes y a qu√© sector te diriges?": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('_Qu__vendes_y_a_qu__sector_te_diriges_', `respuesta del usuario a la pregunta Qu√© vendes y a qu√© sector te diriges?`, 'string') }}",
            "¬øQu√© emociones quieres que tu marca transmita a tus clientes?": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('_Qu__emociones_quieres_que_tu_marca_transmita_a_tus_clientes_', `respuesta del usuario a la pregunta ¬øQu√© emociones quieres que tu marca transmita a tus clientes?`, 'string') }}",
            "¬øHasta qu√© punto conoces a profundidad a tu cliente ideal y el problema espec√≠fico que tu marca/empresa resuelve para ellos?": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('_Hasta_qu__punto_conoces_a_profundidad_a_tu_cliente_ideal_y_el_', `respuesta del usuario a la pregunta ¬øHasta qu√© punto conoces a profundidad a tu cliente ideal y el problema espec√≠fico que tu marca/empresa resuelve para ellos?`, 'string') }}",
            "¬øC√≥mo describir√≠as la experiencia que tus clientes viven al interactuar con tu marca?": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('_C_mo_describir_as_la_experiencia_que_tus_clientes_viven_al_int', `respuesta del usuario a la pregunta ¬øC√≥mo describir√≠as la experiencia que tus clientes viven al interactuar con tu marca?`, 'string') }}",
            "¬øQu√© tan visible eres a nivel digital?": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('_Qu__tan_visible_eres_a_nivel_digital_', `respuesta del usuario a la pregunta`, 'string') }}",
            "¬øQu√© objetivo refleja mejor lo que quieres lograr con tu marca a nivel digital?": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('_Qu__objetivo_refleja_mejor_lo_que_quieres_lograr_con_tu_marca_', `respuesta del usuario a la pregunta ¬øQu√© tan visible eres a nivel digital?`, 'string') }}",
            "¬øCu√°les son los recursos existentes que cuentas actualmente para mejorar tu presencia digital?": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('_Cu_les_son_los_recursos_existentes_que_cuentas_actualmente_par', `respuesta del usuario a la pregunta ¬øQu√© objetivo refleja mejor lo que quieres lograr con tu marca a nivel digital?`, 'string') }}",
            "Cuando mires atr√°s, ¬øqu√© te har√° sentir que este proceso ha sido un √©xito para tu negocio?": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Cuando_mires_atr_s___qu__te_har__sentir_que_este_proceso_ha_sid', `respuesta del usuario a la pregunta ¬øCu√°les son los recursos existentes que cuentas actualmente para mejorar tu presencia digital?`, 'string') }}",
            "¬øCu√°l es el principal problema que enfrentas con respecto a tus ventas hoy?": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('_Cu_l_es_el_principal_problema_que_enfrentas_con_respecto_a_tus', `respuesta del usuario a la pregunta \n¬øCu√°l es el principal problema que enfrentas con respecto a tus ventas hoy?`, 'string') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "user_name",
              "displayName": "user_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "user_email",
              "displayName": "user_email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "user_empresa",
              "displayName": "user_empresa",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "¬øQu√© es lo que te inspira a trabajar cada d√≠a?",
              "displayName": "¬øQu√© es lo que te inspira a trabajar cada d√≠a?",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "¬øQu√© vendes y a qu√© sector te diriges?",
              "displayName": "¬øQu√© vendes y a qu√© sector te diriges?",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "¬øQu√© emociones quieres que tu marca transmita a tus clientes?",
              "displayName": "¬øQu√© emociones quieres que tu marca transmita a tus clientes?",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "¬øCu√°l es el principal problema que enfrentas con respecto a tus ventas hoy?",
              "displayName": "¬øCu√°l es el principal problema que enfrentas con respecto a tus ventas hoy?",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "¬øHasta qu√© punto conoces a profundidad a tu cliente ideal y el problema espec√≠fico que tu marca/empresa resuelve para ellos?",
              "displayName": "¬øHasta qu√© punto conoces a profundidad a tu cliente ideal y el problema espec√≠fico que tu marca/empresa resuelve para ellos?",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "¬øC√≥mo describir√≠as la experiencia que tus clientes viven al interactuar con tu marca?",
              "displayName": "¬øC√≥mo describir√≠as la experiencia que tus clientes viven al interactuar con tu marca?",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "¬øQu√© tan visible eres a nivel digital?",
              "displayName": "¬øQu√© tan visible eres a nivel digital?",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "¬øQu√© objetivo refleja mejor lo que quieres lograr con tu marca a nivel digital?",
              "displayName": "¬øQu√© objetivo refleja mejor lo que quieres lograr con tu marca a nivel digital?",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "¬øCu√°les son los recursos existentes que cuentas actualmente para mejorar tu presencia digital?",
              "displayName": "¬øCu√°les son los recursos existentes que cuentas actualmente para mejorar tu presencia digital?",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "Cuando mires atr√°s, ¬øqu√© te har√° sentir que este proceso ha sido un √©xito para tu negocio?",
              "displayName": "Cuando mires atr√°s, ¬øqu√© te har√° sentir que este proceso ha sido un √©xito para tu negocio?",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        2576,
        1248
      ],
      "id": "2f60064a-6ded-46c4-a30f-c0a996168d66",
      "name": "Generar Informe"
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "data.data",
        "binaryPropertyName": "=data",
        "options": {
          "fileName": "={{ $json.data.fileName }}",
          "mimeType": "={{ $json.data.mimeType }}"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        560,
        832
      ],
      "id": "fe1ee2ef-ed0b-41d9-bb92-dabef9873769",
      "name": "Convert to File"
    },
    {
      "parameters": {
        "content": "## audio/text\n",
        "height": 588,
        "width": 896,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        272,
        704
      ],
      "id": "bd0dd966-da65-4d37-846d-854c15a85335",
      "name": "Sticky Note"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        560,
        1024
      ],
      "id": "cb5a87e1-e176-48c5-8c03-cf8558606dca",
      "name": "No Operation, do nothing"
    },
    {
      "parameters": {
        "authentication": "nocoDbApiToken",
        "projectId": "p292gja07xvw4en",
        "table": "m3ayktud7ld7xjb",
        "id": "={{ $json.businessId }}"
      },
      "type": "n8n-nodes-base.nocoDb",
      "typeVersion": 3,
      "position": [
        1440,
        928
      ],
      "id": "485d5f1f-6078-44f2-9ff8-73f1444dee6a",
      "name": "Get info business",
      "credentials": {
        "nocoDbApiToken": {
          "id": "uRuRbHNOx2HQX2Af",
          "name": "Qubra NocoDB"
        }
      }
    },
    {
      "parameters": {
        "authentication": "nocoDbApiToken",
        "operation": "getAll",
        "projectId": "p292gja07xvw4en",
        "table": "mhfhw24xx3w7nho",
        "returnAll": true,
        "options": {
          "fields": [
            "type,Id,section,Businesses_id,section_description,key_points,question"
          ],
          "where": "=(Businesses_id,eq,{{ $json.Id }})"
        }
      },
      "type": "n8n-nodes-base.nocoDb",
      "typeVersion": 3,
      "position": [
        1856,
        800
      ],
      "id": "efe775a3-e002-4126-83fc-7040f5d1eef9",
      "name": "Get question from business",
      "credentials": {
        "nocoDbApiToken": {
          "id": "uRuRbHNOx2HQX2Af",
          "name": "Qubra NocoDB"
        }
      }
    },
    {
      "parameters": {
        "authentication": "nocoDbApiToken",
        "operation": "getAll",
        "projectId": "p292gja07xvw4en",
        "table": "mcml8t0sf04gf5z",
        "returnAll": true,
        "options": {
          "where": "={{ 'Businesses_id' === $json.Id}}"
        }
      },
      "type": "n8n-nodes-base.nocoDb",
      "typeVersion": 3,
      "position": [
        1664,
        1008
      ],
      "id": "2a2ee70c-ce51-4a6a-b1b1-7f922eab6152",
      "name": "Get categories",
      "credentials": {
        "nocoDbApiToken": {
          "id": "uRuRbHNOx2HQX2Af",
          "name": "Qubra NocoDB"
        }
      }
    }
  ],
  "pinData": {
    "whatsap trigger": [
      {
        "json": {
          "messaging_product": "whatsapp",
          "metadata": {
            "display_phone_number": "573143400476",
            "phone_number_id": "735679592965149"
          },
          "contacts": [
            {
              "profile": {
                "name": "Pedro Rodriguez"
              },
              "wa_id": "573228854498"
            }
          ],
          "messages": [
            {
              "from": "573228854498",
              "id": "wamid.HBgMNTczMjI4ODU0NDk4FQIAEhgUM0ZCOUNFRjE5M0FFNzZENzAxQUEA",
              "timestamp": "1755298718",
              "text": {
                "body": "organizar gastos"
              },
              "type": "text"
            }
          ],
          "field": "messages"
        }
      }
    ],
    "Webhook": [
      {
        "json": {
          "headers": {
            "host": "automation.whitelabel.lat",
            "user-agent": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36",
            "content-length": "1269",
            "accept": "*/*",
            "accept-encoding": "gzip, deflate, br, zstd",
            "accept-language": "es-419,es;q=0.9",
            "content-type": "application/json",
            "origin": "https://vanguardistas.co",
            "priority": "u=1, i",
            "referer": "https://vanguardistas.co/",
            "sec-ch-ua": "\"Not;A=Brand\";v=\"99\", \"Brave\";v=\"139\", \"Chromium\";v=\"139\"",
            "sec-ch-ua-mobile": "?0",
            "sec-ch-ua-platform": "\"Linux\"",
            "sec-fetch-dest": "empty",
            "sec-fetch-mode": "cors",
            "sec-fetch-site": "cross-site",
            "sec-gpc": "1",
            "x-forwarded-for": "217.9.247.5",
            "x-forwarded-host": "automation.whitelabel.lat",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "4f3b0c84f963",
            "x-real-ip": "217.9.247.5"
          },
          "params": {},
          "query": {},
          "body": {
            "message": "For me, the success of this process won't be measured solely by hard numbers, but by the impact we make on our clients' lives. I will have achieved success when, looking back, I see three tangible results:  A community, not just an audience: The greatest indicator of success would be having created a steady stream of \"creators\" who find us, not through advertising, but organically. More importantly, these leads become an active community, where the process of seeking clarity is shared and people recommend Imaginary Oasis as the indispensable tool.  Increase in qualitative conversion: An increase in the number of sales is important, but the real victory would be to see an increase in the conversion rate of our leads to clients. This would tell us that the digital strategy is attracting the right people: those who genuinely need and value the clarity we offer.  Reduction in sales effort: Currently, manual sales funnel management is inefficient. Success would be for the process to be automated, allowing our \"sellers\" (in this case, the brand's systems) to focus on the most valuable part of the experience: co-creating the solution, rather than on manual follow-up.",
            "sessionId": "session_77a77684-ae7e-48a7-b4e6-c3ea42a450f5",
            "type": "text",
            "businessId": "13"
          },
          "webhookUrl": "https://automation.whitelabel.lat/webhook/Qubra",
          "executionMode": "production"
        }
      }
    ]
  },
  "repo_name": "flujos_n8n",
  "repo_owner": "whitelabel-ai",
  "repo_path": "Automation/",
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "errorWorkflow": "7CI8d1lC1EC1eqnL"
  },
  "shared": [
    {
      "createdAt": "2025-10-23T02:04:28.635Z",
      "updatedAt": "2025-10-23T02:04:28.635Z",
      "role": "workflow:owner",
      "workflowId": "sVMDU6eZ4l1Fy9vs",
      "projectId": "jOPTDk8NtR0eZIqG"
    }
  ],
  "staticData": null,
  "tags": [],
  "triggerCount": 1,
  "updatedAt": "2025-10-23T03:14:07.729Z",
  "versionId": "c893f44f-2fb1-4856-9418-da48a6412f13"
}