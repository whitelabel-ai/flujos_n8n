{
  "active": false,
  "activeVersion": null,
  "activeVersionId": null,
  "connections": {
    "Switch tipo_registro": {
      "main": [
        [
          {
            "node": "Validar NIT",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Validar nit_cliente",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Validar sede_id",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Buscar Sede",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Validar NIT": {
      "main": [
        [
          {
            "node": "Buscar cliente por nit",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Falta NIT (Respuesta)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿Cliente existe?": {
      "main": [
        [
          {
            "node": "Cliente ya existe",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "CREAR CLIENTE1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Buscar cliente por nit": {
      "main": [
        [
          {
            "node": "¿Cliente existe?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CREAR CLIENTE1": {
      "main": [
        [
          {
            "node": "Respuesta Creado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Validar nit_cliente": {
      "main": [
        [
          {
            "node": "Buscar cliente por nit1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Falta NIT (Respuesta)1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿Sede duplicada?": {
      "main": [
        [
          {
            "node": "Sede ya existe",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Obtener Ultima sede_id",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿Cliente existe?1": {
      "main": [
        [
          {
            "node": "Cliente NO existe",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Buscar sede duplicada",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Buscar cliente por nit1": {
      "main": [
        [
          {
            "node": "¿Cliente existe?1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Buscar sede duplicada": {
      "main": [
        [
          {
            "node": "¿Sede duplicada?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener Ultima sede_id": {
      "main": [
        [
          {
            "node": "Generar consecutivo sedeXXX",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generar consecutivo sedeXXX": {
      "main": [
        [
          {
            "node": "crear sede",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "crear sede": {
      "main": [
        [
          {
            "node": "Respuesta Creado1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Validar sede_id": {
      "main": [
        [
          {
            "node": "buscar sede existente",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Falta sede_id",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿La sede existe?": {
      "main": [
        [
          {
            "node": "Sede NO existe",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Buscar sede duplicada1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿Serial duplicado?": {
      "main": [
        [
          {
            "node": "Serial ya existe",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Obtener Ultima sede_id1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "buscar sede existente": {
      "main": [
        [
          {
            "node": "¿La sede existe?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Buscar sede duplicada1": {
      "main": [
        [
          {
            "node": "¿Serial duplicado?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener Ultima sede_id1": {
      "main": [
        [
          {
            "node": "Generar consecutivo  eqXXX",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generar consecutivo  eqXXX": {
      "main": [
        [
          {
            "node": "crear equipo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "crear equipo": {
      "main": [
        [
          {
            "node": "Respuesta Creado2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Buscar Sede": {
      "main": [
        [
          {
            "node": "¿Sede Existe?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿Sede Existe?": {
      "main": [
        [
          {
            "node": "Error: Sede No Existe",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Buscar Serial Duplicado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Buscar Serial Duplicado": {
      "main": [
        [
          {
            "node": "¿Serial Existe?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿Serial Existe?": {
      "main": [
        [
          {
            "node": "Error: Serial Ya Existe",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Obtener Equipos (para ID)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtener Equipos (para ID)": {
      "main": [
        [
          {
            "node": "Generar ID eq###",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generar ID eq###": {
      "main": [
        [
          {
            "node": "Crear Equipo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Crear Equipo": {
      "main": [
        [
          {
            "node": "Calcular Próximo Mantenimiento",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Calcular Próximo Mantenimiento": {
      "main": [
        [
          {
            "node": "Crear Cronograma",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Crear Cronograma": {
      "main": [
        [
          {
            "node": "Responder al Agente",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "Switch tipo_registro",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-11-21T05:47:33.795Z",
  "id": "eaTazfBQJNo94wDe",
  "isArchived": true,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "crear_equipo_y_cronograma",
  "nodes": [
    {
      "parameters": {},
      "id": "d3054561-df35-4dc9-b66a-b8873fc08780",
      "name": "Switch tipo_registro",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 1,
      "position": [
        96,
        560
      ]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{$json[\"payload\"][\"nit\"]}}",
              "operation": "isEmpty"
            }
          ]
        }
      },
      "id": "917ff368-2cab-4442-b4aa-c7ec90be35ef",
      "name": "Validar NIT",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        704,
        -464
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "916da4ca-cc87-4a7e-abe9-4a25d5bd59f4",
      "name": "Falta NIT (Respuesta)",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        912,
        -288
      ]
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{$json[\"list\"][\"length\"]}}",
              "operation": "larger"
            }
          ]
        }
      },
      "id": "c3bf6613-66cd-466e-9ddb-dbca4e9b8793",
      "name": "¿Cliente existe?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        1232,
        -480
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "8c049dca-3454-4aa2-a24a-3f8e1dccd04e",
      "name": "Cliente ya existe",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        1536,
        -704
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "c74e6ef1-e843-4dd8-b61e-37533a55e42a",
      "name": "Respuesta Creado",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        1776,
        -464
      ]
    },
    {
      "parameters": {
        "authentication": "nocoDbApiToken",
        "projectId": "pt2jl7502mka8xd",
        "table": "m58lt3zk9pd4acn",
        "id": "=nit = {{$json.payload.nit}}"
      },
      "type": "n8n-nodes-base.nocoDb",
      "typeVersion": 3,
      "position": [
        992,
        -480
      ],
      "id": "427c42c0-a3ca-49fb-8b55-6d2e73ef7446",
      "name": "Buscar cliente por nit",
      "credentials": {
        "nocoDbApiToken": {
          "id": "PngKKQ0D2nKSCDu8",
          "name": "Tool Acondicionados SAS"
        }
      }
    },
    {
      "parameters": {
        "authentication": "nocoDbApiToken",
        "operation": "create",
        "projectId": "pt2jl7502mka8xd",
        "table": "m58lt3zk9pd4acn",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldName": "cliente_id"
            },
            {
              "fieldName": "razon_social",
              "fieldValue": "={{ $json.cliente }}"
            },
            {
              "fieldName": "tipo_documento"
            },
            {
              "fieldValue": "persona_encargada"
            },
            {
              "fieldName": "persona_encargada"
            },
            {
              "fieldName": "direccion_principal"
            },
            {
              "fieldName": "telefono_contacto"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.nocoDb",
      "typeVersion": 3,
      "position": [
        1536,
        -464
      ],
      "id": "73db3c06-d70c-4f3f-a40f-b1a186443337",
      "name": "CREAR CLIENTE1",
      "credentials": {
        "nocoDbApiToken": {
          "id": "PngKKQ0D2nKSCDu8",
          "name": "Tool Acondicionados SAS"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{$json.payload.nit_cliente}}",
              "operation": "isEmpty"
            }
          ]
        }
      },
      "id": "85044468-5363-4335-ac5d-13b008954c3d",
      "name": "Validar nit_cliente",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        624,
        240
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "ad0d52fa-986a-4b9c-9475-000a12d34b69",
      "name": "Cliente NO existe",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        1472,
        32
      ]
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{$json.data.length}}",
              "operation": "larger"
            }
          ]
        }
      },
      "id": "08d1f963-8d44-4b60-8aa5-8e045443985a",
      "name": "¿Sede duplicada?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        1792,
        240
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "e45f1304-89ab-445f-b4ef-09763bb17d16",
      "name": "Sede ya existe",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        2096,
        32
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "e077a075-1bba-4501-a39c-367c51c5c96e",
      "name": "Falta NIT (Respuesta)1",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        832,
        416
      ]
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{$json.data.length}}",
              "operation": "equal"
            }
          ]
        }
      },
      "id": "a913d3f3-8521-45da-8e5f-13b01a92f53a",
      "name": "¿Cliente existe?1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        1152,
        224
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "03082081-d6a6-4d9f-b176-aca3e5a30dd8",
      "name": "Respuesta Creado1",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        2800,
        256
      ]
    },
    {
      "parameters": {
        "authentication": "nocoDbApiToken",
        "projectId": "pt2jl7502mka8xd",
        "table": "m58lt3zk9pd4acn",
        "id": "=nit = {{$json.payload.nit}}"
      },
      "type": "n8n-nodes-base.nocoDb",
      "typeVersion": 3,
      "position": [
        912,
        224
      ],
      "id": "368d0c24-16d8-43ea-ab25-a320b359bfac",
      "name": "Buscar cliente por nit1",
      "credentials": {
        "nocoDbApiToken": {
          "id": "PngKKQ0D2nKSCDu8",
          "name": "Tool Acondicionados SAS"
        }
      }
    },
    {
      "parameters": {
        "authentication": "nocoDbApiToken",
        "projectId": "pt2jl7502mka8xd",
        "table": "m58lt3zk9pd4acn",
        "id": "=nit = {{$json.payload.nit}}"
      },
      "type": "n8n-nodes-base.nocoDb",
      "typeVersion": 3,
      "position": [
        1520,
        240
      ],
      "id": "1ef63d99-9457-4100-b70e-d8e8e9c3a78a",
      "name": "Buscar sede duplicada",
      "credentials": {
        "nocoDbApiToken": {
          "id": "PngKKQ0D2nKSCDu8",
          "name": "Tool Acondicionados SAS"
        }
      }
    },
    {
      "parameters": {
        "authentication": "nocoDbApiToken",
        "projectId": "pt2jl7502mka8xd",
        "table": "m58lt3zk9pd4acn",
        "id": "=nit = {{$json.payload.nit}}"
      },
      "type": "n8n-nodes-base.nocoDb",
      "typeVersion": 3,
      "position": [
        2080,
        256
      ],
      "id": "0ba08499-141c-455e-8bc3-a9ffca1d71c3",
      "name": "Obtener Ultima sede_id",
      "credentials": {
        "nocoDbApiToken": {
          "id": "PngKKQ0D2nKSCDu8",
          "name": "Tool Acondicionados SAS"
        }
      }
    },
    {
      "parameters": {
        "functionCode": "const last = $json.data[0]?.sede_id || \"sede000\";\nconst num = parseInt(last.replace(\"sede\", \"\")) + 1;\nconst padded = String(num).padStart(3, \"0\");\nreturn [{ sede_id: `sede${padded}` }];"
      },
      "id": "8726596c-8926-4f05-8b27-c235a1ec027a",
      "name": "Generar consecutivo sedeXXX",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        2320,
        256
      ]
    },
    {
      "parameters": {
        "authentication": "nocoDbApiToken",
        "projectId": "pt2jl7502mka8xd",
        "table": "m58lt3zk9pd4acn",
        "id": "=nit = {{$json.payload.nit}}"
      },
      "type": "n8n-nodes-base.nocoDb",
      "typeVersion": 3,
      "position": [
        2560,
        256
      ],
      "id": "5bd1b57b-09db-4f0b-8b9c-c3cba5604cac",
      "name": "crear sede",
      "credentials": {
        "nocoDbApiToken": {
          "id": "PngKKQ0D2nKSCDu8",
          "name": "Tool Acondicionados SAS"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{$json.payload.sede_id}}",
              "operation": "isEmpty"
            }
          ]
        }
      },
      "id": "e473d142-3dd3-48f4-807d-a9e2575ab655",
      "name": "Validar sede_id",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        640,
        912
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "219297e1-a473-4797-b81a-f56757bf1126",
      "name": "Falta sede_id",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        880,
        1120
      ]
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{$json.data.length}}",
              "operation": "equal"
            }
          ]
        }
      },
      "id": "0fc4c8bb-f744-44c0-b52a-b3619823c956",
      "name": "¿La sede existe?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        1200,
        896
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "9a61f434-f249-43c6-922b-73324e208c18",
      "name": "Sede NO existe",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        1520,
        640
      ]
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{$json.data.length}}",
              "operation": "larger"
            }
          ]
        }
      },
      "id": "28823725-12eb-4a3b-b482-5440987a9878",
      "name": "¿Serial duplicado?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        1680,
        912
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "f8f736c3-1a9b-4ff0-af3d-000984ba2915",
      "name": "Serial ya existe",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        2000,
        720
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "d14ff7e3-c13e-4156-948c-75f171f43609",
      "name": "Respuesta Creado2",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        2784,
        928
      ]
    },
    {
      "parameters": {
        "authentication": "nocoDbApiToken",
        "projectId": "pt2jl7502mka8xd",
        "table": "m58lt3zk9pd4acn",
        "id": "=nit = {{$json.payload.nit}}"
      },
      "type": "n8n-nodes-base.nocoDb",
      "typeVersion": 3,
      "position": [
        960,
        896
      ],
      "id": "7d610cb6-dc35-4806-b1f5-aeee43f04e78",
      "name": "buscar sede existente",
      "credentials": {
        "nocoDbApiToken": {
          "id": "PngKKQ0D2nKSCDu8",
          "name": "Tool Acondicionados SAS"
        }
      }
    },
    {
      "parameters": {
        "authentication": "nocoDbApiToken",
        "projectId": "pt2jl7502mka8xd",
        "table": "m58lt3zk9pd4acn",
        "id": "=nit = {{$json.payload.nit}}"
      },
      "type": "n8n-nodes-base.nocoDb",
      "typeVersion": 3,
      "position": [
        1456,
        912
      ],
      "id": "d4147a71-6321-489e-97df-902b5c4673ba",
      "name": "Buscar sede duplicada1",
      "credentials": {
        "nocoDbApiToken": {
          "id": "PngKKQ0D2nKSCDu8",
          "name": "Tool Acondicionados SAS"
        }
      }
    },
    {
      "parameters": {
        "authentication": "nocoDbApiToken",
        "projectId": "pt2jl7502mka8xd",
        "table": "m58lt3zk9pd4acn",
        "id": "=nit = {{$json.payload.nit}}"
      },
      "type": "n8n-nodes-base.nocoDb",
      "typeVersion": 3,
      "position": [
        2000,
        928
      ],
      "id": "dfcff186-869d-44d5-b27e-5dcbba641416",
      "name": "Obtener Ultima sede_id1",
      "credentials": {
        "nocoDbApiToken": {
          "id": "PngKKQ0D2nKSCDu8",
          "name": "Tool Acondicionados SAS"
        }
      }
    },
    {
      "parameters": {
        "functionCode": "const last = $json.data[0]?.id_equipo || \"eq000\";\nconst num = parseInt(last.replace(\"eq\", \"\")) + 1;\nconst padded = String(num).padStart(3, \"0\");\nreturn [{ id_equipo: `eq${padded}` }];"
      },
      "id": "ea7c104c-320e-4b45-8e0d-3a19cfa7aa1b",
      "name": "Generar consecutivo  eqXXX",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        2272,
        928
      ]
    },
    {
      "parameters": {
        "authentication": "nocoDbApiToken",
        "projectId": "pt2jl7502mka8xd",
        "table": "m58lt3zk9pd4acn",
        "id": "=nit = {{$json.payload.nit}}"
      },
      "type": "n8n-nodes-base.nocoDb",
      "typeVersion": 3,
      "position": [
        2544,
        928
      ],
      "id": "ab770349-e28e-415b-8510-96c7ce3abd33",
      "name": "crear equipo",
      "credentials": {
        "nocoDbApiToken": {
          "id": "PngKKQ0D2nKSCDu8",
          "name": "Tool Acondicionados SAS"
        }
      }
    },
    {
      "parameters": {
        "url": "https://nocodb.whitelabel.lat/api/v2/tables/db_sedes/records",
        "authentication": "headerAuth",
        "options": {}
      },
      "id": "3e0d8876-1335-4ae8-86bc-5db73fecf01e",
      "name": "Buscar Sede",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        672,
        1600
      ],
      "typeVersion": 4.3
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{$json.list.length}}",
              "operation": "larger",
              "value2": 0
            }
          ]
        },
        "options": {}
      },
      "id": "d7190886-321f-4d5b-a1eb-4dc3373206b3",
      "name": "¿Sede Existe?",
      "type": "n8n-nodes-base.if",
      "position": [
        928,
        1600
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "4745d23e-c06b-4bb2-b886-aa7dc57594a7",
      "name": "Error: Sede No Existe",
      "type": "n8n-nodes-base.set",
      "position": [
        1168,
        1440
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "url": "https://nocodb.whitelabel.lat/api/v2/tables/db_equipos/records",
        "authentication": "headerAuth",
        "options": {}
      },
      "id": "68605b01-8657-4ae5-a96d-b6c1c9285a81",
      "name": "Buscar Serial Duplicado",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        1168,
        1744
      ],
      "typeVersion": 4.3
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{$json.list.length}}",
              "operation": "larger",
              "value2": 0
            }
          ]
        },
        "options": {}
      },
      "id": "825f2704-560e-4286-82b9-fc21c67ec052",
      "name": "¿Serial Existe?",
      "type": "n8n-nodes-base.if",
      "position": [
        1424,
        1744
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "126060cc-16c3-4b37-b4a9-3236057e2894",
      "name": "Error: Serial Ya Existe",
      "type": "n8n-nodes-base.set",
      "position": [
        1680,
        1648
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "url": "https://nocodb.whitelabel.lat/api/v2/tables/db_equipos/records?limit=9999",
        "authentication": "headerAuth",
        "options": {}
      },
      "id": "4b33874d-2737-48b5-bbe4-5d8626605f93",
      "name": "Obtener Equipos (para ID)",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        1680,
        1840
      ],
      "typeVersion": 4.3
    },
    {
      "parameters": {
        "functionCode": "const registros = $json.list || [];\nlet max = 0;\nregistros.forEach(r => {\n  const id = r.equipo_id || \"\";\n  const num = parseInt(id.replace(\"eq\", \"\"));\n  if (!isNaN(num) && num > max) max = num;\n});\nconst nuevo = max + 1;\nreturn { equipo_id: `eq${String(nuevo).padStart(3, '0')}` };"
      },
      "id": "3d0948d1-adf8-4f45-a1b4-4d63ef150b59",
      "name": "Generar ID eq###",
      "type": "n8n-nodes-base.function",
      "position": [
        1920,
        1840
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://nocodb.whitelabel.lat/api/v2/tables/db_equipos/records",
        "authentication": "headerAuth",
        "options": {}
      },
      "id": "30a46a69-c598-4a97-81a7-3bd57fa1c241",
      "name": "Crear Equipo",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        2176,
        1840
      ],
      "typeVersion": 4.3
    },
    {
      "parameters": {
        "functionCode": "const fecha = new Date($items(0).json.ultimo_mantenimiento);\nconst tipo = ($items(0).json.periocidad_tipo || '').toLowerCase();\nlet dias = 0;\nswitch(tipo){\n  case 'anual': dias = 365; break;\n  case 'semestral': dias = 182; break;\n  case 'cuatrimestral': dias = 121; break;\n  case 'trimestral': dias = 91; break;\n  case 'bimestral': dias = 60; break;\n  case 'mensual': dias = 30; break;\n  case '45 dias': dias = 45; break;\n}\nconst prox = new Date(fecha.getTime() + dias*24*60*60*1000);\nreturn {\n  equipo_id: $json.equipo_id,\n  periodicidad_tipo: $items(0).json.periocidad_tipo,\n  ultimo_mantenimiento: $items(0).json.ultimo_mantenimiento,\n  proximos_mantenimientos: prox.toISOString().slice(0,10)\n};"
      },
      "id": "a9e52c17-a7d9-443f-bde5-54f2046f5ff0",
      "name": "Calcular Próximo Mantenimiento",
      "type": "n8n-nodes-base.function",
      "position": [
        2432,
        1840
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://nocodb.whitelabel.lat/api/v2/tables/programacion_proximos_mantenimientos/records",
        "authentication": "headerAuth",
        "options": {}
      },
      "id": "3ba11766-1091-4009-b5ab-6912b822ffce",
      "name": "Crear Cronograma",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        2672,
        1840
      ],
      "typeVersion": 4.3
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "24379332-a5f3-4ea2-98f0-eb57f775ca24",
      "name": "Responder al Agente",
      "type": "n8n-nodes-base.set",
      "position": [
        2928,
        1840
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "tipo_registro"
            },
            {
              "name": "payload",
              "type": "object"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        -480,
        592
      ],
      "id": "e029a959-f332-4a47-b701-af5f92b66e37",
      "name": "When Executed by Another Workflow"
    }
  ],
  "pinData": {},
  "repo_name": "flujos_n8n",
  "repo_owner": "whitelabel-ai",
  "repo_path": "Automation/",
  "settings": {
    "executionOrder": "v1"
  },
  "shared": [
    {
      "updatedAt": "2025-11-21T05:47:33.795Z",
      "createdAt": "2025-11-21T05:47:33.795Z",
      "role": "workflow:owner",
      "workflowId": "eaTazfBQJNo94wDe",
      "projectId": "73zSRVHGJwFSDWts"
    }
  ],
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2025-11-25T03:13:24.232Z",
  "versionId": "e0ff2897-f902-4d7f-bba3-ab7938fb6bc2"
}