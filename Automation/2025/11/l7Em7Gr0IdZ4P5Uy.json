{
  "active": false,
  "activeVersion": null,
  "activeVersionId": null,
  "connections": {
    "JS Para Post Linkedin": {
      "main": [
        [
          {
            "node": "Tabla Post Linkedin",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "JS Para Post Blog": {
      "main": [
        [
          {
            "node": "Tabla Post Blog",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tabla Post Linkedin": {
      "main": [
        []
      ]
    },
    "Péticion Post o Blog": {
      "main": [
        [
          {
            "node": "Generador de Idea",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generador de Idea": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cerebro": {
      "ai_languageModel": [
        [
          {
            "node": "Generador de Idea",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "JS Para Post Linkedin",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "JS Para Post Blog",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-11-18T15:04:41.900Z",
  "id": "l7Em7Gr0IdZ4P5Uy",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "Linkedin Post Generation",
  "nodes": [
    {
      "parameters": {
        "jsCode": "const bruto = $json[\"output\"];\n\n// Elimina todo lo que está antes del primer bloque de \"---\" o de la primera línea vacía tras el JSON\nlet soloTexto = bruto;\n\n// Si detecta bloque JSON dentro del texto:\n// Busca la primera ocurrencia de \"---\" y toma el texto de ahí en adelante\nconst delimitador = '---';\nconst idxDelim = soloTexto.indexOf(delimitador);\nif (idxDelim !== -1) {\n  soloTexto = soloTexto.substring(idxDelim + delimitador.length).trim();\n}\n\n// Si queda encabezado o líneas vacías, las elimina\nsoloTexto = soloTexto.replace(/^\\s+/, '');\n\n// Variables fijas\nconst idea = 'Idea para LinkedIn (automático)';\nconst contenido_LinkedIn = soloTexto;\nconst autor = 'andresco70@gmail.com';\nconst fecha = '21/11/2025';\nconst hora = '13:30';\nconst perfil = 'andresco70@gmail.com';\n\nreturn [{\n  idea,\n  contenido_LinkedIn,\n  autor,\n  fecha,\n  hora,\n  perfil\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2320,
        416
      ],
      "id": "49621e29-2959-4e6b-b83f-d767ca08d393",
      "name": "JS Para Post Linkedin"
    },
    {
      "parameters": {
        "jsCode": "const bruto = $json[\"output\"];\n\n// Limpieza básica igual que para el post\nlet soloTexto = bruto;\nconst delimitador = '__';\nconst idxDelim = soloTexto.indexOf(delimitador);\nif (idxDelim !== -1) {\n  soloTexto = soloTexto.substring(idxDelim + delimitador.length).trim();\n}\nsoloTexto = soloTexto.replace(/^\\s+/, '');\n\n// Genera título automático tomando la primera frase/línea del texto, si no tienes otro campo\nconst titulo = soloTexto.split('\\n')[0].trim() || \"Blog generado automáticamente\";\n\n// Si tu tabla NocoDB para blog tiene campo de tags o etiquetas, puedes generarlas:\nconst palabrasClave = soloTexto\n  .replace(/[.,;:\\n]/g, ' ')\n  .split(' ')\n  .filter(w => w.length > 5)        // Palabras con más de 5 letras\n  .slice(0,5);                      // Selecciona las primeras 5\nconst tags = palabrasClave.join(', ');\n\n// Resumen automático: recorta a 350 caracteres, terminando en la última palabra completa\nlet resumen = soloTexto.substring(0, 350);\nconst ultimoEspacio = resumen.lastIndexOf(' ');\nif (ultimoEspacio > 0) resumen = resumen.substring(0, ultimoEspacio) + '...';\n\n// Guarda el registro para NocoDB (ajusta los campos a tu tabla real)\nreturn {\n  Title: titulo,\n  'Blog Post': soloTexto,      // Texto completo\n  Fecha: '24-11-2025',         // O usa fecha dinámica si prefieres\n  Hora: '15:47',\n  Status: 'Published',         // O Pending si va por revisión\n  Tags: tags,\n  Summary: resumen\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2320,
        608
      ],
      "id": "da3ed30c-edd8-4faf-bdff-17283bffd895",
      "name": "JS Para Post Blog"
    },
    {
      "parameters": {
        "authentication": "nocoDbApiToken",
        "operation": "create",
        "projectId": "pbyzm06qhp068f6",
        "table": "mfpu4n1rjjsiyyk",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldName": "Idea",
              "fieldValue": "={{ $json.idea }}"
            },
            {
              "fieldName": "Contenido Linkedin",
              "fieldValue": "={{ $json.contenido_LinkedIn }}"
            },
            {
              "fieldName": "status",
              "fieldValue": "Pending"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.nocoDb",
      "typeVersion": 3,
      "position": [
        -2096,
        416
      ],
      "id": "babdd335-ee11-464b-b16d-1dd46bcf5963",
      "name": "Tabla Post Linkedin",
      "credentials": {
        "nocoDbApiToken": {
          "id": "od6Ytt9qSUlGVvJb",
          "name": "NocoDB Token account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "nocoDbApiToken",
        "operation": "create",
        "projectId": "pbyzm06qhp068f6",
        "table": "md53wc0y8c1g2c3"
      },
      "type": "n8n-nodes-base.nocoDb",
      "typeVersion": 3,
      "position": [
        -2096,
        608
      ],
      "id": "a92a3391-2434-4301-87c8-f497a127b078",
      "name": "Tabla Post Blog",
      "credentials": {
        "nocoDbApiToken": {
          "id": "od6Ytt9qSUlGVvJb",
          "name": "NocoDB Token account"
        }
      }
    },
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        -3344,
        512
      ],
      "id": "4fe12fa1-200d-425c-8457-6cccc40c1563",
      "name": "Péticion Post o Blog",
      "webhookId": "44afc123-087c-4246-9f90-7d4d894d8c0f",
      "credentials": {
        "telegramApi": {
          "id": "HlgJfleYDrocTlQZ",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Actúa como un creador de contenido profesional especializado en automatización, productividad y tecnología. Escribe directamente dos textos separados:\n\nPrimero, genera un post extenso para LinkedIn (mínimo 200 palabras, máximo 3000 caracteres), dirigido a ingenieros, empresarios y entusiastas digitales. Comienza con una pregunta o reto, incluye consejos concretos, conclusión inspiradora y hashtags relevantes al final. No incluyas encabezados, formato JSON, comillas ni instrucciones técnicas. Solo el texto del post.\n\nSegundo, genera una entrada de blog extensa (mínimo 300 palabras, sin límite de caracteres), también dirigida a ingenieros, empresarios y entusiastas digitales. Comienza con una pregunta provocadora o reto actual, aporta consejos prácticos y ejemplos reales, desarrolla el tema con profundidad y termina con una conclusión inspiradora y hashtags relevantes. No incluyas encabezados, formato JSON, comillas ni instrucciones técnicas; solo el texto completo y natural.\n\n“Genera una idea de contenido para publicar. Devuelve la respuesta en formato JSON con dos campos:\n\n'tipo' (puede ser 'linkedin' o 'blog') según cuál consideres más adecuado para el contenido generado.\n\n tine\n'contenido' con la idea desarrollada.\n\nEjemplo de respuesta:\n{'tipo': 'linkedin', 'contenido': '¿Cuántas horas dedicaste hoy a tus objetivos?'}\n\nO\n{'tipo': 'blog', 'contenido': 'Estrategias avanzadas para optimizar tu productividad diaria.'}”\n\n",
        "options": {
          "systemMessage": "=\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -3120,
        512
      ],
      "id": "bdcda101-5a1d-4d67-85d8-99409830c126",
      "name": "Generador de Idea"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -3120,
        736
      ],
      "id": "cc03fce0-2418-4352-b24c-7c3aeecc16b6",
      "name": "Cerebro",
      "credentials": {
        "googlePalmApi": {
          "id": "jQiccHfpS9BFKE4C",
          "name": "automation.whitelabel.lat"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.tipo }}",
                    "rightValue": "={{ $('Generador de Idea').item.json.output }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "d2059200-4f58-4776-8a29-b17d32a04e3f"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "4a478130-b726-43b7-a769-ac5b67c53aec",
                    "leftValue": "={{ $json.tipo }}",
                    "rightValue": "={{ $('Generador de Idea').item.json.output }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -2544,
        512
      ],
      "id": "ea65d74c-12b3-4517-b921-61a86f64b14d",
      "name": "Switch"
    },
    {
      "parameters": {
        "jsCode": "// Asume que el texto generado llega como $json.output\nconst raw = $json.output || $json.text || '';\n\n// Intentar extraer tipo y contenido si el texto contiene \"tipo:xxx | ...\"\nconst match = raw.match(/tipo:(\\w+)\\s*\\|\\s*(.+)/i);\n\nlet tipo, contenido;\n\nif (match) {\n  tipo = match[1].trim().toLowerCase(); // linkedin o blog\n  contenido = match[2].trim();\n} else {\n  // Si no encuentra tipo, pon por defecto linkedin (puedes decidir tú)\n  tipo = 'linkedin';\n  contenido = raw;\n}\n\n// Variables fijas\nconst idea = tipo === 'linkedin'\n  ? 'Idea para LinkedIn (automático)'\n  : 'Idea para Blog (automático)';\nconst autor = 'andresco70@gmail.com';\nconst fecha = '21/11/2025';\nconst hora = '13:30';\nconst perfil = 'andresco70@gmail.com';\n\n// Output para el Switch y tablas\nreturn [{\n  idea,\n  tipo,\n  contenido,\n  autor,\n  fecha,\n  hora,\n  perfil\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2768,
        512
      ],
      "id": "374ba7e4-f0b5-4a30-8316-fdeab9f69c04",
      "name": "Code in JavaScript"
    }
  ],
  "pinData": {},
  "repo_name": "flujos_n8n",
  "repo_owner": "whitelabel-ai",
  "repo_path": "Automation/",
  "settings": {
    "executionOrder": "v1"
  },
  "shared": [
    {
      "updatedAt": "2025-11-18T15:04:41.900Z",
      "createdAt": "2025-11-18T15:04:41.900Z",
      "role": "workflow:owner",
      "workflowId": "l7Em7Gr0IdZ4P5Uy",
      "projectId": "s48f8ZkY9UxLCxeQ"
    }
  ],
  "staticData": null,
  "tags": [],
  "triggerCount": 1,
  "updatedAt": "2025-11-25T17:17:31.203Z",
  "versionId": "215490c0-76e5-4059-8848-828ff5d5cf06"
}