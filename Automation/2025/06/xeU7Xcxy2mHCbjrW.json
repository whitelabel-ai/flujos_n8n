{
  "active": false,
  "connections": {
    "Gmail Trigger": {
      "main": [
        [
          {
            "node": "Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Data": {
      "main": [
        [
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Code1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent1": {
      "main": [
        [
          {
            "node": "Clean Json",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Clean Json": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Search Client",
            "type": "main",
            "index": 0
          }
        ],
        [],
        [
          {
            "node": "No Operation, do nothing1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search Client": {
      "main": [
        [
          {
            "node": "If Client",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search Projet": {
      "main": [
        [
          {
            "node": "If Projet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Client": {
      "main": [
        [
          {
            "node": "Search Projet",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Create Client",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Projet": {
      "main": [
        [
          {
            "node": "projetUrl",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Create Projet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Client": {
      "main": [
        [
          {
            "node": "If Client",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Projet": {
      "main": [
        [
          {
            "node": "create Requirements",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Data Projets": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        []
      ]
    },
    "create ask": {
      "main": [
        [
          {
            "node": "Data Projets",
            "type": "main",
            "index": 0
          },
          {
            "node": "Create a database page",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code1": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Mark a message as read",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "create Requirements": {
      "main": [
        [
          {
            "node": "projetUrl1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Notion Trigger": {
      "main": [
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [],
        [
          {
            "node": "Get many child blocks",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get many child blocks": {
      "main": [
        [
          {
            "node": "Code2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code2": {
      "main": [
        [
          {
            "node": "Reply to a message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "projetUrl": {
      "main": [
        [
          {
            "node": "create ask",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "projetUrl1": {
      "main": [
        [
          {
            "node": "create ask",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code3": {
      "main": [
        [
          {
            "node": "Code4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-06-24T15:18:35.192Z",
  "id": "xeU7Xcxy2mHCbjrW",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "Cotizador Projets",
  "nodes": [
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyHour"
            }
          ]
        },
        "simple": false,
        "filters": {
          "q": "to:(proyectos@whitelabel.lat)",
          "readStatus": "unread"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.gmailTrigger",
      "typeVersion": 1.2,
      "position": [
        -300,
        -110
      ],
      "id": "ad94b2eb-3864-4e1f-8cad-2ea9ebdddf01",
      "name": "Gmail Trigger",
      "credentials": {
        "gmailOAuth2": {
          "id": "No30HHponDPtNWfb",
          "name": "hola@whitelabel.lat"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "4d3ca1fe-99b0-44c6-988e-9337de9866f1",
              "name": "threadId",
              "value": "={{ $json.threadId }}",
              "type": "string"
            },
            {
              "id": "cdd17f63-27b2-4320-83c1-36a3972edb65",
              "name": "remitente",
              "value": "={{ $json.from.value[0].name }}",
              "type": "string"
            },
            {
              "id": "734f7938-1d6e-4a60-9cef-cc6dc492b9b2",
              "name": "email",
              "value": "={{ $json.from.value[0].address }}",
              "type": "string"
            },
            {
              "id": "690ccbb1-9ad2-4e99-87b9-04104f3a09a5",
              "name": "asunto",
              "value": "={{ $json.subject }}",
              "type": "string"
            },
            {
              "id": "0d16be62-ac5d-479f-832d-6a43adeeb2a0",
              "name": "mensaje",
              "value": "={{ $json.text }}",
              "type": "string"
            },
            {
              "id": "128a062c-e372-4126-82a9-ea2a2850c7b4",
              "name": "date",
              "value": "={{ $json.date }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        140,
        -260
      ],
      "id": "12075fdb-d216-418c-a42b-ca930efefbc1",
      "name": "Data"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Nuevo requerimiento recibido:\n\nFrom: {{ $json.remitente }}\nSubject: {{ $json.asunto }}\n\nTexto del requerimiento:\n{{ $json.mensaje }}\nResumen del requerimiento:\n{{ $json.resumen }}\n\nPor favor, genera las preguntas necesarias clasificadas por categor√≠a y relevancia.",
        "options": {
          "systemMessage": "=Act√∫as como un analista senior de producto digital con experiencia en discovery t√©cnico, definici√≥n de requerimientos y cotizaci√≥n de soluciones tecnol√≥gicas a medida.\n\nTu tarea es analizar requerimientos enviados por clientes y generar un conjunto de preguntas clave que eliminen ambig√ºedades (gaps), supuestos err√≥neos (sesgos) y permitan comprender con claridad el alcance funcional y t√©cnico del proyecto.\n\nEstas preguntas tienen como prop√≥sito ayudar al equipo a:\n- Aclarar el objetivo real del requerimiento.\n- Identificar riesgos ocultos o dependencias no mencionadas.\n- Estimar tiempo y costos de forma precisa.\n- Construir una soluci√≥n viable, escalable y cotizable.\n\n### Reglas:\n1. Clasifica las preguntas en las siguientes categor√≠as:\n   - `Funcional`: l√≥gica del negocio, comportamiento esperado, flujos.\n   - `T√©cnica`: arquitectura, almacenamiento, infraestructura, APIs.\n   - `Volumen de datos`: frecuencia, escalabilidad, cantidad de usuarios o registros.\n   - `Canales`: medios de interacci√≥n, caracter√≠sticas por canal.\n   - `Integraciones`: sistemas externos, CRMs, bases de datos, servicios terceros.\n   - `Soporte`: mantenimiento, monitoreo, continuidad operativa.\n   - `Otros`: cualquier aspecto no cubierto por las anteriores.\n   \n2. Para cada pregunta, asigna un campo `relevancia`, con uno de estos valores:\n   - `alta`: imprescindible para cotizar correctamente.\n   - `media`: √∫til, pero no cr√≠tica.\n   - `baja`: complementaria o exploratoria.\n\n3. S√© espec√≠fico, claro y breve en las preguntas. Evita ambig√ºedades.\n\n4. No repitas ni expliques. Tu salida debe ser directamente un JSON estructurado as√≠:\n\n```json\n[\n  {\n    \"categoria\": \"Funcional\",\n    \"pregunta\": \"¬øCu√°l es el comportamiento esperado del agente si el cliente no responde en 24 horas?\",\n    \"relevancia\": \"alta\"\n  },\n  {\n    \"categoria\": \"Canales\",\n    \"pregunta\": \"¬øLos mensajes de WhatsApp ser√°n automatizados o escritos por un operador humano?\",\n    \"relevancia\": \"alta\"\n  },\n  ...\n]\n````\n\nNo incluyas encabezados, contexto, ni explicaciones. Solo entrega el JSON con las preguntas, listo para ser usado en una herramienta de documentaci√≥n como Notion."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        3156,
        -560
      ],
      "id": "aa962bfa-1cdf-48d4-9dfd-5e7b286f3e7b",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-flash-preview-04-17-thinking",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        448,
        -40
      ],
      "id": "024700fa-1c62-49ff-83dc-925c62eb5de0",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "jQiccHfpS9BFKE4C",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Obtener el texto plano del agente\nconst raw = items[0].json.output;\n\n// Intentar extraer el JSON entre los delimitadores ```json y ```\nconst match = raw.match(/```json\\s*([\\s\\S]*?)\\s*```/);\n\n// Si no encuentra un bloque v√°lido, intentar parsear como JSON directo\nconst cleanJsonString = match ? match[1] : raw;\n\n// Intentar parsear el contenido\nlet parsed;\ntry {\n  parsed = JSON.parse(cleanJsonString);\n} catch (error) {\n  throw new Error(\"No se pudo parsear el JSON: \" + error.message);\n}\n\n// Verificamos que sea un array\nif (!Array.isArray(parsed)) {\n  throw new Error(\"El JSON parseado no es un array.\");\n}\n\n// Devolvemos cada objeto como item independiente\nreturn parsed.map(obj => ({ json: obj }));\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -300,
        -920
      ],
      "id": "cb9eeb66-fc68-4eeb-b260-f7b8c53e99af",
      "name": "Code"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=\n Analiza el siguiente correo y responde en **formato JSON v√°lido** con los siguientes campos:\n\n * `tipo`: uno de `\"nuevo_requerimiento\"`, `\"respuesta\"`, `\"no_relevante\"`\n * `cliente`: nombre del remitente si se puede identificar\n * `proyecto`: nombre del proyecto si se puede inferir a partir del asunto o contenido\n * `necesita_aclaracion`: `true` si el mensaje es ambiguo o no tiene suficiente contexto para continuar, `false` en caso contrario\n * `mensaje`: el contenido completo recibido, **limpio y legible**, con estructura clara, sin errores de formato, sin saltos innecesarios, listo para pegar en Notion o un documento profesional. Puedes usar formato tipo Markdown simple si mejora la claridad (por ejemplo, listas, subt√≠tulos, negrilla).\n * `resumen`: un resumen claro del mensaje en **m√°ximo 20 palabras**\n\n Limpia el mensaje recibido: elimina saltos de l√≠nea innecesarios, corrige errores de espaciado, codificaci√≥n o signos mal escritos. Mant√©n la informaci√≥n clara, con buena estructura visual.\n\n No hagas suposiciones si la informaci√≥n no est√° clara.\n\n ---\n\n **Correo recibido:**\n Remitente: {{ $json[\"remitente\"] }}\n Email: {{ $json[\"email\"] }}\n Asunto: {{ $json[\"asunto\"] }}\n Mensaje: {{ $json[\"mensaje\"] }}",
        "options": {
          "systemMessage": "=Eres un analista experto en pre-venta. Vas a clasificar correos recibidos para identificar si contienen un requerimiento de proyecto, una respuesta a un requerimiento anterior, o si no son relevantes para cotizaci√≥n. \nTu salida debe ser un JSON v√°lido. \nNo hagas suposiciones si no tienes suficiente informaci√≥n."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        360,
        -260
      ],
      "id": "a8fa0d4c-8425-456e-a8b8-17e456a96791",
      "name": "AI Agent1"
    },
    {
      "parameters": {
        "jsCode": "// Suponiendo que est√°s trabajando con una entrada tipo JSON del nodo anterior:\nconst raw = items[0].json.output;\n\n// Extraemos el bloque que est√° entre las etiquetas ```json y ```\nconst match = raw.match(/```json\\s*([\\s\\S]*?)\\s*```/);\n\nif (!match) {\n  throw new Error(\"No se encontr√≥ un bloque JSON v√°lido.\");\n}\n\nconst cleanJsonString = match[1];\nconst parsed = JSON.parse(cleanJsonString);\n\n// Devolver como nuevo item\nreturn [{ json: parsed }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        736,
        -260
      ],
      "id": "764499bf-1ef3-4f78-9e51-f68ecae7f99d",
      "name": "Clean Json"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.tipo }}",
                    "rightValue": "nuevo_requerimiento",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    },
                    "id": "576af6df-1ab4-4dbb-a5b3-364e5a029e41"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "nuevo requerimiento"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "c57ccc1f-ec6d-44b6-b192-f844674e5390",
                    "leftValue": "={{ $json.tipo }}",
                    "rightValue": "respuesta",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "respuesta"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "0bc6e44a-e62e-499b-ade2-33ffda489c00",
                    "leftValue": "={{ $json.tipo }}",
                    "rightValue": "no_relevante",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "no relevante"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        956,
        -260
      ],
      "id": "cbe321ec-147e-4d3f-9e6e-20aeea6a2db2",
      "name": "Switch"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        1176,
        -210
      ],
      "id": "2ba57301-da90-48cb-853c-4c623e5f149a",
      "name": "No Operation, do nothing1"
    },
    {
      "parameters": {
        "operation": "search",
        "text": "={{ $json.cliente }}",
        "returnAll": true,
        "simple": false,
        "options": {}
      },
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2.2,
      "position": [
        1176,
        -410
      ],
      "id": "5b554d39-8b02-4814-8432-57fb444285ee",
      "name": "Search Client",
      "alwaysOutputData": true,
      "credentials": {
        "notionApi": {
          "id": "jWWM1rTAyxYomO7Y",
          "name": "hola@whitelabel.lat"
        }
      }
    },
    {
      "parameters": {
        "pageId": {
          "__rl": true,
          "value": "https://www.notion.so/Clientes-Proyectos-21c3741c09ed80d889b0e52241fab462",
          "mode": "url"
        },
        "title": "={{ $('Switch').item.json.cliente }}",
        "simple": false,
        "options": {}
      },
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2.2,
      "position": [
        1616,
        -260
      ],
      "id": "15960830-dff4-4ccb-9e76-afd01c8609af",
      "name": "Create Client",
      "alwaysOutputData": true,
      "credentials": {
        "notionApi": {
          "id": "jWWM1rTAyxYomO7Y",
          "name": "hola@whitelabel.lat"
        }
      }
    },
    {
      "parameters": {
        "operation": "search",
        "text": "={{ $('Switch').item.json.proyecto }}",
        "limit": 1,
        "simple": false,
        "options": {
          "filter": {
            "filters": {
              "value": "page"
            }
          }
        }
      },
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2.2,
      "position": [
        1616,
        -460
      ],
      "id": "c860b0db-1a7e-4966-a53e-75fc2a7d5c15",
      "name": "Search Projet",
      "alwaysOutputData": true,
      "credentials": {
        "notionApi": {
          "id": "jWWM1rTAyxYomO7Y",
          "name": "hola@whitelabel.lat"
        }
      }
    },
    {
      "parameters": {
        "pageId": {
          "__rl": true,
          "value": "={{ $('If Client').item.json.url }}",
          "mode": "url"
        },
        "title": "={{ $('Switch').item.json.proyecto }}",
        "simple": false,
        "options": {}
      },
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2.2,
      "position": [
        2040,
        -340
      ],
      "id": "f3da975e-1227-4ecf-ba21-df92b2b887dc",
      "name": "Create Projet",
      "alwaysOutputData": true,
      "credentials": {
        "notionApi": {
          "id": "jWWM1rTAyxYomO7Y",
          "name": "hola@whitelabel.lat"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "cda0a524-7fdd-4501-aa8a-68376d87684c",
              "leftValue": "={{ $json.properties.title.title[0].text.content }}",
              "rightValue": "={{ $('Switch').item.json.cliente }}",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1396,
        -410
      ],
      "id": "aca443c7-3d20-409c-bb65-66381097677e",
      "name": "If Client"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "cda0a524-7fdd-4501-aa8a-68376d87684c",
              "leftValue": "={{ $json.properties.title.title[0].text.content }}",
              "rightValue": "={{ $('Switch').item.json.proyecto }}",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1836,
        -460
      ],
      "id": "371286aa-4339-4c0b-b77a-67d3918c443d",
      "name": "If Projet"
    },
    {
      "parameters": {
        "pageId": {
          "__rl": true,
          "value": "={{ $('Create Projet').item.json.url }}",
          "mode": "url"
        },
        "title": "=üì© Requerimientos",
        "simple": false,
        "blockUi": {
          "blockValues": [
            {
              "type": "heading_2",
              "textContent": "={{ $('Switch').item.json.proyecto }}"
            },
            {
              "textContent": "={{ $('Clean Json').item.json.mensaje.slice(0, 1800) }}"
            },
            {
              "textContent": "={{ $('Clean Json').item.json.mensaje.length > 1800 ? $('Clean Json').item.json.mensaje.slice(1800, 3600) : '' }}"
            },
            {
              "textContent": "={{ $('Clean Json').item.json.mensaje.length > 3600 ? $('Clean Json').item.json.mensaje.slice(3600, 5400) : '' }}"
            },
            {
              "textContent": "={{ $('Clean Json').item.json.mensaje.length > 5400 ? $('Clean Json').item.json.mensaje.slice(5400, 7200) : '' }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2.2,
      "position": [
        2220,
        -340
      ],
      "id": "7b90daf0-1dc3-44a5-8623-ac9913d82c16",
      "name": "create Requirements",
      "alwaysOutputData": true,
      "credentials": {
        "notionApi": {
          "id": "jWWM1rTAyxYomO7Y",
          "name": "hola@whitelabel.lat"
        }
      }
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-flash-preview-04-17-thinking",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        3244,
        -340
      ],
      "id": "a001975e-b7e4-47d1-ac2b-5c1d48daeccf",
      "name": "Google Gemini Chat Model1",
      "credentials": {
        "googlePalmApi": {
          "id": "jQiccHfpS9BFKE4C",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "5288a14e-f54e-46a3-bd7a-5a79e4731681",
              "name": "page_id",
              "value": "={{ $json.id }}",
              "type": "string"
            },
            {
              "id": "095ab03c-23e7-488c-88ee-1e34515fdab8",
              "name": "cliente",
              "value": "={{ $('Clean Json').item.json.cliente }}",
              "type": "string"
            },
            {
              "id": "2ff4b779-987d-4112-8324-92aa45bc1065",
              "name": "proyecto",
              "value": "={{ $('Clean Json').item.json.proyecto }}",
              "type": "string"
            },
            {
              "id": "3653fc58-70b8-41c8-8d8b-2e333dd0fd9e",
              "name": "remitente",
              "value": "={{ $('Data').item.json.remitente }}",
              "type": "string"
            },
            {
              "id": "d1b76be4-97a7-467c-b367-519c9ae511a5",
              "name": "email",
              "value": "={{ $('Data').item.json.email }}",
              "type": "string"
            },
            {
              "id": "0342f252-874a-4cf1-a18c-2dc333a0b130",
              "name": "asunto",
              "value": "={{ $('Data').item.json.asunto }}",
              "type": "string"
            },
            {
              "id": "136ac074-8b70-4e2d-9155-e6fd5c042464",
              "name": "mensaje",
              "value": "={{ $('Clean Json').item.json.mensaje }}",
              "type": "string"
            },
            {
              "id": "3c58e5b2-c23f-4765-99e5-3e81529f5112",
              "name": "resumen",
              "value": "={{ $('Clean Json').item.json.resumen }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2940,
        -560
      ],
      "id": "c76e215f-bd46-4955-8528-bcc668cd32bb",
      "name": "Data Projets"
    },
    {
      "parameters": {
        "pageId": {
          "__rl": true,
          "value": "={{ $json.url}}",
          "mode": "url"
        },
        "title": "=üìÑ Preguntas aclaratorias",
        "simple": false,
        "blockUi": {
          "blockValues": [
            {
              "richText": true,
              "text": {
                "text": [
                  {
                    "text": "Estado: ",
                    "annotationUi": {
                      "bold": true,
                      "italic": true,
                      "color": "green"
                    }
                  },
                  {
                    "text": "Por revisar",
                    "annotationUi": {
                      "color": "default"
                    }
                  }
                ]
              }
            },
            {
              "richText": true,
              "text": {
                "text": [
                  {
                    "text": "üßë‚Äçüíº Por favor, revisa las preguntas, edita o responde si es necesario, y cambia el texto arriba a 'Estado: Revisado o Contestado' cuando termines.",
                    "annotationUi": {
                      "color": "gray"
                    }
                  }
                ]
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2.2,
      "position": [
        2660,
        -500
      ],
      "id": "6f091273-9fdc-487f-b492-d9fcc2483fe2",
      "name": "create ask",
      "alwaysOutputData": true,
      "executeOnce": true,
      "credentials": {
        "notionApi": {
          "id": "jWWM1rTAyxYomO7Y",
          "name": "hola@whitelabel.lat"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Obtener el texto plano del agente\nconst raw = items[0].json.output;\n\n// Extraer el JSON entre los delimitadores ```json y ```\nconst match = raw.match(/```json\\s*([\\s\\S]*?)\\s*```/);\nconst cleanJsonString = match ? match[1] : raw;\n\n// Parsear el contenido\nlet parsedQuestions;\ntry {\n  parsedQuestions = JSON.parse(cleanJsonString);\n} catch (error) {\n  throw new Error(\"No se pudo parsear el JSON: \" + error.message);\n}\n\n// Verificar que sea un array\nif (!Array.isArray(parsedQuestions)) {\n  throw new Error(\"El JSON parseado no es un array.\");\n}\n\n// Organizar por relevancia y luego por categor√≠a\nconst organizedData = {\n  alta: {},\n  media: {},\n  baja: {}\n};\n  \n// Agrupar preguntas\nparsedQuestions.forEach(question => {\n  const relevancia = question.relevancia.toLowerCase();\n  const categoria = question.categoria;\n  \n  if (!organizedData[relevancia][categoria]) {\n    organizedData[relevancia][categoria] = [];\n  }\n  \n  organizedData[relevancia][categoria].push(question.pregunta);\n});\n\n// Crear la estructura para Notion\nconst notionPayload = {\n  children: [] // Aqu√≠ ir√°n todos los bloques\n};\n\n\n// Funci√≥n para a√±adir un heading\nconst addHeading = (text, level = 2) => {\n  notionPayload.children.push({\n    object: \"block\",\n    type: `heading_${level}`,\n    [`heading_${level}`]: {\n      rich_text: [{\n        type: \"text\",\n        text: { content: text },\n        annotations: { bold: true }\n      }],\n      color: \"default\"\n    }\n  });\n};\n\n// Funci√≥n para a√±adir un toggle\nconst addToggle = (title, items) => {\n  notionPayload.children.push({\n    object: \"block\",\n    type: \"toggle\",\n    toggle: {\n      rich_text: [{\n        type: \"text\",\n        text: { content: title },\n        annotations: { bold: true }\n      }],\n      children: items.map(item => ({\n        object: \"block\",\n        type: \"paragraph\",\n        paragraph: {\n          rich_text: [{\n            type: \"text\",\n            text: { content: item }\n          }],\n          color: \"default\"\n        }\n      }))\n    }\n  });\n};\n\nconst proyecto = $('Data Projets').first().json.proyecto;\n// A√±adir t√≠tulo principal\naddHeading(`üìã Preguntas del ${proyecto}`, 1);  \n\n// A√±adir secci√≥n de Alta Relevancia\nif (Object.keys(organizedData.alta).length > 0) {\n  addHeading(\"üî¥ Alta Relevancia\", 2);\n  \n  for (const [categoria, preguntas] of Object.entries(organizedData.alta)) {\n    addToggle(`üìå ${categoria} (${preguntas.length} preguntas)`, preguntas);\n  }\n}\n\n// A√±adir secci√≥n de Media Relevancia\nif (Object.keys(organizedData.media).length > 0) {\n  addHeading(\"üü° Media Relevancia\", 2);\n  \n  for (const [categoria, preguntas] of Object.entries(organizedData.media)) {\n    addToggle(`üìù ${categoria} (${preguntas.length} preguntas)`, preguntas);\n  }\n}\n\n// A√±adir secci√≥n de Baja Relevancia\nif (Object.keys(organizedData.baja).length > 0) {\n  addHeading(\"üîµ Baja Relevancia\", 2);\n  \n  for (const [categoria, preguntas] of Object.entries(organizedData.baja)) {\n    addToggle(`‚ÑπÔ∏è ${categoria} (${preguntas.length} preguntas)`, preguntas);\n  }\n}\n\nreturn [{\n  json: notionPayload\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3532,
        -560
      ],
      "id": "c1920478-c0c4-40e2-9450-cdedaafa87f7",
      "name": "Code1"
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://api.notion.com/v1/blocks/{{ $('Data Projets').item.json.page_id }}/children",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "notionApi",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"children\": {{JSON.stringify($json.children)}}\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3760,
        -560
      ],
      "id": "dbddc886-1952-490d-8bc5-00e6841e9034",
      "name": "HTTP Request",
      "credentials": {
        "notionApi": {
          "id": "jWWM1rTAyxYomO7Y",
          "name": "hola@whitelabel.lat"
        }
      }
    },
    {
      "parameters": {
        "operation": "markAsRead",
        "messageId": "={{ $('Gmail Trigger').item.json.threadId }}"
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        4000,
        -560
      ],
      "id": "ae91a6fd-f7a7-4151-8819-8a4c299aba26",
      "name": "Mark a message as read",
      "webhookId": "9bef87db-c738-468f-b5fb-5cfce6263f37",
      "credentials": {
        "gmailOAuth2": {
          "id": "No30HHponDPtNWfb",
          "name": "hola@whitelabel.lat"
        }
      }
    },
    {
      "parameters": {
        "resource": "databasePage",
        "databaseId": {
          "__rl": true,
          "value": "21c3741c-09ed-809d-b8e4-c2b8a54316a5",
          "mode": "list",
          "cachedResultName": "Clientes - Proyectos",
          "cachedResultUrl": "https://www.notion.so/21c3741c09ed809db8e4c2b8a54316a5"
        },
        "title": "={{ $('Clean Json').item.json.cliente }}",
        "propertiesUi": {
          "propertyValues": [
            {
              "key": "Cliente|title",
              "title": "={{ $('Clean Json').item.json.cliente }}"
            },
            {
              "key": "Empresa|rich_text",
              "textContent": "={{ $('Data').item.json.email.split('@')[1].split('.')[0].replace('gmail', 'Personal') }}"
            },
            {
              "key": "Correo|email",
              "emailValue": "={{ $('Data').item.json.email }}"
            },
            {
              "key": "Notas|rich_text",
              "textContent": "={{ $('Clean Json').item.json.resumen }}"
            },
            {
              "key": "√öltimo contacto|date",
              "date": "={{ $('Gmail Trigger').item.json.date }}"
            },
            {
              "key": "Estado actual|select",
              "selectValue": "Preguntas Generadas"
            },
            {
              "key": "Proyecto|rich_text",
              "textContent": "={{ $('Search Projet').item.json.properties.title.title[0].text.content || $('Create Projet').item.json.properties.title.title[0].text.content  }}"
            },
            {
              "key": "Preguntas aclaratorias|url",
              "ignoreIfEmpty": true,
              "urlValue": "={{ $json.url }}"
            },
            {
              "key": "threadId|rich_text",
              "textContent": "={{ $('Data').item.json.threadId }}"
            }
          ]
        },
        "options": {
          "iconType": "emoji",
          "icon": "üíº"
        }
      },
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2.2,
      "position": [
        2940,
        -320
      ],
      "id": "88eedb06-ba74-44b0-8ed9-97b67ebc7a8f",
      "name": "Create a database page",
      "credentials": {
        "notionApi": {
          "id": "jWWM1rTAyxYomO7Y",
          "name": "hola@whitelabel.lat"
        }
      }
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "event": "pagedUpdatedInDatabase",
        "databaseId": {
          "__rl": true,
          "value": "21c3741c-09ed-809d-b8e4-c2b8a54316a5",
          "mode": "list",
          "cachedResultName": "Clientes - Proyectos",
          "cachedResultUrl": "https://www.notion.so/21c3741c09ed809db8e4c2b8a54316a5"
        }
      },
      "type": "n8n-nodes-base.notionTrigger",
      "typeVersion": 1,
      "position": [
        -400,
        320
      ],
      "id": "965321e4-dccb-41bc-9f6c-cb25bd639c80",
      "name": "Notion Trigger",
      "credentials": {
        "notionApi": {
          "id": "jWWM1rTAyxYomO7Y",
          "name": "hola@whitelabel.lat"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json[\"Estado actual\"] }}",
                    "rightValue": "Preguntas Generadas",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "1a0086b1-dd61-4fe3-a0c8-783dbe7f259a"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "268d0644-c01f-4a45-9724-5d7cdb8af21b",
                    "leftValue": "={{ $json[\"Estado actual\"] }}",
                    "rightValue": "Preguntas Confirmadas",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -180,
        320
      ],
      "id": "d8c40eda-829c-47d3-9181-30b1f22f16e2",
      "name": "Switch1"
    },
    {
      "parameters": {
        "resource": "block",
        "operation": "getAll",
        "blockId": {
          "__rl": true,
          "value": "={{ $json[\"Preguntas aclaratorias\"] }}",
          "mode": "url"
        },
        "returnAll": true,
        "fetchNestedBlocks": true
      },
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2.2,
      "position": [
        40,
        420
      ],
      "id": "48d2a2af-48e1-4c77-a8cb-4623dd55557c",
      "name": "Get many child blocks",
      "credentials": {
        "notionApi": {
          "id": "jWWM1rTAyxYomO7Y",
          "name": "hola@whitelabel.lat"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Get data from previous Notion Trigger node\nconst notionData = $('Notion Trigger').first().json;\n\nif (!notionData) {\n  throw new Error('No data received from Notion Trigger node');\n}\n\nconst projectName = notionData.Proyecto || 'Proyecto sin nombre';\nconst companyName = notionData.Empresa || 'Empresa no especificada';\nconst clientEmail = notionData.Correo || '';\nconst clientName = notionData.Cliente || 'Cliente';\nconst questionsLink = notionData['Preguntas aclaratorias'] || '';\nconst currentStatus = notionData['Estado actual'] || 'Estado no especificado';\nconst logoUrl = notionData['Logo'] || '';\n\n// Bloques de preguntas\nconst blocks = $input.all()?.flatMap(item => item.json) || [];\n\nlet emailContent = '';\nlet sectionTitle = '';\nlet inToggle = false;\nlet toggleId = '';\nlet questionNumber = 1;\n\nif (blocks && blocks.length > 0) {\n  for (const block of blocks) {\n    if (!block.content) continue;\n\n    if (block.type === 'heading_1') {\n      emailContent += `<h2 style=\"color: #2c3e50; margin-top: 30px;\">${block.content}</h2>`;\n    } else if (block.type === 'heading_2') {\n      sectionTitle = block.content;\n      questionNumber = 1;\n      emailContent += `\n        <div style=\"margin-top: 25px;\">\n          <h3 style=\"color: #1f3b57; border-bottom: 1px solid #ccc; padding-bottom: 5px;\">üìå ${sectionTitle}</h3>\n        </div>\n      `;\n    } else if (block.type === 'toggle') {\n      inToggle = true;\n      toggleId = block.id;\n    } else if (inToggle && block.parent?.type === 'block_id') {\n      emailContent += `\n        <div style=\"margin: 20px 0; padding: 16px 20px; background: #f0f8ff; border-left: 4px solid #3498db; border-radius: 8px;\">\n          <p style=\"margin: 0 0 8px; font-weight: 500; color: #1f3b57;\">\n            ${questionNumber}. ${block.content}\n          </p>\n          <div style=\"border: 1px dashed #3498db; background: #ffffff; padding: 12px; border-radius: 6px; margin-top: 10px;\">\n            <p style=\"color: #888; margin: 0;\">\n              ‚úçÔ∏è <i>Responde debajo de esta l√≠nea:</i>\n            </p>\n            <p style=\"color: #3498db;\"><br><br><br></p>\n          </div>\n        </div>\n      `;\n      questionNumber++;\n    } else if (inToggle && (!block.parent || block.parent?.type !== 'block_id')) {\n      inToggle = false;\n      toggleId = '';\n    }\n  }\n\n  if (inToggle) {\n    inToggle = false;\n    toggleId = '';\n  }\n} else {\n  emailContent += `<p style=\"color: #e74c3c;\">No se encontraron preguntas en la p√°gina de Notion.</p>`;\n}\n\n\n// HTML final\nconst htmlEmail = `\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <title>${projectName} - ${companyName}</title>\n  <style>\n    body {\n      font-family: 'Segoe UI', sans-serif;\n      background: #f4f6f8;\n      padding: 0;\n      margin: 0;\n    }\n    .container {\n      max-width: 800px;\n      margin: auto;\n      background: #ffffff;\n      padding: 30px;\n      border-radius: 12px;\n      box-shadow: 0 5px 20px rgba(0,0,0,0.08);\n    }\n    .header {\n      text-align: center;\n      margin-bottom: 20px;\n    }\n    .header img {\n      max-height: 60px;\n      margin-bottom: 10px;\n    }\n    .header h1 {\n      margin: 0;\n      font-size: 24px;\n      color: #1f3b57;\n    }\n    .instructions {\n      background: #eaf4ff;\n      border-left: 4px solid #3498db;\n      padding: 15px;\n      border-radius: 8px;\n      color: #2c3e50;\n      margin-top: 10px;\n      margin-bottom: 30px;\n    }\n    .instructions p {\n      margin: 8px 0 0 0;\n      font-size: 14px;\n    }\n    .meta {\n      background-color: #f1f3f5;\n      padding: 15px;\n      border-radius: 8px;\n      font-size: 14px;\n      margin-bottom: 25px;\n    }\n    .meta div {\n      margin-bottom: 6px;\n    }\n    .meta span {\n      font-weight: bold;\n      color: #2c3e50;\n    }\n    .footer {\n      text-align: center;\n      font-size: 12px;\n      color: #7f8c8d;\n      margin-top: 30px;\n    }\n    a {\n      color: #3498db;\n      text-decoration: none;\n    }\n    .cta-button {\n      margin-top: 40px;\n      text-align: center;\n    }\n    .cta-button a {\n      background-color: #3498db;\n      color: white;\n      padding: 12px 24px;\n      border-radius: 6px;\n      text-decoration: none;\n      font-weight: 500;\n      display: inline-block;\n    }\n  </style>\n</head>\n<body>\n  <div class=\"container\">\n    <div class=\"header\">\n      ${logoUrl ? `<img src=\"${logoUrl}\" alt=\"Logo de ${companyName}\"/>` : ''}\n      <h1>${projectName}</h1>\n    </div>\n\n    <div class=\"instructions\">\n      <strong>üì© ¬øC√≥mo responder?</strong>\n      <p>\n        Haz clic en <strong>‚ÄúResponder‚Äù</strong> a este correo y escribe tus respuestas justo debajo de cada pregunta.<br>\n        No es necesario adjuntar ning√∫n archivo. ¬°Gracias por tu colaboraci√≥n! üôå\n      </p>\n    </div>\n\n    <div class=\"meta\">\n      <div><span>Cliente:</span> ${clientName}</div>\n      <div><span>Empresa:</span> ${companyName}</div>\n      <div><span>Estado actual:</span> ${currentStatus}</div>\n      ${questionsLink ? `<div><span>Ver en Notion:</span> <a href=\"${questionsLink}\" target=\"_blank\">Enlace</a></div>` : ''}\n    </div>\n\n    ${emailContent}\n\n    ${questionsLink ? `\n      <div class=\"cta-button\">\n        <p style=\"color: #7f8c8d;\">¬øPrefieres responder desde un formulario?</p>\n        <a href=\"${questionsLink}\" target=\"_blank\">Completar formulario en l√≠nea</a>\n      </div>\n    ` : ''}\n\n    <div class=\"footer\">\n      <p>Este mensaje fue generado autom√°ticamente el ${new Date().toLocaleString()}.</p>\n    </div>\n  </div>\n</body>\n</html>\n`;\n\nreturn [{\n  json: {\n    messageID: $('Notion Trigger').first().json.threadId,\n    subject: `${projectName} - Preguntas para completar`,\n    html: htmlEmail,\n    text: `Resumen de preguntas para ${projectName}. Por favor responde desde el modo HTML.`,\n    to: clientEmail,\n    cc: \"\",\n    bcc: \"\"\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        260,
        420
      ],
      "id": "79ae6655-3609-4a41-8327-e16b3cf36256",
      "name": "Code2"
    },
    {
      "parameters": {
        "operation": "reply",
        "messageId": "={{ $json.messageID }}",
        "message": "={{ $json.html }}",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        500,
        440
      ],
      "id": "dd77a6dc-64f6-442f-9c5d-309ef4aeab6e",
      "name": "Reply to a message",
      "webhookId": "37a3ea6f-4281-45c1-971b-df2066736730",
      "credentials": {
        "gmailOAuth2": {
          "id": "No30HHponDPtNWfb",
          "name": "hola@whitelabel.lat"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "7c023734-4a21-48ca-bf08-f54c3e9d74af",
              "name": "url",
              "value": "={{ $json.url }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2420,
        -540
      ],
      "id": "d7e43286-130f-4304-896b-ddbf996641cb",
      "name": "projetUrl"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "7c023734-4a21-48ca-bf08-f54c3e9d74af",
              "name": "url",
              "value": "={{ $('Create Projet').item.json.url }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2440,
        -340
      ],
      "id": "0f461988-90dd-4aac-9abe-6202171f376c",
      "name": "projetUrl1"
    },
    {
      "parameters": {
        "jsCode": "const raw = items[0].json.output;\n\n// Extrae el contenido dentro de ```json ... ```\nconst match = raw.match(/```json\\s*([\\s\\S]*?)\\s*```/);\nif (!match) {\n  throw new Error(\"No se encontr√≥ un bloque JSON v√°lido.\");\n}\n\nconst parsed = JSON.parse(match[1]);\n\n// Devuelve cada pregunta como un item separado\nreturn parsed.map(pregunta => ({ json: pregunta }));\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3620,
        -400
      ],
      "id": "1605fd98-a6de-40af-8570-a4c5e83a3d87",
      "name": "Code3"
    },
    {
      "parameters": {
        "jsCode": "const LIMITE = 3500; // L√≠mite seguro para texto en Telegram\n\n// Agrupamos primero por relevancia y categor√≠a\nconst agrupado = {};\n\nfor (const item of items) {\n  const { relevancia, categoria, pregunta } = item.json;\n\n  if (!agrupado[relevancia]) agrupado[relevancia] = {};\n  if (!agrupado[relevancia][categoria]) agrupado[relevancia][categoria] = [];\n\n  agrupado[relevancia][categoria].push(pregunta);\n}\n\n// Creamos los mensajes\nconst mensajes = [];\n\nfor (const relevancia of Object.keys(agrupado)) {\n  const categorias = agrupado[relevancia];\n\n  for (const categoria of Object.keys(categorias)) {\n    const preguntas = categorias[categoria];\n\n    let bloque = `üìå *Relevancia: ${relevancia}*\\nüî∏ *${categoria}*\\n`;\n    let acumulado = bloque;\n\n    for (const pregunta of preguntas) {\n      const linea = `- ${pregunta}\\n`;\n\n      if ((acumulado + linea).length > LIMITE) {\n        mensajes.push({ json: { mensaje: acumulado.trim() } });\n\n        // Comenzamos un nuevo mensaje con el encabezado de categor√≠a\n        acumulado = `üìå *Relevancia: ${relevancia}*\\nüî∏ *${categoria}*\\n${linea}`;\n      } else {\n        acumulado += linea;\n      }\n    }\n\n    if (acumulado.trim() !== '') {\n      mensajes.push({ json: { mensaje: acumulado.trim() } });\n    }\n  }\n}\n\nreturn mensajes;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3840,
        -400
      ],
      "id": "8dc8f017-82e3-45d8-a4cd-8dcb9954aabf",
      "name": "Code4"
    }
  ],
  "pinData": {
    "Code3": [
      {
        "json": {
          "categoria": "Funcional",
          "pregunta": "¬øCu√°les son los flujos de trabajo detallados para el seguimiento de pacientes que no agendaron cita?",
          "relevancia": "alta"
        }
      },
      {
        "json": {
          "categoria": "Funcional",
          "pregunta": "¬øCu√°l es la estrategia o el flujo de trabajo propuesto para contactar y reprogramar a pacientes que no asistieron a su cita?",
          "relevancia": "alta"
        }
      },
      {
        "json": {
          "categoria": "Funcional",
          "pregunta": "¬øC√≥mo se define y gestiona la regla de prioridad para la distribuci√≥n de mensajes a los agentes m√°s all√° del 'Primero en llegar, primero en salir'?",
          "relevancia": "alta"
        }
      },
      {
        "json": {
          "categoria": "Funcional",
          "pregunta": "¬øSe requieren scripts o guiones predefinidos para los agentes seg√∫n el tipo de consulta (informaci√≥n, costo, post-tratamiento)?",
          "relevancia": "media"
        }
      },
      {
        "json": {
          "categoria": "Funcional",
          "pregunta": "¬øQu√© informaci√≥n espec√≠fica debe registrar el agente durante o despu√©s de cada conversaci√≥n?",
          "relevancia": "alta"
        }
      },
      {
        "json": {
          "categoria": "Funcional",
          "pregunta": "¬øC√≥mo se debe manejar la escalaci√≥n o gesti√≥n de casos post-tratamiento reportados como 'cr√≠ticos'?",
          "relevancia": "alta"
        }
      },
      {
        "json": {
          "categoria": "Funcional",
          "pregunta": "¬øCu√°l es el comportamiento esperado del sistema para mensajes recibidos fuera del horario de atenci√≥n de los agentes?",
          "relevancia": "alta"
        }
      },
      {
        "json": {
          "categoria": "Funcional",
          "pregunta": "¬øExisten diferentes tipos de tratamientos o campa√±as que requieran flujos de manejo o asignaci√≥n de agentes distintos?",
          "relevancia": "media"
        }
      },
      {
        "json": {
          "categoria": "Funcional",
          "pregunta": "¬øC√≥mo se deben gestionar contactos duplicados que lleguen por diferentes canales o campa√±as?",
          "relevancia": "media"
        }
      },
      {
        "json": {
          "categoria": "Funcional",
          "pregunta": "¬øSe requiere un m√≥dulo de supervisi√≥n o reportes para monitorear la productividad de los agentes y las tasas de conversi√≥n/ausencia en tiempo real?",
          "relevancia": "alta"
        }
      },
      {
        "json": {
          "categoria": "T√©cnica",
          "pregunta": "¬øExiste alguna preferencia o restricci√≥n t√©cnica sobre la arquitectura o la plataforma tecnol√≥gica (cloud, on-premise, lenguaje)?",
          "relevancia": "alta"
        }
      },
      {
        "json": {
          "categoria": "T√©cnica",
          "pregunta": "¬øCu√°les son los requisitos de disponibilidad y rendimiento (ej. % de uptime, tiempo de respuesta)?",
          "relevancia": "alta"
        }
      },
      {
        "json": {
          "categoria": "T√©cnica",
          "pregunta": "¬øCu√°les son los requisitos de seguridad y cumplimiento normativo para el manejo de datos de pacientes (ej. HIPAA, GDPR)?",
          "relevancia": "alta"
        }
      },
      {
        "json": {
          "categoria": "T√©cnica",
          "pregunta": "¬øSe requiere migraci√≥n de datos hist√≥ricos desde la plataforma Fexe? Si es as√≠, ¬øqu√© volumen y qu√© tipo de datos?",
          "relevancia": "alta"
        }
      },
      {
        "json": {
          "categoria": "T√©cnica",
          "pregunta": "¬øExiste infraestructura de telecomunicaciones o telefon√≠a (ej. un PBX) con la que la plataforma deba integrarse?",
          "relevancia": "media"
        }
      },
      {
        "json": {
          "categoria": "Volumen de datos",
          "pregunta": "¬øCu√°l es el pico m√°ximo de mensajes recibidos por hora o por d√≠a esperado?",
          "relevancia": "alta"
        }
      },
      {
        "json": {
          "categoria": "Volumen de datos",
          "pregunta": "¬øCu√°ntos agentes utilizar√°n la plataforma concurrentemente en su pico?",
          "relevancia": "alta"
        }
      },
      {
        "json": {
          "categoria": "Volumen de datos",
          "pregunta": "¬øCu√°l es el crecimiento proyectado del volumen de mensajes o del n√∫mero de agentes en los pr√≥ximos 1-3 a√±os?",
          "relevancia": "media"
        }
      },
      {
        "json": {
          "categoria": "Volumen de datos",
          "pregunta": "¬øCu√°nto tiempo hist√≥rico deben estar accesibles las conversaciones y los datos de los pacientes dentro de la plataforma?",
          "relevancia": "media"
        }
      },
      {
        "json": {
          "categoria": "Canales",
          "pregunta": "¬øAdem√°s de META (WhatsApp, Messenger, Instagram?), ¬øqu√© otros canales de mensajer√≠a o comunicaci√≥n (Web Chat, SMS, Email) deben ser centralizados?",
          "relevancia": "alta"
        }
      },
      {
        "json": {
          "categoria": "Canales",
          "pregunta": "¬øLa llamada de confirmaci√≥n de cita se gestionar√° a trav√©s de la nueva plataforma o es un proceso telef√≥nico externo?",
          "relevancia": "alta"
        }
      },
      {
        "json": {
          "categoria": "Canales",
          "pregunta": "¬øSe requieren funcionalidades espec√≠ficas por canal, como el uso de plantillas, respuestas r√°pidas o env√≠o de medios?",
          "relevancia": "media"
        }
      },
      {
        "json": {
          "categoria": "Canales",
          "pregunta": "¬øLos agentes utilizar√°n la plataforma para *realizar* llamadas telef√≥nicas adem√°s de gestionar mensajes?",
          "relevancia": "alta"
        }
      },
      {
        "json": {
          "categoria": "Integraciones",
          "pregunta": "¬øSe dispone de acceso a las APIs de META (WhatsApp Business API, Messenger API, Instagram API)?",
          "relevancia": "alta"
        }
      },
      {
        "json": {
          "categoria": "Integraciones",
          "pregunta": "¬øSe dispone de documentaci√≥n t√©cnica o acceso a las APIs de Agenda Pro y Odoo para integrar la informaci√≥n de agendamientos y pacientes?",
          "relevancia": "alta"
        }
      },
      {
        "json": {
          "categoria": "Integraciones",
          "pregunta": "¬øQu√© informaci√≥n espec√≠fica debe intercambiarse con Agenda Pro (ej. Crear cita, consultar estado, cancelar)?",
          "relevancia": "alta"
        }
      },
      {
        "json": {
          "categoria": "Integraciones",
          "pregunta": "¬øQu√© informaci√≥n espec√≠fica debe intercambiarse con Odoo (ej. Datos del paciente, tratamientos, historial)?",
          "relevancia": "alta"
        }
      },
      {
        "json": {
          "categoria": "Integraciones",
          "pregunta": "¬øExisten otros sistemas internos (ej. CRM, sistema de historiales m√©dicos) con los que la plataforma deba integrarse?",
          "relevancia": "alta"
        }
      },
      {
        "json": {
          "categoria": "Soporte",
          "pregunta": "¬øCu√°l es el horario de soporte requerido para la plataforma (ej. 8x5, 24x7)?",
          "relevancia": "alta"
        }
      },
      {
        "json": {
          "categoria": "Soporte",
          "pregunta": "¬øCu√°l es el tiempo de respuesta esperado para incidentes cr√≠ticos?",
          "relevancia": "alta"
        }
      },
      {
        "json": {
          "categoria": "Soporte",
          "pregunta": "¬øSe requiere monitoreo proactivo de la plataforma y sus integraciones?",
          "relevancia": "alta"
        }
      },
      {
        "json": {
          "categoria": "Soporte",
          "pregunta": "¬øSe incluye en el alcance el mantenimiento evolutivo y correctivo post-lanzamiento?",
          "relevancia": "alta"
        }
      },
      {
        "json": {
          "categoria": "Otros",
          "pregunta": "¬øCu√°l es el presupuesto estimado o rango de inversi√≥n para este proyecto?",
          "relevancia": "alta"
        }
      },
      {
        "json": {
          "categoria": "Otros",
          "pregunta": "¬øCu√°l es el cronograma o fecha l√≠mite deseada para la implementaci√≥n de la nueva plataforma?",
          "relevancia": "alta"
        }
      },
      {
        "json": {
          "categoria": "Otros",
          "pregunta": "¬øExisten roles de usuario espec√≠ficos con permisos diferenciados (agente, supervisor, administrador)?",
          "relevancia": "media"
        }
      },
      {
        "json": {
          "categoria": "Otros",
          "pregunta": "¬øAdem√°s de mejorar las tasas de conversi√≥n y asistencia, hay otras funcionalidades deseadas para 'extender' Fexe?",
          "relevancia": "media"
        }
      }
    ]
  },
  "repo_name": "flujos_n8n",
  "repo_owner": "whitelabel-ai",
  "repo_path": "Automation/",
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": {
    "node:Gmail Trigger": {
      "Gmail Trigger": {
        "lastTimeChecked": 1751917090,
        "possibleDuplicates": [
          "197a4acaa9ea5f21"
        ]
      }
    },
    "node:Notion Trigger": {
      "lastTimeChecked": "2025-07-07T19:38:00.000Z"
    }
  },
  "tags": [],
  "triggerCount": 2,
  "updatedAt": "2025-07-07T20:50:15.736Z",
  "versionId": "017e396c-8130-42a5-8bf8-0ff6c2703b1b"
}